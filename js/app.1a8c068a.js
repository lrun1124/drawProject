(function(e){function t(t){for(var o,s,r=t[0],c=t[1],h=t[2],d=0,u=[];d<r.length;d++)s=r[d],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&u.push(n[s][0]),n[s]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);l&&l(t);while(u.length)u.shift()();return a.push.apply(a,h||[]),i()}function i(){for(var e,t=0;t<a.length;t++){for(var i=a[t],o=!0,r=1;r<i.length;r++){var c=i[r];0!==n[c]&&(o=!1)}o&&(a.splice(t--,1),e=s(s.s=i[0]))}return e}var o={},n={app:0},a=[];function s(t){if(o[t])return o[t].exports;var i=o[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=o,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(i,o,function(t){return e[t]}.bind(null,o));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=t,r=r.slice();for(var h=0;h<r.length;h++)t(r[h]);var l=c;a.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},"034f":function(e,t,i){"use strict";var o=i("85ec"),n=i.n(o);n.a},"0878":function(e,t,i){e.exports=i.p+"img/leftTip.6637ef42.png"},1308:function(e,t,i){},2393:function(e,t,i){},"274b":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFQAAABWCAYAAABRo7HKAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGCSURBVHhe7dkxjoJAAEbhvTY3sbChsbChsaFAExoKDsAJvAMNmd1ZgaxxNlnhxcjmfclf2MGLQYGPIJRBYQaFzUG7rnMrNrkLqmUMCjMozKAwg8IMCjMozKAwg8IMCjMozKAwg8IMCjMozKAwg8IMCjMozKAwg8IMCjMozKAwg8JeFrRt23C9XsdP/9dLgjZNE7IsMyihruvvmAYFVFU1xzToSmVZ3sU06Aqn0+khpkEXKooiGTPOoE86Ho/JkNMM+oTD4ZCM+HMG/YNhGEKe58mAW9jlchnPhLEqaN/3Yb/fJw90K3uroLvdLnmQW5rfUHjn83k8G8aqoNHWr6FvF3Tir/wNFjTyfygcNPJOCQ4aeS9/gwWNfNoEB418HjqigkY+sf9CBo18pwQHjXzrqUUMCjMozKAwg8IMCjMozKAwg8IMCjMozKAwg8IMCjMozKAwg8IMCjMozKAwg8IMCjMozKAwg8IMCjMozKAwg8IMCvs1qFu+yRxUDIPCDIoK4RPZa+LRDGJ3GgAAAABJRU5ErkJggg=="},3504:function(e){e.exports=JSON.parse('{"node":{"head":"外形","fill":"背景","stroke":"边框","font":"文字","fontSize":"大小","fontStyle":"样式","textFill":"颜色","position":"位置","nodeAlign":"对齐方式","prefabrication":"预制样式"},"group":{"head":"外形","fill":"背景","stroke":"边框","showHead":"显示头部","font":"文字","fontStyle":"样式","fontSize":"大小","fontBackground":"背景","align":"对齐方式","textFill":"颜色","position":"位置","prefabrication":"预制样式"},"edge":{"head":"样式","fill":"文字背景","stroke":"边框","lineDash":"线段样式","lineStyle":"线段形式","turningDistance":"转折距离","font":"文字","fontStyle":"样式","fontSize":"大小","textFill":"颜色","nodeAlign":"节点对齐","position":"Position","prefabrication":"预制样式"}}')},"3efa":function(e,t,i){},4181:function(e,t,i){"use strict";var o=i("e617"),n=i.n(o);n.a},"42ec":function(e,t,i){},4813:function(e,t,i){},"4e4d":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFcAAABVCAYAAAA8AHhnAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGSSURBVHhe7dA9isJQGEbh2bYLsbGxsbCwSWNjkYCNO3ANWYGFRYZPGHDMHfybY74L54GXEL25xfkahDEuyLigUdzj8eje2LViXL3GuCDjgowLqjZu27ajZVNt3NlsNlo2xgUZF2RckHFBxgUZF2RckHFBxgUZF2RckHFBxgUZF2RckHFBxgUZF2RckHFBxgUZF2RckHFBxgUZF2RckHFBxgUZF2RckHFBxgUZF2RckHFBxgUZF2RckHFBxgUZF2RckHFBxgUZF2RckHFBxgWljNv3/d2V4pbO3e6TUsY9HA7FeO8u7v2klHHDfr8vBnp1cd+npY0buq4rhnp2cc8UUscNu92uGOzRxfdTSR83bLfbYrh7i++mVEXc0DRNMeBfi/NTqyZu2Gw2xZC3i3MZVBU3rNfrYtCfxf9ZVBc3rFarYtj4PZMq44blcvkrbLxnU23c8/k8LBaLS9h4xns21cYNp9NpmM/nl2dGVcfNzrgg44KMCzIuyLgg44KMCzIuyLigh+K613dtFFf/x7iYYfgGt8Uegdxhb5AAAAAASUVORK5CYII="},"50b9":function(e,t,i){},5490:function(e,t,i){"use strict";var o=i("a6b6"),n=i.n(o);n.a},"56d7":function(e,t,i){"use strict";i.r(t);i("e260"),i("e6cf"),i("cca6"),i("a79d"),i("b64b"),i("159b");var o=i("2b0e"),n=i("a925");o["default"].use(n["a"]);var a="zh",s="localeLanguage",r={zh:i("3504"),en:i("edd4")},c=new n["a"]({locale:a,messages:r}),h=function(e){void 0===e&&(e=window.localStorage.getItem(s),void 0===r[e]&&(e=a)),window.localStorage.setItem(s,e),Object.keys(r).forEach((function(e){document.body.classList.remove("lang-".concat(e))})),document.body.classList.add("lang-".concat(e)),document.body.setAttribute("lang",e),o["default"].config.lang=e,c.locale=e};window.i18n=c;var l=c,d=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("MainPage")],1)},u=[],f=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"MainPage"},[i("Header"),i("Toolbar"),i("Editor"),i("Property"),i("Map")],1)},p=[],g=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"header"},[i("span",{staticStyle:{float:"left","margin-left":"20px","font-size":"20px","font-weight":"bold"}},[e._v("EPCAD")]),i("span",{staticClass:"iconfont icon-open",staticStyle:{float:"left","margin-left":"10px","font-size":"18px",display:"none"},on:{click:function(t){return t.stopPropagation(),e.openFile(t)}}}),i("ul",[i("li",[i("Button",{staticClass:"head-button",on:{click:function(t){e.modal1=!0}}},[e._v("清除")]),i("Modal",{attrs:{title:"清空"},on:{"on-ok":function(t){return e.command(e.delAllIcon)},"on-cancel":e.cancel},model:{value:e.modal1,callback:function(t){e.modal1=t},expression:"modal1"}},[i("p",[e._v("确定要清空画布上所有内容吗？")])])],1),e._l(e.icon,(function(t,o){return i("li",{key:o},[i("Button",{class:"head-button "+t.class,domProps:{innerHTML:e._s(t.name)},on:{click:function(i){return e.command(t)}}})],1)})),i("li",[i("Button",{staticClass:"head-button",on:{click:function(t){return t.stopPropagation(),e.save("png")}}},[e._v("下载设计图")])],1)],2),i("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"file"}})])},y=[],m=(i("c975"),i("b0c0"),i("8a79"),new o["default"]),x={name:"Header",data:function(){return{language:"zh",showLang:!1,delAllIcon:{icon:"icon-shanchu",name:"清除",cmd:"deleteAll",class:"enable"},icon:[{icon:"icon-copy",name:"复制",cmd:"copy",class:"disable"},{icon:"icon-shanchu",name:"删除",cmd:"delete",class:"disable"},{icon:"icon-redo",name:"旋转",cmd:"rotate",class:"disable"},{icon:"icon-redo",name:"镜像",cmd:"mirror",class:"disable"},{icon:"icon-redo",name:"信息",cmd:"showInfoDraw",class:"enable"}],disable:!0,upload:!1,modal1:!1}},computed:{lang:function(){return"zh"==this.language?"中文":"English"}},mounted:function(){var e=this;m.$on("selectNode",(function(){e.status="selectNode",e.changeDisable(!0)})),m.$on("clearSelect",(function(){e.status="clearSelect",e.changeDisable(!1)})),m.$on("selectGroup",(function(){e.status="selectGroup",e.changeDisable(!0)})),m.$on("selectEdge",(function(){e.status="selectEdge",e.changeDisable(!0)}));var t=document.getElementById("file");t.addEventListener("change",(function(e){var i=e.target.files[0];if(i&&i.name.endsWith("json")){var o=new FileReader;o.readAsText(i),o.onload=function(){try{m.$emit("initFlow",{data:JSON.parse(this.result)})}catch(e){alert("数据出错")}}}t.value=""}),!1),this.language=localStorage.getItem("localeLanguage")||"zh",this.changeLanguage(this.language)},methods:{openFile:function(){document.getElementById("file").click()},changeLanguage:function(e){this.language=e,m.$emit("changeLanguage",{language:e})},mouseenter:function(){this.showLang=!0},mouseleave:function(){this.showLang=!1},command:function(e){"disable"!=e.class&&m.$emit(e.cmd)},changeDisable:function(e){e?this.icon.forEach((function(e){-1==["undo","redo","deleteAll"].indexOf(e.cmd)&&(e.class="")})):this.icon.forEach((function(e){-1==["undo","redo","deleteAll"].indexOf(e.cmd)&&(e.class="disable")})),this.disable=e},showUpload:function(){this.upload=!this.upload},save:function(e){this.upload=!1,m.$emit("saveData",{type:e})}}},v=x,w=(i("4181"),i("2877")),b=Object(w["a"])(v,g,y,!1,null,"0b1f4dcb",null),k=b.exports,S=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"toolbar"},[i("Collapse",{attrs:{accordion:""},model:{value:e.currentPanel,callback:function(t){e.currentPanel=t},expression:"currentPanel"}},[i("Panel",{attrs:{name:"1"}},[e._v(" 设备 "),i("div",{attrs:{slot:"content"},slot:"content"},[i("List",{staticClass:"clearfix child-panel"},e._l(e.preFacilities,(function(t){return i("ListItem",{key:t.command,class:"iconfont "+t.iconName,attrs:{draggable:"true"},on:{dragstart:function(i){return e.dragstart(i,t)}}},[i("div",{attrs:{draggable:"true",title:t.text},domProps:{innerHTML:e._s(t.path)},on:{dragstart:function(i){return e.dragstart(i,t)}}})])})),1),i("div",{staticClass:"panelFootButton"},[i("Button",{staticStyle:{"margin-right":"15px"},on:{click:function(t){t.stopPropagation(),e.showSearchDialog=!e.showSearchDialog}}},[e._v(" 搜索 ")]),i("Button",{on:{click:function(t){t.stopPropagation(),e.showFacilityDialog=!e.showFacilityDialog}}},[e._v(" 管理 ")])],1)],1)]),i("Panel",{attrs:{name:"2"}},[e._v(" 组合 "),i("div",{attrs:{slot:"content"},slot:"content"},[i("List",{staticClass:"clearfix child-panel"},e._l(e.combines,(function(t){return i("ListItem",{key:t.command,class:"iconfont "+t.name,attrs:{draggable:"true"},on:{dragstart:function(i){return e.dragstart(i,t)}}},[i("div",{attrs:{draggable:"true",title:t.text},domProps:{innerHTML:e._s(t.path)},on:{dragstart:function(i){return e.dragstart(i,t)}}})])})),1),i("div",{staticClass:"panelFootButton"},[i("Button",{on:{click:function(t){return t.stopPropagation(),e.showCombinePanel(t)}}},[e._v(" 添加组合 ")])],1)],1)]),i("Panel",{attrs:{name:"3"}},[e._v(" 障碍物 "),i("div",{attrs:{slot:"content"},slot:"content"},[i("List",{staticClass:"clearfix child-panel"},e._l(e.preObstacle,(function(t){return i("ListItem",{key:t.command,class:"iconfont "+t.name,attrs:{draggable:"true"},on:{dragstart:function(i){return e.dragstart(i,t)}}},[i("div",{attrs:{draggable:"true",title:t.text},domProps:{innerHTML:e._s(t.path)},on:{dragstart:function(i){return e.dragstart(i,t)}}})])})),1),i("div",{staticClass:"panelFootButton"},[i("Button",{on:{click:function(t){t.stopPropagation(),e.showObstacleDialog=!e.showObstacleDialog}}},[e._v(" 障碍物管理 ")])],1)],1)]),i("Panel",{attrs:{name:"4"}},[e._v(" 房间 "),i("div",{attrs:{slot:"content"},slot:"content"},[i("List",{staticClass:"clearfix child-panel"},e._l(e.precustomize,(function(t,o){return i("ListItem",{key:o,staticStyle:{"text-align":"center"},attrs:{draggable:"true"},on:{dragstart:function(i){return e.dragstart(i,t)}}},[i("div",{staticStyle:{"font-size":"20px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","text-align":"center",width:"100%"},attrs:{draggable:"true"},domProps:{textContent:e._s(t.roomName)},on:{dragstart:function(i){return e.dragstart(i,t)}}})])})),1),i("div",{staticClass:"panelFootButton"},[i("Button",{on:{click:function(t){t.stopPropagation(),e.showCustomize=!e.showCustomize}}},[e._v(" 房间管理 ")])],1)],1)])],1),e.showSearchDialog?i("div",{staticClass:"upload-win-child"},[i("div",{staticClass:"customize-win-header"},[i("div",{staticClass:"close iconfont icon-guanbi",on:{click:function(t){t.stopPropagation(),e.showSearchDialog=!1}}})]),i("div",{staticClass:"upload-win-content"},[e._m(0),i("div",{staticStyle:{"margin-bottom":"20px"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.serchKeyWord,expression:"serchKeyWord"}],staticClass:"image-url",attrs:{placeholder:"输入设备名称或者编号关键字搜索",type:"text",text:"serchKeyWord"},domProps:{value:e.serchKeyWord},on:{input:function(t){t.target.composing||(e.serchKeyWord=t.target.value)}}}),e._v(" "),i("Button",{on:{click:e.clearSearch}},[e._v("重置")])],1)])]):e._e(),e.showFacilityDialog?i("div",{staticClass:"customize-win"},[i("div",{staticClass:"customize-win-header"},[i("span",[e._v("设备")]),i("div",{staticClass:"close iconfont icon-guanbi",on:{click:function(t){t.stopPropagation(),e.showFacilityDialog=!1}}})]),i("div",{staticClass:"customize-image"},[i("ul",[e._l(e.facilities,(function(t,o){return i("li",{key:o,attrs:{draggable:"true"}},[i("span",{staticClass:"iconfont icon-guanbi",on:{click:function(i){return i.stopPropagation(),e.removeFacility(t)}}}),i("div",{staticStyle:{"font-size":"12px","max-width":"100px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"},domProps:{innerHTML:e._s(t.name)}})])})),i("li",{on:{click:function(t){return t.stopPropagation(),e.showFacilityDetail(t)}}},[i("span",{staticClass:"iconfont icon-add",staticStyle:{color:"#666","font-size":"48px","line-height":"44px","text-align":"center",cursor:"pointer"}})])],2)])]):e._e(),i("Drawer",{staticClass:"facility-draw",attrs:{title:"设备",closable:!1},model:{value:e.facilityDetail.isShow,callback:function(t){e.$set(e.facilityDetail,"isShow",t)},expression:"facilityDetail.isShow"}},[i("div",{staticClass:"upload-win-content"},[i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("设备参数")])]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("名称：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.facility.name,expression:"facility.name"}],staticClass:"image-url",attrs:{placeholder:"名字/编号",type:"text"},domProps:{value:e.facility.name},on:{input:function(t){t.target.composing||e.$set(e.facility,"name",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("编号：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.facility.id,expression:"facility.id"}],staticClass:"image-url",attrs:{placeholder:"名字/编号",type:"text"},domProps:{value:e.facility.id},on:{input:function(t){t.target.composing||e.$set(e.facility,"id",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("宽度：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.facility.width,expression:"facility.width"}],staticClass:"image-url",attrs:{placeholder:"单位cm",type:"text"},domProps:{value:e.facility.width},on:{input:function(t){t.target.composing||e.$set(e.facility,"width",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("高度：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.facility.height,expression:"facility.height"}],staticClass:"image-url",attrs:{placeholder:"单位cm",type:"text"},domProps:{value:e.facility.height},on:{input:function(t){t.target.composing||e.$set(e.facility,"height",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("价格：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.facility.cost,expression:"facility.cost"}],staticClass:"image-url",attrs:{placeholder:"单位:元",type:"text"},domProps:{value:e.facility.cost},on:{input:function(t){t.target.composing||e.$set(e.facility,"cost",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("安全距离")])]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("上侧：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.facility.safe.up,expression:"facility.safe.up"}],staticClass:"image-url",attrs:{placeholder:"单位cm，默认为0",type:"text"},domProps:{value:e.facility.safe.up},on:{input:function(t){t.target.composing||e.$set(e.facility.safe,"up",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("下侧：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.facility.safe.down,expression:"facility.safe.down"}],staticClass:"image-url",attrs:{placeholder:"单位cm，默认为0",type:"text"},domProps:{value:e.facility.safe.down},on:{input:function(t){t.target.composing||e.$set(e.facility.safe,"down",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("左侧：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.facility.safe.left,expression:"facility.safe.left"}],staticClass:"image-url",attrs:{placeholder:"单位cm，默认为0",type:"text"},domProps:{value:e.facility.safe.left},on:{input:function(t){t.target.composing||e.$set(e.facility.safe,"left",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("右侧：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.facility.safe.right,expression:"facility.safe.right"}],staticClass:"image-url",attrs:{placeholder:"单位cm，默认为0",type:"text"},domProps:{value:e.facility.safe.right},on:{input:function(t){t.target.composing||e.$set(e.facility.safe,"right",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("额外安全距离:")])]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("操作面：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.facility.safe.operation,expression:"facility.safe.operation"}],staticClass:"image-url",staticStyle:{width:"388px"},attrs:{placeholder:"单位cm，默认为0",type:"text"},domProps:{value:e.facility.safe.operation},on:{input:function(t){t.target.composing||e.$set(e.facility.safe,"operation",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("背侧：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.facility.safe.back,expression:"facility.safe.back"}],staticClass:"image-url",attrs:{placeholder:"单位cm，默认为0",type:"text"},domProps:{value:e.facility.safe.back},on:{input:function(t){t.target.composing||e.$set(e.facility.safe,"back",t.target.value)}}})]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.facilityDetail.showAddButton,expression:"facilityDetail.showAddButton"}],staticStyle:{"margin-bottom":"40px"}},[i("span",[e._v("操作台朝向：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.facility.face,expression:"facility.face"}],attrs:{type:"radio",name:"face",value:"0"},domProps:{checked:e._q(e.facility.face,"0")},on:{change:function(t){return e.$set(e.facility,"face","0")}}}),i("label",{attrs:{for:"up"}},[e._v("上")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.facility.face,expression:"facility.face"}],attrs:{type:"radio",name:"face",value:"2"},domProps:{checked:e._q(e.facility.face,"2")},on:{change:function(t){return e.$set(e.facility,"face","2")}}}),i("label",{attrs:{for:"down"}},[e._v("下")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.facility.face,expression:"facility.face"}],attrs:{type:"radio",name:"face",value:"3"},domProps:{checked:e._q(e.facility.face,"3")},on:{change:function(t){return e.$set(e.facility,"face","3")}}}),i("label",{attrs:{for:"left"}},[e._v("左")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.facility.face,expression:"facility.face"}],attrs:{type:"radio",name:"face",value:"1"},domProps:{checked:e._q(e.facility.face,"1")},on:{change:function(t){return e.$set(e.facility,"face","1")}}}),i("label",{attrs:{for:"right"}},[e._v("右")])])]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.facilityDetail.showAddButton,expression:"facilityDetail.showAddButton"}],staticClass:"upload-win-footer"},[i("button",{on:{click:e.addFacility}},[e._v("确定")])])]),i("Drawer",{staticClass:"facility-draw",attrs:{title:"组合",closable:!1},model:{value:e.combineDetail.isShow,callback:function(t){e.$set(e.combineDetail,"isShow",t)},expression:"combineDetail.isShow"}},[i("div",{staticClass:"upload-win-content"},[i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("名称：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.combine.name,expression:"combine.name"}],staticClass:"image-url",attrs:{placeholder:"名字/编号",type:"text"},domProps:{value:e.combine.name},on:{input:function(t){t.target.composing||e.$set(e.combine,"name",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("组成：")]),i("List",{staticStyle:{"margin-left":"40px"}},e._l(e.combine.nodes,(function(t){return i("ListItem",{key:t.name},[i("div",{attrs:{title:t.text},domProps:{innerHTML:e._s(t.name)}})])})),1)],1),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("宽度：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.combine.width,expression:"combine.width"}],staticClass:"image-url",attrs:{placeholder:"单位cm",type:"text"},domProps:{value:e.combine.width},on:{input:function(t){t.target.composing||e.$set(e.combine,"width",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("高度：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.combine.height,expression:"combine.height"}],staticClass:"image-url",attrs:{placeholder:"单位cm",type:"text"},domProps:{value:e.combine.height},on:{input:function(t){t.target.composing||e.$set(e.combine,"height",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("价格：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.combine.cost,expression:"combine.cost"}],staticClass:"image-url",attrs:{placeholder:"单位:元",type:"text"},domProps:{value:e.combine.cost},on:{input:function(t){t.target.composing||e.$set(e.combine,"cost",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("安全距离")])]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("上侧：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.combine.safe.up,expression:"combine.safe.up"}],staticClass:"image-url",attrs:{placeholder:"单位cm，默认为0",type:"text"},domProps:{value:e.combine.safe.up},on:{input:function(t){t.target.composing||e.$set(e.combine.safe,"up",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("下侧：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.combine.safe.down,expression:"combine.safe.down"}],staticClass:"image-url",attrs:{placeholder:"单位cm，默认为0",type:"text"},domProps:{value:e.combine.safe.down},on:{input:function(t){t.target.composing||e.$set(e.combine.safe,"down",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("左侧：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.combine.safe.left,expression:"combine.safe.left"}],staticClass:"image-url",attrs:{placeholder:"单位cm，默认为0",type:"text"},domProps:{value:e.combine.safe.left},on:{input:function(t){t.target.composing||e.$set(e.combine.safe,"left",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("右侧：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.combine.safe.right,expression:"combine.safe.right"}],staticClass:"image-url",attrs:{placeholder:"单位cm，默认为0",type:"text"},domProps:{value:e.combine.safe.right},on:{input:function(t){t.target.composing||e.$set(e.combine.safe,"right",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("额外安全距离:")])]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("操作面：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.combine.safe.operation,expression:"combine.safe.operation"}],staticClass:"image-url",staticStyle:{width:"388px"},attrs:{placeholder:"单位cm，默认为0",type:"text"},domProps:{value:e.combine.safe.operation},on:{input:function(t){t.target.composing||e.$set(e.combine.safe,"operation",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("背侧：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.combine.safe.back,expression:"combine.safe.back"}],staticClass:"image-url",attrs:{placeholder:"单位cm，默认为0",type:"text"},domProps:{value:e.combine.safe.back},on:{input:function(t){t.target.composing||e.$set(e.combine.safe,"back",t.target.value)}}})])])]),e.showObstacleDialog?i("div",{staticClass:"customize-win"},[i("div",{staticClass:"customize-win-header"},[i("span",[e._v("障碍物")]),i("div",{staticClass:"close iconfont icon-guanbi",on:{click:function(t){t.stopPropagation(),e.showObstacleDialog=!1}}})]),i("div",{staticClass:"customize-image"},[i("ul",[e._l(e.obstacles,(function(t,o){return i("li",{key:o,attrs:{draggable:"true"}},[i("span",{staticClass:"iconfont icon-guanbi",on:{click:function(i){return i.stopPropagation(),e.removeObstacle(t)}}}),i("div",{staticStyle:{"font-size":"15px","max-width":"50px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"},domProps:{innerHTML:e._s(t.name)}})])})),i("li",{on:{click:function(t){t.stopPropagation(),e.showObstacleDetail=!e.showObstacleDetail}}},[i("span",{staticClass:"iconfont icon-add",staticStyle:{color:"#666","font-size":"48px","line-height":"44px","text-align":"center",cursor:"pointer"}})])],2)])]):e._e(),i("Drawer",{staticClass:"facility-draw",attrs:{title:"障碍物",closable:!1},model:{value:e.showObstacleDetail,callback:function(t){e.showObstacleDetail=t},expression:"showObstacleDetail"}},[i("div",{staticClass:"upload-win-content"},[i("div",{staticStyle:{"margin-bottom":"20px"}},[i("span",[e._v("请输入障碍物尺寸")])]),i("div",{staticStyle:{"margin-bottom":"20px"}},[i("span",[e._v("名称：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.obstacle.name,expression:"obstacle.name"}],staticClass:"image-url",attrs:{placeholder:"名字/编号",type:"text",text:"obstacleName"},domProps:{value:e.obstacle.name},on:{input:function(t){t.target.composing||e.$set(e.obstacle,"name",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"20px"}},[i("span",[e._v("长度：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.obstacle.width,expression:"obstacle.width"}],staticClass:"image-url",attrs:{placeholder:"单位cm",type:"text",text:"obstacleWidth"},domProps:{value:e.obstacle.width},on:{input:function(t){t.target.composing||e.$set(e.obstacle,"width",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"20px"}},[i("span",[e._v("宽度：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.obstacle.height,expression:"obstacle.height"}],staticClass:"image-url",attrs:{placeholder:"单位cm",type:"text",text:"obstacleHeight"},domProps:{value:e.obstacle.height},on:{input:function(t){t.target.composing||e.$set(e.obstacle,"height",t.target.value)}}})])]),i("div",{staticClass:"upload-win-footer"},[i("button",{on:{click:e.addObstacle}},[e._v("确定")])])]),e.showCustomize?i("div",{staticClass:"customize-win"},[i("div",{staticClass:"customize-win-header"},[i("span",[e._v("房间")]),i("div",{staticClass:"close iconfont icon-guanbi",on:{click:function(t){t.stopPropagation(),e.showCustomize=!1}}})]),i("div",{staticClass:"customize-image"},[i("ul",[e._l(e.customize,(function(t,o){return i("li",{key:o,attrs:{draggable:"true"}},[i("span",{staticClass:"iconfont icon-guanbi",on:{click:function(i){return i.stopPropagation(),e.removeRoom(t)}}}),i("div",{staticStyle:{"font-size":"15px","max-width":"50px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"},domProps:{innerHTML:e._s(t.roomName)}})])})),i("li",{on:{click:function(t){t.stopPropagation(),e.showUpload=!e.showUpload}}},[i("span",{staticClass:"iconfont icon-add",staticStyle:{color:"#666","font-size":"48px","line-height":"44px","text-align":"center",cursor:"pointer"}})])],2)])]):e._e(),i("Drawer",{staticClass:"facility-draw",attrs:{title:"房间",closable:!1},model:{value:e.showUpload,callback:function(t){e.showUpload=t},expression:"showUpload"}},[i("div",{staticClass:"upload-win-content"},[i("div",{staticStyle:{"margin-bottom":"20px"}},[i("span",{staticStyle:{"padding-right":"12px"}},[e._v("房间名：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.roomName,expression:"roomName"}],staticClass:"image-url",staticStyle:{width:"200px"},attrs:{placeholder:"房间名",type:"text",text:"roomData"},domProps:{value:e.roomName},on:{input:function(t){t.target.composing||(e.roomName=t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"20px"}},[e._v("请按顺时针方向绘制参数: ")]),i("div",{staticStyle:{"text-align":"center"}},[i("img",{attrs:{src:e.imgUrlRight},on:{click:function(t){t.stopPropagation(),e.showRight=!e.showRight}}}),i("img",{attrs:{src:e.imgUrlDown},on:{click:function(t){t.stopPropagation(),e.showDown=!e.showDown}}}),i("img",{attrs:{src:e.imgUrlLeft},on:{click:function(t){t.stopPropagation(),e.showLeft=!e.showLeft}}}),i("img",{attrs:{src:e.imgUrlUp},on:{click:function(t){t.stopPropagation(),e.showUp=!e.showUp}}})]),i("div",{staticStyle:{"margin-bottom":"20px","text-align":"center"}},[i("span",{staticStyle:{"margin-right":"20px"}},[i("Button",{on:{click:e.redoRoomData}},[e._v("撤销")])],1),i("span",[i("Button",{on:{click:e.clearRoomData}},[e._v("重置")])],1)]),i("div",{staticStyle:{"margin-bottom":"20px"}},[i("span",[e._v("房间参数：")]),i("span",{domProps:{textContent:e._s(e.roomInput)}})])]),i("div",{staticClass:"upload-win-footer"},[i("button",{on:{click:e.addRoom}},[e._v("确定")])])]),i("Drawer",{staticClass:"addroom-child-draw",attrs:{title:"请输入向右的参数",closable:!1},model:{value:e.showRight,callback:function(t){e.showRight=t},expression:"showRight"}},[i("div",{staticClass:"upload-win-content"},[i("div",{staticStyle:{"margin-bottom":"20px"}},[i("span",[e._v("实际长度：（若有倾斜角度时为垂直长度）")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.lineLength,expression:"lineLength"}],staticClass:"image-url",attrs:{placeholder:"单位cm",type:"text",text:"rightLength"},domProps:{value:e.lineLength},on:{input:function(t){t.target.composing||(e.lineLength=t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"20px"}},[i("span",[e._v("倾斜角度：")]),i("RadioGroup",{model:{value:e.hasSlope,callback:function(t){e.hasSlope=t},expression:"hasSlope"}},[i("Radio",{attrs:{label:"0"}},[e._v("无")]),i("Radio",{attrs:{label:"1"}},[e._v("有")])],1)],1),1==e.hasSlope?i("div",{staticStyle:{"margin-bottom":"20px"}},[i("div",{staticStyle:{"margin-bottom":"20px"}},[i("span",[e._v("偏移距离：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.slope.length,expression:"slope.length"}],staticClass:"slope-length-input",attrs:{placeholder:"默认不用填，斜线需要",type:"text",text:"name"},domProps:{value:e.slope.length},on:{input:function(t){t.target.composing||e.$set(e.slope,"length",t.target.value)}}}),i("img",{staticClass:"tip-img",attrs:{src:e.imgUrlRightTip}})]),i("RadioGroup",{model:{value:e.slope.direction,callback:function(t){e.$set(e.slope,"direction",t)},expression:"slope.direction"}},[i("Radio",{attrs:{label:"0"}},[e._v("逆时针")]),i("Radio",{attrs:{label:"1"}},[e._v("顺时针")])],1)],1):e._e()]),i("div",{staticClass:"upload-win-footer"},[i("button",{on:{click:function(t){return e.addRoomLine(0)}}},[e._v("确定")])])]),i("Drawer",{staticClass:"addroom-child-draw",attrs:{title:"请输入向下的参数",closable:!1},model:{value:e.showDown,callback:function(t){e.showDown=t},expression:"showDown"}},[i("div",{staticClass:"upload-win-content"},[i("div",{staticStyle:{"margin-bottom":"20px"}},[i("span",[e._v("实际长度：（若有倾斜角度时为垂直长度）")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.lineLength,expression:"lineLength"}],staticClass:"image-url",attrs:{placeholder:"单位cm",type:"text",text:"rightLength"},domProps:{value:e.lineLength},on:{input:function(t){t.target.composing||(e.lineLength=t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"20px"}},[i("span",[e._v("倾斜角度：")]),i("RadioGroup",{model:{value:e.hasSlope,callback:function(t){e.hasSlope=t},expression:"hasSlope"}},[i("Radio",{attrs:{label:"0"}},[e._v("无")]),i("Radio",{attrs:{label:"1"}},[e._v("有")])],1)],1),1==e.hasSlope?i("div",{staticStyle:{"margin-bottom":"20px"}},[i("div",{staticStyle:{"margin-bottom":"20px"}},[i("span",[e._v("偏移距离：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.slope.length,expression:"slope.length"}],staticClass:"slope-length-input",attrs:{placeholder:"默认不用填，斜线需要",type:"text",text:"name"},domProps:{value:e.slope.length},on:{input:function(t){t.target.composing||e.$set(e.slope,"length",t.target.value)}}}),i("img",{staticClass:"tip-img",attrs:{src:e.imgUrlLeftTip}})]),i("RadioGroup",{model:{value:e.slope.direction,callback:function(t){e.$set(e.slope,"direction",t)},expression:"slope.direction"}},[i("Radio",{attrs:{label:"0"}},[e._v("逆时针")]),i("Radio",{attrs:{label:"1"}},[e._v("顺时针")])],1)],1):e._e()]),i("div",{staticClass:"upload-win-footer"},[i("button",{on:{click:function(t){return e.addRoomLine(1)}}},[e._v("确定")])])]),i("Drawer",{staticClass:"addroom-child-draw",attrs:{title:"请输入向左的参数",closable:!1},model:{value:e.showLeft,callback:function(t){e.showLeft=t},expression:"showLeft"}},[i("div",{staticClass:"upload-win-content"},[i("div",{staticStyle:{"margin-bottom":"20px"}},[i("span",[e._v("实际长度：（若有倾斜角度时为垂直长度）")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.lineLength,expression:"lineLength"}],staticClass:"image-url",attrs:{placeholder:"单位cm",type:"text",text:"rightLength"},domProps:{value:e.lineLength},on:{input:function(t){t.target.composing||(e.lineLength=t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"20px"}},[i("span",[e._v("倾斜角度：")]),i("RadioGroup",{model:{value:e.hasSlope,callback:function(t){e.hasSlope=t},expression:"hasSlope"}},[i("Radio",{attrs:{label:"0"}},[e._v("无")]),i("Radio",{attrs:{label:"1"}},[e._v("有")])],1)],1),1==e.hasSlope?i("div",{staticStyle:{"margin-bottom":"20px"}},[i("div",{staticStyle:{"margin-bottom":"20px"}},[i("span",[e._v("偏移距离：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.slope.length,expression:"slope.length"}],staticClass:"slope-length-input",attrs:{placeholder:"默认不用填，斜线需要",type:"text",text:"name"},domProps:{value:e.slope.length},on:{input:function(t){t.target.composing||e.$set(e.slope,"length",t.target.value)}}}),i("img",{staticClass:"tip-img",attrs:{src:e.imgUrlRightTip}})]),i("RadioGroup",{model:{value:e.slope.direction,callback:function(t){e.$set(e.slope,"direction",t)},expression:"slope.direction"}},[i("Radio",{attrs:{label:"0"}},[e._v("逆时针")]),i("Radio",{attrs:{label:"1"}},[e._v("顺时针")])],1)],1):e._e()]),i("div",{staticClass:"upload-win-footer"},[i("button",{on:{click:function(t){return e.addRoomLine(2)}}},[e._v("确定")])])]),i("Drawer",{staticClass:"addroom-child-draw",attrs:{title:"请输入向上的参数",closable:!1},model:{value:e.showUp,callback:function(t){e.showUp=t},expression:"showUp"}},[i("div",{staticClass:"upload-win-content"},[i("div",{staticStyle:{"margin-bottom":"20px"}},[i("span",[e._v("请输入向上的参数")])]),i("div",{staticStyle:{"margin-bottom":"20px"}},[i("span",[e._v("实际长度：（若有倾斜角度时为垂直长度）")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.lineLength,expression:"lineLength"}],staticClass:"image-url",attrs:{placeholder:"单位cm",type:"text",text:"rightLength"},domProps:{value:e.lineLength},on:{input:function(t){t.target.composing||(e.lineLength=t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"20px"}},[i("span",[e._v("倾斜角度：")]),i("RadioGroup",{model:{value:e.hasSlope,callback:function(t){e.hasSlope=t},expression:"hasSlope"}},[i("Radio",{attrs:{label:"0"}},[e._v("无")]),i("Radio",{attrs:{label:"1"}},[e._v("有")])],1)],1),1==e.hasSlope?i("div",{staticStyle:{"margin-bottom":"20px"}},[i("div",{staticStyle:{"margin-bottom":"20px"}},[i("span",[e._v("偏移距离：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.slope.length,expression:"slope.length"}],staticClass:"slope-length-input",attrs:{placeholder:"默认不用填，斜线需要",type:"text",text:"name"},domProps:{value:e.slope.length},on:{input:function(t){t.target.composing||e.$set(e.slope,"length",t.target.value)}}}),i("img",{staticClass:"tip-img",attrs:{src:e.imgUrlLeftTip}})]),i("RadioGroup",{model:{value:e.slope.direction,callback:function(t){e.$set(e.slope,"direction",t)},expression:"slope.direction"}},[i("Radio",{attrs:{label:"0"}},[e._v("逆时针")]),i("Radio",{attrs:{label:"1"}},[e._v("顺时针")])],1)],1):e._e()]),i("div",{staticClass:"upload-win-footer"},[i("button",{on:{click:function(t){return e.addRoomLine(3)}}},[e._v("确定")])])])],1)},A=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{"margin-bottom":"20px","font-size":"22px","font-weight":"bold"}},[i("span",[e._v("设备搜索")])])}],O=(i("99af"),i("fb6a"),i("a434"),i("a9e3"),i("c35a"),i("25eb"),i("2ca0"),i("2909")),D=[{name:"高1",id:"GY3283832",width:50,height:50,safe:{left:50,right:100,up:50,down:100,operation:50,back:0},cost:2890,face:"1",kind:3},{name:"低1",id:"DY32838",width:60,height:60,safe:{left:50,right:130,up:50,down:100,operation:50,back:50},cost:1e4,face:"1",kind:3},{name:"高2",id:"GYXD22",width:80,height:80,safe:{left:50,right:80,up:50,down:80,operation:50,back:0},cost:12890,face:"1",kind:3},{name:"低1",id:"DY3FD23",width:90,height:90,safe:{left:50,right:150,up:50,down:120,operation:50,back:50},cost:2e4,face:"1",kind:3}],C=D,P={name:"Toolbar",data:function(){return{currentPanel:1,customize:[],showCustomize:!1,showUpload:!1,showRight:!1,showDown:!1,showLeft:!1,showUp:!1,hasSlope:"0",roomData:[],roomInput:"",roomName:"",currentScale:1,savedScale:1,lineLength:"",slope:{length:"",direction:"0"},obstacles:[],obstacle:{width:"",height:"",name:"",kind:2},showObstacleDialog:!1,showObstacleDetail:!1,facilities:[],facility:{kind:3,name:"",id:"",width:"",height:"",cost:"",safe:{up:"",right:"",down:"",left:""},face:"0"},showFacilityDialog:!1,facilityDetail:{isShow:!1,showAddButton:!1},combineDetail:{isShow:!1},serchKeyWord:"",showSearchDialog:!1,combine:{name:"",width:"",height:"",nodes:[],cost:"",safe:{up:"",right:"",down:"",left:"",operation:"",back:""}},combines:[],shape:[{id:"flowChart",header:"设备",icon:[{path:'<svg style="left: 1px; top: 1px; width: 32px; height: 30px; display: block; position: relative; overflow: hidden;"><g><g></g><g><g transform="translate(0.5,0.5)" style="visibility: visible;"><rect x="1.44" y="7.68" width="28.8" height="14.4"  fill="#ffffff" stroke="#000000" stroke-width="1.3" pointer-events="all"></rect></g></g><g></g><g></g></g></svg>',iconName:"",text:"rounded rectangle",command:"rectangle"},{path:'<svg style="left: 1px; top: 1px; width: 32px; height: 30px; display: block; position: relative; overflow: hidden;"><g><g></g><g><g transform="translate(0.5,0.5)" style="visibility: visible;"><rect x="0.73" y="7.3" width="29.2" height="14.6" fill="none" stroke="white" pointer-events="stroke" visibility="hidden" stroke-width="9"></rect><rect x="0.73" y="7.3" width="29.2" height="14.6" fill="none" stroke="none" pointer-events="all"></rect></g><g style=""><g transform="translate(7,10)scale(0.73)"><foreignObject style="overflow:visible;" pointer-events="all" width="22" height="12"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 24px; white-space: normal; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">Text</div></div></foreignObject></g></g></g><g></g><g></g></g></svg>',iconName:"",text:"text",command:"text"},{path:'<svg style="left: 1px; top: 1px; width: 32px; height: 30px; display: block; position: relative; overflow: hidden;"><g><g></g><g><g transform="translate(0.5,0.5)" style="visibility: visible;"><rect x="1.44" y="7.68" width="28.8" height="14.4" fill="#ffffff" stroke="#000000" stroke-width="1.3" pointer-events="all"></rect><path d="M 4.32 7.68 L 4.32 22.08 M 27.36 7.68 L 27.36 22.08" fill="none" stroke="white" stroke-width="9.3" stroke-miterlimit="10" pointer-events="stroke" visibility="hidden"></path><path d="M 4.32 7.68 L 4.32 22.08 M 27.36 7.68 L 27.36 22.08" fill="none" stroke="#000000" stroke-width="1.3" stroke-miterlimit="10" pointer-events="all"></path></g></g><g></g><g></g></g></svg>',iconName:"",text:"process",command:"preRect"}]}],imgUrlRight:i("859b"),imgUrlDown:i("4e4d"),imgUrlLeft:i("274b"),imgUrlUp:i("dc17"),imgUrlLeftTip:i("0878"),imgUrlRightTip:i("6e6c")}},computed:{precustomize:function(){return this.customize.slice().splice(0,100)},preObstacle:function(){return this.obstacles.slice().splice(0,100)},preFacilities:function(){var e=this.facilities;if(""===this.serchKeyWord)return e.slice();for(var t=[],i=0;i<e.length;i++)(e[i].name.startsWith(this.serchKeyWord)||e[i].id.startsWith(this.serchKeyWord))&&t.push(e[i]);return t}},mounted:function(){var e=this,t=this,i=localStorage.getItem("customize-icon"),o=localStorage.getItem("obstacles-icon"),n=localStorage.getItem("facilities-icon");try{if(i){var a=JSON.parse(i);this.customize=a}var s={width:"60",height:"30",name:"门",kind:1};s.path=this.buildPath(s);var r=o?JSON.parse(o):[];this.obstacles=[s].concat(Object(O["a"])(r));for(var c=n?JSON.parse(n):[],h=C,l=0;l<h.length;l++)h[l].path=this.buildPath(h[l]),c.push(h[l]);this.facilities=c}catch(d){window.console.log(d)}m.$on("addCombine",(function(e){var i=e.node;i.path=t.buildPath(i),t.combines.push(i),t.currentPanel="2"})),m.$on("closeCombine",(function(){e.currentScale=e.savedScale})),m.$on("deleteAll",(function(){e.currentScale=1})),m.$on("showInfoDrawWithNode",(function(i){"3"==i.node.kind&&(i.node.originData.isCombine?(Object.assign(t.combine,i.node.originData),e.combineDetail.isShow=!0):(Object.assign(t.facility,i.node.originData),e.facilityDetail.isShow=!0,e.facilityDetail.showAddButton=!1))}))},methods:{clearSearch:function(){this.serchKeyWord=""},showFacilityDetail:function(){this.facilityDetail.isShow=!this.facilityDetail.isShow,this.facilityDetail.showAddButton=!0},showCombinePanel:function(){this.currentPanel=1,this.showCombine=!this.showCombine,this.savedScale=this.currentScale,this.currentScale=1,m.$emit("showCombine",{isShow:!0})},command:function(e){this.currentPanel=e},clearRoomData:function(){this.roomData=[],this.roomInput=""},redoRoomData:function(){this.roomData.pop(),this.updateRoomInput()},addRoom:function(){if(this.roomData.length>0&&this.roomName){var e={roomName:this.roomName,roomData:this.roomData};this.customize.push(e),this.storeRoom(),this.showUpload=!1,this.showCustomize=!1,this.roomData=[],this.roomName=""}},addObstacle:function(){if(this.obstacle.width&&this.obstacle.height&&this.obstacle.name){var e=JSON.parse(JSON.stringify(this.obstacle));e.path=this.buildPath(this.obstacle),this.obstacles.push(e),this.storeObstacles(),this.showObstacleDetail=!1,this.showObstacleDialog=!1,this.obstacle.width="",this.obstacle.height="",this.obstacle.name=""}},addFacility:function(){if(this.facility.name&&this.facility.width&&this.facility.height){var e=JSON.parse(JSON.stringify(this.facility));e.path=this.buildPath(this.facility),this.facilities.push(e),this.facilityDetail.isShow=!1,this.showFacilityDialog=!1,this.clearFacility()}},clearFacility:function(){this.facility.name="",this.facility.id="",this.facility.width="",this.facility.height="",this.facility.face=0,this.facility.safe.up="",this.facility.safe.down="",this.facility.safe.left="",this.facility.safe.right="",this.facility.safe.operation="",this.facility.safe.back="",this.facility.cost=""},buildPath:function(e){var t=function(e){return e.length>10?e.slice(0,5)+"...":e},i=function(e){return e.width+" × "+e.height+" cm"},o=90,n=35,a=70;if(1===e.kind&&(n=20),2===e.kind&&(n=35),2===e.kind&&(n=35,a=55),5===e.kind&&(n=35),e){if(1===e.kind){var s='<text x="35" y="25" fill="black" font-size="16">门</text>',r='<text x="2" y="45" fill="black" font-size="16">'+i(e)+"</text>";return'<svg style="left: 1px; top: 1px; width: 100px; height: 50px; display: block; position: relative; overflow: hidden;"><g><g></g><g><g transform="translate(0.5,0.5)" style="visibility: visible;"><rect x="1.44" y="7.68" width="'+o+'" height="'+n+'"  fill="#ffffff" stroke="#000000" stroke-width="1.3" pointer-events="all"></rect>'+s+r+"</g></g><g></g><g></g></g></svg>"}var c='<text x="45" y="25" fill="black" font-size="16" style="dominant-baseline:middle;text-anchor:middle">'+t(e.name)+"</text>",h="";e.id&&(h='<text x="45" y="55" fill="black" font-size="16" style="dominant-baseline:middle;text-anchor:middle">'+t(e.id)+"</text>");var l='<text x="45" y="'+a+'" fill="black" font-size="14" style="dominant-baseline:middle;text-anchor:middle">'+i(e)+"</text>";return'<svg style="left: 1px; top: 1px; width: 100px; height: 90px; display: block; position: relative; overflow: hidden;"><g><g></g><g><g transform="translate(0.5,0.5)" style="visibility: visible;"><rect x="1.44" y="7.68" width="'+o+'" height="'+n+'"  fill="#ffffff" stroke="#000000" stroke-width="1.3" pointer-events="all"></rect>'+c+h+l+"</g></g><g></g><g></g></g></svg>"}},updateRoomInput:function(){var e=this.roomData,t="",i={0:"右",1:"下",2:"左",3:"上"};e.forEach((function(e){var o="1"===e.slopeDirection?"+":"-",n=e.hasSlope?"(偏"+o+e.slopeLength+")":"";t+=i[e.direction]+" : "+e.length+n+"    "})),this.roomInput=t},addRoomLine:function(e){""!==this.lineLength&&this.roomData.push({direction:e,length:this.lineLength,hasSlope:"1"===this.hasSlope,slopeLength:this.slope.length,slopeDirection:this.slope.direction}),this.hasSlope="0",this.slope.length="",this.lineLength="",this.showRight=!1,this.showDown=!1,this.showLeft=!1,this.showUp=!1,this.updateRoomInput()},storeRoom:function(){localStorage.setItem("customize-icon",JSON.stringify(this.customize))},storeObstacles:function(){localStorage.setItem("obstacles-icon",JSON.stringify(this.obstacles))},storeFacilities:function(){localStorage.setItem("facilities-icon",JSON.stringify(this.facilities))},removeRoom:function(e){var t=this.customize.indexOf(e);t>-1&&(this.customize.splice(t,1),this.storeRoom())},removeObstacle:function(e){var t=this.obstacles.indexOf(e);t>-1&&(this.obstacles.splice(t,1),this.storeObstacles())},removeFacility:function(e){var t=this.facilities.indexOf(e);t>-1&&(this.facilities.splice(t,1),this.storeFacilities())},getRoomScale:function(e){for(var t=0,i=e,o=i[0],n=0,a=0,s=0;s<i.length;s++)Number.parseFloat(i[s].length)>t&&(t=Number.parseFloat(i[s].length));var r=window.innerWidth-150,c=window.innerHeight-150,h=Math.min(r,c),l=t/h*1.2;return n=r/2-o.length/l/2-100,o.hasSlope&&"0"===o.slopeDirection&&(a=o.slopeLength/l),m.$emit("updateOffsetX",{x:n}),{scale:l,offSetX:n,offSetY:a}},buildRoomCommand:function(e,t){for(var i=[],o=e,n=t.scale,a=0+t.offSetX,s=50+t.offSetY,r=a,c=s,h=2,l=0;l<o.length;l++){var d={command:"line",kind:0,scale:n},u=o[l],f=u.direction,p=u.length,g=Number.parseFloat(p)/n,y={x1:r,y1:c},m={style:{text:Number.parseInt(p)+"cm",fontSize:15},command:"text",position:[0,0],draggable:!1};switch(m.style.text>=6&&(m.style.fontSize=12),d.text=g,f){case 0:if(u.hasSlope){var x=Number.parseFloat(u.slopeLength)/n,v=Math.sqrt(Math.pow(g,2)-Math.pow(x,2));y.x2=y.x1+v,"0"===u.slopeDirection?y.y2=y.y1-x:y.y2=y.y1+x}else y.x2=y.x1+g,y.y2=y.y1;m.x=(y.x1+y.x2)/2-25,m.y=(y.y1+y.y2)/2-25,d.direction=0;break;case 1:if(u.hasSlope){var w=Number.parseFloat(u.slopeLength)/n,b=Math.sqrt(Math.pow(g,2)-Math.pow(w,2));y.y2=y.y1+b,"0"===u.slopeDirection?y.x2=y.x1+w:y.x2=y.x1-w}else y.y1-=h,y.x2=y.x1;y.y2=y.y1+g+h,m.x=(y.x1+y.x2)/2+5,m.y=(y.y1+y.y2)/2,d.direction=1;break;case 2:if(u.hasSlope){var k=Number.parseFloat(u.slopeLength)/n,S=Math.sqrt(Math.pow(g,2)-Math.pow(k,2));y.x2=y.x1-S,"0"===u.slopeDirection?y.y2=y.y1+k:y.y2=y.y1-k}else y.x2=y.x1-g,y.y2=y.y1;m.x=(y.x1+y.x2)/2-25,m.y=(y.y1+y.y2)/2+5,d.direction=2;break;case 3:if(u.hasSlope){var A=Number.parseFloat(u.slopeLength)/n,O=Math.sqrt(Math.pow(g,2)-Math.pow(A,2));y.y2=y.y1-O,"0"===u.slopeDirection?y.x2=y.x1-A:y.x2=y.x1+A}else y.y1+=h,y.x2=y.x1;y.y2=y.y1-g-h,m.x=(y.x1+y.x2)/2-60,m.y=(y.y1+y.y2)/2-2,d.direction=3;break}u.hasSlope&&(d.slopeDirection=u.slopeDirection),d.shape=y,i.push(d),i.push(m),r=y.x2,c=y.y2}return i},buildObstacleCommand:function(e){if(e){var t=this.currentScale,i=Number.parseFloat(e.width)/t,o=Number.parseFloat(e.height)/t,n=e.name,a=1===e.kind?"white":"#A9C4EB",s=1===e.kind?0:1;return{style:{fill:a,stroke:"#333",lineWidth:s,text:n,textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"inside",fontSize:12,opacity:1},kind:e.kind,shape:{width:i,height:o},z:1===e.kind?999:200,draggable:!0,originData:e,command:"rectangle"}}},buildFacilityCommand:function(e){if(e){var t=this.currentScale,i=Number.parseFloat(e.width)/t,o=Number.parseFloat(e.height)/t,n=e.name,a=e.face;return{style:{fill:"#fff",stroke:"#333",lineWidth:1,text:n,textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"inside",fontSize:12,opacity:1},safe:{up:Number.parseFloat(e.safe.up),down:Number.parseFloat(e.safe.down),left:Number.parseFloat(e.safe.left),right:Number.parseFloat(e.safe.right),operation:Number.parseFloat(e.safe.operation),back:Number.parseFloat(e.safe.back)},face:a,kind:3,shape:{width:i,height:o},z:200,originData:e,draggable:!0,command:"preRect"}}},buildCombineCommand:function(e){if(e){var t=this.currentScale,i=Number.parseFloat(e.width)/t,o=Number.parseFloat(e.height)/t,n=e.name,a=e.face,s=e.alignFace,r=function(e){for(var i=[],o=0;o<e.length;o++)i.push({width:e[o].data.shape.width/t,height:e[o].data.shape.height/t,name:e[o].style.text});return i},c={up:Number.parseFloat(e.safe.up),down:Number.parseFloat(e.safe.down),left:Number.parseFloat(e.safe.left),right:Number.parseFloat(e.safe.right),operation:Number.parseFloat(e.safe.operation),back:Number.parseFloat(e.safe.back)};return{style:{fill:"#fff",stroke:"#333",lineWidth:1,text:n,textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"inside",fontSize:12,opacity:1},safe:c,face:a,alignFace:s,kind:3,shape:{width:i,height:o,nodes:r(e.nodes)},z:200,draggable:!0,originData:{name:e.name,nodes:r(e.nodes),isCombine:!0,width:e.width,height:e.height,cost:e.cost,safe:c,extrSafe:e.extrSafe},command:"combine"}}},dragstart:function(e,t){var i="";if(t.roomData){var o=this.getRoomScale(t.roomData);i=JSON.stringify(this.buildRoomCommand(t.roomData,o)),this.currentScale=o.scale}else 2===t.kind||1===t.kind?i=JSON.stringify(this.buildObstacleCommand(t)):3===t.kind?i=JSON.stringify(this.buildFacilityCommand(t)):4===t.kind?i=JSON.stringify(this.buildCombineCommand(t)):5===t.kind&&(i=JSON.stringify(this.buildCombineCommand(t)));""!==i&&e.dataTransfer.setData("addShape",i)},uploadImage:function(e){var t=e.target.files[0];if(t){var i=t.type,o=new FormData;o.append("smfile",t),["image/jpeg","image/png"].indexOf(i)>-1&&this.ajax({method:"POST",url:"https://sm.ms//api/v2/upload",body:o,succseeFn:function(e){window.console.log(e)},failFn:function(e){window.console.log(e)}})}},ajax:function(e){var t=e.method,i=e.url,o=e.body,n=e.succseeFn,a=e.failFn,s=new XMLHttpRequest;s.open(t,i,!0),s.setRequestHeader("Content-type","multipart/form-data"),s.setRequestHeader("Authorization",""),s.onreadystatechange=function(){4===s.readyState&&(s.status>=200&&s.status<300?n.call(void 0,s.responseText):s.status>=400&&a.call(void 0,s))},s.send(o)}}},T=P,E=(i("60f8"),Object(w["a"])(T,S,A,!1,null,null,null)),j=E.exports,N=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"editor",on:{dragover:e.dragover,dragstart:e.dragstart,drop:e.drop}},[i("div",{attrs:{id:"flowEditor"}}),i("Edit",{directives:[{name:"show",rawName:"v-show",value:e.editModel,expression:"editModel"}],ref:"edit",staticClass:"text-editor",style:{left:e.left+"px",top:e.top+"px","min-width":e.width+"px","min-height":e.height+"px"},on:{blurFunc:e.updateText},model:{value:e.text,callback:function(t){e.text=t},expression:"text"}}),i("div",{attrs:{id:"download-canvas"}}),i("div",[i("Combine")],1),i("Drawer",{staticClass:"facility-draw",attrs:{title:"导出设计图",closable:!1},model:{value:e.dowloadDetail.isShow,callback:function(t){e.$set(e.dowloadDetail,"isShow",t)},expression:"dowloadDetail.isShow"}},[i("div",{staticClass:"upload-win-content"},[i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("请输入项目标题：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.dowloadDetail.name,expression:"dowloadDetail.name"}],attrs:{placeholder:"",type:"text"},domProps:{value:e.dowloadDetail.name},on:{input:function(t){t.target.composing||e.$set(e.dowloadDetail,"name",t.target.value)}}})]),i("div",{staticStyle:{"margin-bottom":"10px"}},[i("span",[e._v("已用设备：")]),i("Table",{attrs:{columns:e.columns,data:e.datas}}),i("div",{staticStyle:{float:"right","font-size":"20px"}},[i("span",[e._v("总计：")]),e._v(" "),i("span",{domProps:{textContent:e._s(e.summary+"元")}})])],1)]),i("div",{staticClass:"upload-win-footer"},[i("button",{on:{click:function(t){return e.download("png")}}},[e._v("保存")])])])],1)},F=[],G=(i("a15b"),i("d3b7"),i("e25e"),i("ac1f"),i("3ca3"),i("5319"),i("1276"),i("498a"),i("ddb0"),i("2b3d"),i("a4d3"),i("4de4"),i("d81d"),i("e439"),i("dbb4"),i("acd8"),i("25f0"),i("ade3")),z=i("d4ec"),_=i("bee2"),B=i("99de"),L=i("7e84"),R=i("257e"),I=i("262e"),$=i("95c0"),M=i.n($),W=function(){function e(t){Object(z["a"])(this,e),this.limit=t||30,this.undos=[],this.redos=[],this.saveCommand=null}return Object(_["a"])(e,[{key:"execute",value:function(e){this.clearRedo(),e.execute();var t=this.undos.length;t>=this.limit&&this.undos.shift(),this.undos.push(e),this.change(e)}},{key:"undo",value:function(){if(this.canUndo()){var e=this.undos.pop();this.redos.push(e),e.undo(),this.change(e)}}},{key:"canUndo",value:function(){return this.undos.length}},{key:"redo",value:function(){if(this.canRedo()){var e=this.redos.pop();this.undos.push(e),e.redo(),this.change(e)}}},{key:"canRedo",value:function(){return this.redos.length}},{key:"save",value:function(){this.saveCommand,this.undos[this.undos.length-1]}},{key:"dirty",value:function(){return this.saveCommand!=this.undos[this.undos.length-1]}},{key:"clearRedo",value:function(){this.redos=[]}},{key:"clear",value:function(){this.undos=[],this.redos=[],this.saveCommand=null,this.change({name:"clear"})}},{key:"change",value:function(){}}]),e}(),U=W;i("cb29");function H(e,t){for(var i in e)i in t||(t[i]=e[i]);return t}var q=H,Y={getAnchors:function(){return this.anchors.slice()},getAnchorByIndex:function(e){return this.anchors.filter((function(t){return t.index==e}))[0]},active:function(){this.selected=!0,this.attr({style:{shadowColor:"yellow",shadowBlur:3}})},unactive:function(){this.selected=!1,this.attr({style:{shadowColor:"",shadowBlur:0}})},refreshEdge:function(){this.createAnchors(),this.anch&&this.anch.refresh(),this.__zr&&this.__zr.trigger("refreshEdge",{node:this})}},J=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){}}]),t}(M.a.Rect);q(Y,J.prototype);var K=J,X=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.anchors=[],i}return Object(I["a"])(t,e),t}(M.a.Line);q(Y,X.prototype);var Q=X,V=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i=t.y+t.height/2,o={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},n={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},a={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},s={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(o,n,a,s);var r=this.getPoint(t.width/4,t),c={x:t.x+3*t.width/4,y:i+r-2,index:5,node:this,direct:"right"},h={x:t.x+3*t.width/4,y:i-r+2,index:6,node:this,direct:"right"},l={x:t.x+t.width/4,y:i+r-2,index:7,node:this,direct:"left"},d={x:t.x+t.width/4,y:i-r+2,index:8,node:this,direct:"left"};this.anchors.push(c,h,l,d)}},{key:"getPoint",value:function(e,t){var i=t.width/2,o=t.height/2,n=Math.sqrt(o*o*Math.sqrt(1-e*e/(i*i)));return n}}]),t}(M.a.Ellipse);q(Y,V.prototype);var Z=V,ee=M.a.Path.extend({type:"diamond",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.height,a=t.width;e.moveTo(i+a/2,o),e.lineTo(i+a,o+n/2),e.lineTo(i+a/2,o+n),e.lineTo(i,o+n/2),e.closePath()}}),te=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){var e=new M.a.Group;this.anchors=[];var t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(ee);q(Y,te.prototype);var ie=te,oe=M.a.Path.extend({type:"parallelogram",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.height,a=t.width;e.moveTo(i+a/6,o),e.lineTo(i+a,o),e.lineTo(i+5*a/6,o+n),e.lineTo(i,o+n),e.closePath()}}),ne=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+11*t.width/12,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x+t.width/12,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(oe);q(Y,ne.prototype);var ae=ne,se=M.a.Path.extend({type:"cloud",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i,o,n=t.x,a=t.y,s=t.height,r=t.width,c=20,h=parseInt(r/c),l=parseInt(s/c);e.moveTo(n,a);for(var d=1;d<=h;d++){i=n+d*c,o=a;var u=i-c/2,f=o-c/2;e.quadraticCurveTo(u,f,i,o)}if(r%c!=0){var p=r-h*c,g=i+p/2,y=a-c/2;e.quadraticCurveTo(g,y,n+r,a)}for(var m=1;m<=l;m++){i=n+r,o=a+m*c;var x=i+c/2,v=o-c/2;e.quadraticCurveTo(x,v,i,o)}if(s%c!=0){var w=s-l*c,b=i+c/2,k=o+w/2;e.quadraticCurveTo(b,k,n+r,a+s)}for(var S=1;S<=h;S++){i=n+r-c*S,o=a+s;var A=i+c/2,O=o+c/2;e.quadraticCurveTo(A,O,i,o),e.lineTo(i,o)}if(r%c!=0){var D=r-h*c,C=i-D/2,P=o+c/2;e.quadraticCurveTo(C,P,n,a+s)}for(var T=1;T<=l;T++){i=n,o=a+s-T*c;var E=i-c/2,j=o+c/2;e.quadraticCurveTo(E,j,i,o)}if(s%c!=0){var N=s-l*c,F=i-c/2,G=o-N/2;e.quadraticCurveTo(F,G,n,a)}e.closePath()}}),re=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.antchrs=[],i.nodeType="node",i.createAntchrs(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAntchrs",value:function(){this.antchrs=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.antchrs.push(i,o,n,a)}}]),t}(se);q(Y,re.prototype);var ce=re,he=M.a.Path.extend({type:"arrowRight",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.height,a=t.width,s=parseInt(i+a-36),r=parseInt(o+n/5),c=parseInt(o+n/5*4);e.moveTo(i,r),e.lineTo(s,r),e.lineTo(s,o),e.lineTo(i+a,o+n/2),e.lineTo(s,o+n),e.lineTo(s,c),e.lineTo(i,c),e.closePath()}}),le=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){var e=new M.a.Group;this.anchors=[];var t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y+t.height/5,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height/5*4,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(he);q(Y,le.prototype);var de=le;function ue(e,t){var i,o,n,a,s,r=t.x,c=t.y,h=t.width,l=t.height,d=t.r;h<0&&(r+=h,h=-h),l<0&&(c+=l,l=-l),"number"===typeof d?i=o=n=a=d:d instanceof Array?1===d.length?i=o=n=a=d[0]:2===d.length?(i=n=d[0],o=a=d[1]):3===d.length?(i=d[0],o=a=d[1],n=d[2]):(i=d[0],o=d[1],n=d[2],a=d[3]):i=o=n=a=0,i+o>h&&(s=i+o,i*=h/s,o*=h/s),n+a>h&&(s=n+a,n*=h/s,a*=h/s),o+n>l&&(s=o+n,o*=l/s,n*=l/s),i+a>l&&(s=i+a,i*=l/s,a*=l/s),e.moveTo(r+i,c),e.lineTo(r+h-o,c),0!==o&&e.arc(r+h-o,c+o,o,-Math.PI/2,0),e.lineTo(r+h,c+l-n),0!==n&&e.arc(r+h-n,c+l-n,n,0,Math.PI/2),e.lineTo(r+a,c+l),0!==a&&e.arc(r+a,c+l-a,a,Math.PI/2,Math.PI),e.lineTo(r,c+i),0!==i&&e.arc(r+i,c+i,i,Math.PI,1.5*Math.PI)}var fe=M.a.Path.extend({type:"aroundRect",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.width,o=t.height,n=Math.max(i,o);t.r=n,ue(e,t),e.closePath()}}),pe=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(fe);q(Y,pe.prototype);var ge=pe,ye=M.a.Path.extend({type:"preRect",shape:{x:0,y:0,width:0,height:0},kind:3,alerts:[],safe:{up:0,right:150,down:0,left:100},face:"1",buildPath:function(e,t){var i=t.x,o=t.y,n=t.width,a=t.height,s=2;if(t.r=s,ue(e,t),"2"===this.face){var r=parseInt(o+a/10*9);e.moveTo(i,r),e.lineTo(i+n,r)}else if("1"===this.face){var c=parseInt(i+n/10*9);e.moveTo(c,o),e.lineTo(c,o+a)}else if("0"===this.face){var h=parseInt(o+a/10);e.moveTo(i,h),e.lineTo(i+n,h)}else{var l=parseInt(i+n/10);e.moveTo(l,o),e.lineTo(l,o+a)}e.closePath()}}),me=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){}}]),t}(ye);q(Y,me.prototype);var xe=me,ve=M.a.Path.extend({type:"combine",shape:{x:0,y:0,width:0,height:0},kind:3,alerts:[],safe:{up:0,right:150,down:0,left:100},face:"1",alignFace:"0",buildPath:function(e,t){var i=t.x,o=t.y,n=i,a=o,s=2;t.r=s;for(var r=t.nodes,c=function(e,t,i,o){if("0"===this.face){var n=parseInt(o+t.height/10);e.moveTo(i,n),e.lineTo(i+t.width,n)}else if("1"===this.face){var a=parseInt(i+t.width/10*9);e.moveTo(a,o),e.lineTo(a,o+t.height)}else if("2"===this.face){var s=parseInt(o+t.height/10*9);e.moveTo(i,s),e.lineTo(i+t.width,s)}else{var r=parseInt(i+t.width/10);e.moveTo(r,o),e.lineTo(r,o+t.height)}},h=0;h<r.length;h++)if("0"===this.alignFace){var l={width:r[h].width,height:r[h].height,x:n,y:a};ue(e,l),c.call(this,e,r[h],n,a),n+=l.width}else if("3"===this.alignFace){var d={width:r[h].width,height:r[h].height,x:n,y:a};ue(e,d),c.call(this,e,r[h],n,a),a+=d.height}else if("1"===this.alignFace){var u={width:r[h].width,height:r[h].height,x:r[h].width<t.width?n+t.width-r[h].width:n,y:a};ue(e,u),c.call(this,e,r[h],u.x,a),a+=u.height}else{var f={width:r[h].width,height:r[h].height,x:n,y:r[h].height<t.height?a+t.height-r[h].height:a};ue(e,f),c.call(this,e,r[h],n,f.y),n+=f.width}e.closePath()}}),we=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){}}]),t}(ve);q(Y,we.prototype);var be=we,ke=M.a.Path.extend({type:"document",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.width,o=t.height,n=t.x,a=t.y;e.moveTo(n,a),e.lineTo(n+i,a),e.lineTo(n+i,a+o-14),e.quadraticCurveTo(n+i/4*3,parseInt(a+o-20),n+i/2,parseInt(a+o-14)),e.quadraticCurveTo(n+i/4,a+o,n,parseInt(a+o-7)),e.lineTo(n,a),e.closePath()}}),Se=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height-10,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(ke);q(Y,Se.prototype);var Ae=Se,Oe=M.a.Path.extend({type:"delay",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.width,a=t.height,s=a/2;e.moveTo(i,o),e.lineTo(i+n-s,o),e.arc(i+n-s,o+s,s,-Math.PI/2,Math.PI/2,!1),e.lineTo(i,o+a),e.closePath()}}),De=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(Oe);q(Y,De.prototype);var Ce=De,Pe=M.a.Path.extend({type:"card",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.width,a=t.height;e.moveTo(i+15,o),e.lineTo(i+n,o),e.lineTo(i+n,o+a),e.lineTo(i,o+a),e.lineTo(i,o+15),e.closePath()}}),Te=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(Pe);q(Y,Te.prototype);var Ee=Te,je=M.a.Path.extend({type:"cylinder",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.height,a=t.width;e.moveTo(i,o+5),e.quadraticCurveTo(i+a/6,o,i+a/2,o),e.quadraticCurveTo(i+5*a/6,o,i+a,o+5),e.lineTo(i+a,o+n-5),e.quadraticCurveTo(i+5*a/6,o+n,i+a/2,o+n),e.quadraticCurveTo(i+a/6,o+n,i,o+n-5),e.closePath(),e.moveTo(i+a,o+5),e.quadraticCurveTo(i+5*a/6,o+10,i+a/2,o+10),e.quadraticCurveTo(i+a/6,o+10,i,o+5)}}),Ne=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){var e=new M.a.Group;this.anchors=[];var t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(je);q(Y,Ne.prototype);var Fe=Ne,Ge=M.a.Path.extend({type:"prepare",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.width,a=t.height;e.moveTo(i+16,o),e.lineTo(i+n-16,o),e.lineTo(i+n,o+a/2),e.lineTo(i+n-16,o+a),e.lineTo(i+16,o+a),e.lineTo(i,o+a/2),e.closePath()}}),ze=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(Ge);q(Y,ze.prototype);var _e=ze,Be=M.a.Path.extend({type:"loop",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.width,a=t.height;e.moveTo(i+16,o),e.lineTo(i+n-16,o),e.lineTo(i+n,o+16),e.lineTo(i+n,o+a),e.lineTo(i,o+a),e.lineTo(i,o+16),e.closePath()}}),Le=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(Be);q(Y,Le.prototype);var Re=Le,Ie=M.a.Path.extend({type:"perhaps",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.width,a=t.height,s=.5522848,r=i+n/2,c=o+a/2,h=n/2,l=a/2,d=h*s,u=l*s;e.moveTo(r-h,c),e.bezierCurveTo(r-h,c-u,r-d,c-l,r,c-l),e.bezierCurveTo(r+d,c-l,r+h,c-u,r+h,c),e.bezierCurveTo(r+h,c+u,r+d,c+l,r,c+l),e.bezierCurveTo(r-d,c+l,r-h,c+u,r-h,c),e.closePath(),e.moveTo(r,o),e.lineTo(r,o+a),e.moveTo(i,c),e.lineTo(i+n,c)}}),$e=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(Ie);q(Y,$e.prototype);var Me=$e,We=M.a.Path.extend({type:"contrast",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.width,a=t.height;e.moveTo(i,o),e.lineTo(i+n,o),e.lineTo(i,o+a),e.lineTo(i+n,o+a),e.closePath()}}),Ue=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(We);q(Y,Ue.prototype);var He=Ue,qe=M.a.Path.extend({type:"sort",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.width,a=t.height;e.moveTo(i+n/2,o),e.lineTo(i+n,o+a/2),e.lineTo(i+n/2,o+a),e.lineTo(i,o+a/2),e.closePath(),e.moveTo(i,o+a/2),e.lineTo(i+n,o+a/2)}}),Ye=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(qe);q(Y,Ye.prototype);var Je=Ye,Ke=M.a.Path.extend({type:"display",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.width,a=t.height,s=a/2;e.moveTo(i+16,o),e.lineTo(i+n-s,o),e.arc(i+n-s,o+s,s,-Math.PI/2,Math.PI/2,!1),e.lineTo(i+16,o+a),e.lineTo(i,o+a/2),e.closePath()}}),Xe=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(Ke);q(Y,Xe.prototype);var Qe=Xe,Ve=M.a.Path.extend({type:"store",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.width,a=t.height;e.moveTo(i,o),e.lineTo(i+n,o),e.lineTo(i+n,o+a),e.lineTo(i,o+a),e.closePath(),e.moveTo(i+10,o),e.lineTo(i+10,o+a),e.moveTo(i,o+10),e.lineTo(i+n,o+10)}}),Ze=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(Ve);q(Y,Ze.prototype);var et=Ze,tt=M.a.Path.extend({type:"manualInput",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.width,a=t.height;e.moveTo(i,o+16),e.lineTo(i+n,o),e.lineTo(i+n,o+a),e.lineTo(i,o+a),e.closePath()}}),it=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(tt);q(Y,it.prototype);var ot=it,nt=M.a.Path.extend({type:"paperBag",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.width,a=t.height;e.moveTo(i,o),e.quadraticCurveTo(i+n/4,o+10,i+n/2,o),e.quadraticCurveTo(i+3*n/4,o-10,i+n,o),e.lineTo(i+n,o+a),e.quadraticCurveTo(i+3*n/4,o+a-10,i+n/2,o+a),e.quadraticCurveTo(i+n/4,o+a+10,i,o+a),e.closePath()}}),at=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(nt);q(Y,at.prototype);var st=at,rt=M.a.Path.extend({type:"ordinaldata",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.width,a=t.height,s=.5522848,r=i+n/2,c=o+a/2,h=n/2,l=a/2,d=h*s,u=l*s;e.moveTo(r-h,c),e.bezierCurveTo(r-h,c-u,r-d,c-l,r,c-l),e.bezierCurveTo(r+d,c-l,r+h,c-u,r+h,c),e.bezierCurveTo(r+h,c+u,r+d,c+l,r,c+l),e.bezierCurveTo(r-d,c+l,r-h,c+u,r-h,c),e.closePath(),e.moveTo(r,o+a),e.lineTo(i+n,o+a)}}),ct=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(rt);q(Y,ct.prototype);var ht=ct,lt=M.a.Path.extend({type:"manualOperation",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.width,a=t.height;e.moveTo(i,o),e.lineTo(i+n,o),e.lineTo(i+n-16,o+a),e.lineTo(i+16,o+a),e.closePath()}}),dt=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(lt);q(Y,dt.prototype);var ut=dt,ft=M.a.Path.extend({type:"directData",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.width,a=t.height,s=i+n;e.moveTo(i+5,o),e.lineTo(s-5,o),e.quadraticCurveTo(s,o+a/6,s,o+a/2),e.quadraticCurveTo(s,o+5*a/6,s-5,o+a),e.lineTo(i+5,o+a),e.quadraticCurveTo(i,o+5*a/6,i,o+a/2),e.quadraticCurveTo(i,o+a/6,i+5,o),e.closePath(),e.moveTo(s-5,o+a),e.quadraticCurveTo(i+n-10,o+5*a/6,s-10,o+a/2),e.quadraticCurveTo(i+n-10,o+a/6,s-5,o)}}),pt=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(ft);q(Y,pt.prototype);var gt=pt,yt=M.a.Path.extend({type:"storeData",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.width,a=t.height;e.moveTo(i+5,o),e.lineTo(i+n-5,o),e.quadraticCurveTo(i+n-10,o+a/6,i+n-10,o+a/2),e.quadraticCurveTo(i+n-10,o+5*a/6,i+n-5,o+a),e.lineTo(i+5,o+a),e.quadraticCurveTo(i,o+5*a/6,i,o+a/2),e.quadraticCurveTo(i,o+a/6,i+5,o),e.closePath()}}),mt=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(yt);q(Y,mt.prototype);var xt=mt,vt=M.a.Path.extend({type:"parallelModel",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.width,a=t.height;e.moveTo(i,o),e.lineTo(i+n,o),e.moveTo(i,o+a),e.lineTo(i+n,o+a)}}),wt=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/4,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width/2,y:t.y,index:2,node:this,direct:"top"},n={x:t.x+3*t.width/4,y:t.y,index:3,node:this,direct:"top"},a={x:t.x,y:t.y,index:4,node:this,direct:"top"},s={x:t.x+t.width,y:t.y,index:5,node:this,direct:"top"},r={x:t.x+t.width/4,y:t.y+t.height,index:6,node:this,direct:"bottom"},c={x:t.x+t.width/2,y:t.y+t.height,index:7,node:this,direct:"bottom"},h={x:t.x+3*t.width/4,y:t.y+t.height,index:8,node:this,direct:"bottom"},l={x:t.x,y:t.y+t.height,index:9,node:this,direct:"bottom"},d={x:t.x+t.width,y:t.y+t.height,index:10,node:this,direct:"bottom"};this.anchors.push(i,o,n,s,a,r,c,h,l,d)}}]),t}(vt);q(Y,wt.prototype);var bt=wt,kt=M.a.Path.extend({type:"annotation",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.width,a=t.height;e.moveTo(i+n,o),e.lineTo(i,o),e.lineTo(i,o+a),e.lineTo(i+n,o+a)}}),St=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/4,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width/2,y:t.y,index:2,node:this,direct:"top"},n={x:t.x+3*t.width/4,y:t.y,index:3,node:this,direct:"top"},a={x:t.x+t.width/4,y:t.y+t.height,index:4,node:this,direct:"bottom"},s={x:t.x+t.width/2,y:t.y+t.height,index:5,node:this,direct:"bottom"},r={x:t.x+3*t.width/4,y:t.y+t.height,index:6,node:this,direct:"bottom"},c={x:t.x,y:t.y+t.height/4,index:7,node:this,direct:"left"},h={x:t.x,y:t.y+t.height/2,index:8,node:this,direct:"left"},l={x:t.x,y:t.y+3*t.height/4,index:9,node:this,direct:"left"};this.anchors.push(i,o,n,a,s,r,c,h,l)}}]),t}(kt);q(Y,St.prototype);var At=St,Ot=M.a.Path.extend({type:"induce",shape:{x:0,y:0,width:0,height:0,direct:"right"},buildPath:function(e,t){var i=t.x,o=t.y,n=t.width,a=t.height,s=t.direct;"right"==s?(e.moveTo(i,o+a/2),e.lineTo(i+n/2,o+a/2),e.moveTo(i+n,o),e.lineTo(i+n/2,o),e.lineTo(i+n/2,o+a),e.lineTo(i+n,o+a)):"left"==s?(e.moveTo(i,o),e.lineTo(i+n/2,o),e.lineTo(i+n/2,o+a),e.lineTo(i,o+a),e.moveTo(i+n/2,o+a/2),e.lineTo(i+n,o+a/2)):"top"==s?(e.moveTo(i,o),e.lineTo(i,o+a/2),e.lineTo(i+n,o+a/2),e.lineTo(i+n,o),e.moveTo(i+n/2,o+a/2),e.lineTo(i+n/2,o+a)):"bottom"==s&&(e.moveTo(i+n/2,o),e.lineTo(i+n/2,o+a/2),e.moveTo(i,o+a),e.lineTo(i,o+a/2),e.lineTo(i+n,o+a/2),e.lineTo(i+n,o+a))}}),Dt=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/4,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width/2,y:t.y,index:2,node:this,direct:"top"},n={x:t.x+3*t.width/4,y:t.y,index:3,node:this,direct:"top"},a={x:t.x+t.width/4,y:t.y+t.height,index:4,node:this,direct:"bottom"},s={x:t.x+t.width/2,y:t.y+t.height,index:5,node:this,direct:"bottom"},r={x:t.x+3*t.width/4,y:t.y+t.height,index:6,node:this,direct:"bottom"},c={x:t.x,y:t.y+t.height/4,index:7,node:this,direct:"left"},h={x:t.x,y:t.y+t.height/2,index:8,node:this,direct:"left"},l={x:t.x,y:t.y+3*t.height/4,index:9,node:this,direct:"left"};this.anchors.push(i,o,n,a,s,r,c,h,l)}}]),t}(Ot);q(Y,Dt.prototype);var Ct=Dt,Pt=M.a.Path.extend({type:"multidocument",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.width,o=t.height,n=t.x,a=t.y;Et(e,n+8,a,i-8,o-22),Et(e,n+4,a+4,i-8,o-22),Tt(e,n,a+8,i-8,o-8)}});function Tt(e,t,i,o,n){e.moveTo(t,i),e.lineTo(t+o,i),e.lineTo(t+o,i+n-14),e.quadraticCurveTo(t+o/4*3,parseInt(i+n-20),t+o/2,parseInt(i+n-14)),e.quadraticCurveTo(t+o/4,i+n,t,parseInt(i+n-7)),e.lineTo(t,i),e.closePath()}function Et(e,t,i,o,n){e.moveTo(t,i),e.lineTo(t+o,i),e.lineTo(t+o,i+n),e.lineTo(t+o-4,i+n),e.lineTo(t+o-4,i+4),e.lineTo(t,i+4),e.closePath()}var jt=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height-10,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(Pt);q(Y,jt.prototype);var Nt=jt,Ft=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){}}]),t}(M.a.Text);q(Y,Ft.prototype);var Gt=Ft,zt=M.a.Path.extend({type:"processBar",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var i=t.x,o=t.y,n=t.height,a=t.width;e.moveTo(i,o),e.lineTo(i+a-20,o),e.lineTo(i+a,o+n/2),e.lineTo(i+a-20,o+n),e.lineTo(i,o+n),e.lineTo(i+20,o+n/2),e.closePath()}}),_t=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){var e=new M.a.Group;this.anchors=[];var t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(zt);q(Y,_t.prototype);var Bt=_t,Lt=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,e)),i.data=e,i.oldfill=i.data.style.fill,i.anchors=[],i.nodeType="node",i.createAnchors(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"createAnchors",value:function(){this.anchors=[];var e=new M.a.Group,t=e.getBoundingRect([this]),i={x:t.x+t.width/2,y:t.y,index:1,node:this,direct:"top"},o={x:t.x+t.width,y:t.y+t.height/2,index:2,node:this,direct:"right"},n={x:t.x+t.width/2,y:t.y+t.height,index:3,node:this,direct:"bottom"},a={x:t.x,y:t.y+t.height/2,index:4,node:this,direct:"left"};this.anchors.push(i,o,n,a)}}]),t}(M.a.Image);q(Y,Lt.prototype);var Rt=Lt,It=M.a.Path.extend({type:"polyLine",shape:{points:[]},style:{fill:null},buildPath:function(e,t){var i=t.points;if(i&&i.length>=2){e.moveTo(i[0][0],i[0][1]);for(var o=1,n=i.length;o<n;o++)e.lineTo(i[o][0],i[o][1])}}}),$t=It,Mt=function(){function e(t){Object(z["a"])(this,e),this.node=t,this.bars=[],this.create()}return Object(_["a"])(e,[{key:"create",value:function(){var e=this,t=this.node.getAnchors();t.forEach((function(t){var i=new M.a.Circle({style:{fill:"#fff",stroke:"rgb(0,181,237)",lineWidth:1},shape:{cx:t.x,cy:t.y,r:3},cursor:"crosshair",z:30001});i.point=t,i.mark="anch",i.node=e.node,t.anch=i,i.on("mouseover",(function(){i.oldfill=i.style.fill,i.setStyle("fill","rgb(0,181,237)"),e.node.time&&clearTimeout(e.node.time),e.show()})),i.on("mouseout",(function(){i.setStyle("fill",i.oldfill),e.hide()})),i.on("mousedown",(function(){i.setStyle("fill","rgb(0,181,237)")})),e.bars.push(i)}))}},{key:"getBarByIndex",value:function(e){return this.bars.filter((function(t){return t.point.index==e}))[0]}},{key:"show",value:function(){this.bars.forEach((function(e){e.show()}))}},{key:"hide",value:function(){this.bars.forEach((function(e){e.hide()}))}},{key:"refresh",value:function(){var e=this;this.bars.forEach((function(t){var i=e.node.getAnchorByIndex(t.point.index);t.attr({shape:{cx:i.x,cy:i.y}}),t.point=i}))}}]),e}(),Wt=Mt;function Ut(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function Ht(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ut(Object(i),!0).forEach((function(t){Object(G["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ut(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var qt={common:{style:{fill:"#fff",stroke:"#333",lineWidth:1,text:"title",textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"inside",fontSize:12,opacity:1},shape:{x:0,y:0,width:100,height:40,r:[3]},z:10,draggable:!0},rectangle:{style:{fill:"#fff",stroke:"#333",lineWidth:1,text:"变电箱",textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"inside",fontSize:12,opacity:1},shape:{x:0,y:0,width:100,height:80},z:200,draggable:!0},room:{style:{fill:"#fff",stroke:"#333",lineWidth:3,textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"inside",fontSize:12,opacity:1},shape:{x:0,y:0,width:600,height:600,r:[0]},z:100,draggable:!0},line:{style:{fill:"#fff",stroke:"#333",lineWidth:4,textFill:"#333",fontWeight:"normal",fontStyle:"",fontSize:12,opacity:1},shape:{x1:0,y1:0,x2:500,y2:500,smooth:.8},z:100,draggable:!1},polyLine:{style:{fill:"#fff",stroke:"#333",lineWidth:5,textFill:"#333",fontWeight:"normal",fontStyle:"",fontSize:12,opacity:1},point:[[20,20],[20,100],[100,100],[100,20],[20,20]],z:100,draggable:!1},cloud:{style:{fill:"#fff",stroke:"#333",lineWidth:1,text:"title",textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"inside",fontSize:12,textAlign:"left"},shape:{x:0,y:0,width:100,height:40},z:10,draggable:!0},diamond:{style:{fill:"#fff",stroke:"#333",lineWidth:1,text:"title",textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"inside",fontSize:12},shape:{x:0,y:0,width:100,height:60},z:10,draggable:!0},parallelogram:{style:{fill:"#fff",stroke:"#333",lineWidth:1,text:"title",textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"inside",fontSize:12},shape:{x:0,y:0,width:100,height:40},z:10,draggable:!0},circular:{style:{fill:"#fff",stroke:"#333",lineWidth:1,text:"title",textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"inside",fontSize:12},shape:{cx:0,cy:0,rx:40,ry:40},z:10,draggable:!0},arrowRight:{style:{fill:"#fff",stroke:"#333",lineWidth:1,text:"title",textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"inside",fontSize:12},shape:{x:0,y:0,width:100,height:50},z:10,draggable:!0},document:{style:{fill:"#fff",stroke:"#333",lineWidth:1,text:"title",textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"inside",fontSize:12,textOffset:[0,-4]},shape:{x:0,y:0,width:100,height:60},z:10,draggable:!0},cylinder:{style:{fill:"#fff",stroke:"#333",lineWidth:1,text:"title",textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"inside",fontSize:12},shape:{x:0,y:0,width:100,height:40},z:10,draggable:!0},loop:{style:{fill:"#fff",stroke:"#333",lineWidth:1,text:"title",textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"inside",fontSize:12},shape:{x:0,y:0,width:100,height:50},z:10,draggable:!0},perhaps:{style:{fill:"#fff",stroke:"#333",lineWidth:1,text:"title",textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"bottom",fontSize:12},shape:{x:0,y:0,width:30,height:30},z:10,draggable:!0},contrast:{style:{fill:"#fff",stroke:"#333",lineWidth:1,text:"title",textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"bottom",fontSize:12},shape:{x:0,y:0,width:40,height:30},z:10,draggable:!0},sort:{style:{fill:"#fff",stroke:"#333",lineWidth:1,text:"title",textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"bottom",fontSize:12},shape:{x:0,y:0,width:40,height:40},z:10,draggable:!0},ordinaldata:{style:{fill:"#fff",stroke:"#333",lineWidth:1,text:"title",textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"inside",fontSize:12},shape:{x:0,y:0,width:60,height:60},z:10,draggable:!0},parallelModel:{style:{fill:"#fff",stroke:"#333",lineWidth:1,text:"",textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"inside",fontSize:12},shape:{x:0,y:0,width:100,height:30},z:10,draggable:!0},annotation:{style:{fill:"#fff",stroke:"#333",lineWidth:1,text:"",textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"inside",fontSize:12,lineDash:[6,4]},shape:{x:0,y:0,width:60,height:100},z:10,draggable:!0},induce:{style:{fill:"#fff",stroke:"#333",lineWidth:1,text:"",textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"inside",fontSize:12},shape:{x:0,y:0,width:60,height:100,direct:"right"},z:10,draggable:!0},multidocument:{style:{fill:"#fff",stroke:"#333",lineWidth:1,text:"",textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"inside",fontSize:12},shape:{x:0,y:0,width:100,height:80},z:10,draggable:!0},store:{style:{fill:"#fff",stroke:"#333",lineWidth:1,text:"",textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"inside",fontSize:12},shape:{x:0,y:0,width:60,height:60},z:10,draggable:!0},image:{style:{fill:"#fff",stroke:"#333",lineWidth:1,image:"",text:"",textFill:"#333",fontWeight:"normal",fontStyle:"",textPosition:"bottom",fontSize:12,x:0,y:0,width:60,height:60},draggable:!0}},Yt={rectangle:K,room:K,line:Q,polyLine:$t,circular:Z,diamond:ie,parallelogram:ae,cloud:ce,arrowRight:de,roundRect:ge,preRect:xe,combine:be,document:Ae,delay:Ce,card:Ee,cylinder:Fe,prepare:_e,loop:Re,perhaps:Me,contrast:He,sort:Je,display:Qe,store:et,manualInput:ot,paperBag:st,ordinaldata:ht,manualOperation:ut,directData:gt,storeData:xt,parallelModel:bt,annotation:At,induce:Ct,multidocument:Nt,text:Gt,processBar:Bt,image:Rt},Jt={addShape:function(e,t){Yt[e]=t},removeShape:function(e){delete Yt[e]},getShape:function(e,t,i){var o=M.a.util.clone(qt[e]||qt.common);o.z=200,o.position=[t.x,t.y],o.command=e,t.image&&(o.style.image=t.image),t.style&&(o.style=Ht({},o.style,{},M.a.util.clone(t.style),{},{transformText:!0})),t.shape&&(o.shape=Ht({},o.shape,{},M.a.util.clone(t.shape))),void 0!==t.draggable&&(o.draggable=t.draggable),void 0!==t.direction&&(o.direction=t.direction),void 0!==t.kind&&(o.kind=t.kind),void 0!==t.scale&&(o.scale=t.scale),void 0!==t.safe&&(o.safe=t.safe),void 0!==t.face&&(o.face=t.face),void 0!==t.alignFace&&(o.alignFace=t.alignFace),void 0!==t.originData&&(o.originData=t.originData),void 0!==t.slopeDirection&&(o.slopeDirection=t.slopeDirection),void 0!==t.z&&(o.z=t.z);var n=new Yt[e](o);if(n.getData=function(){var e={type:this.type,style:M.a.util.clone(this.style),z:this.oldz,command:this.data.command,id:this.data.id||this.id,position:this.position.slice(),draggable:!0};return"image"!=this.type&&(e.shape=M.a.util.clone(this.shape)),e},n.setData=function(e){this.data=Ht({},this.data,{},M.a.util.clone(e)),this.attr(this.data),this.oldz=this.data.z},n.getId=function(){return this.data.id||this.id},n.getAnchByIndex=function(e){if(this.anch)return this.anch.getBarByIndex(e)},!i){var a=new Wt(n);n.anch=a,n.refresh=function(){this.refreshEdge()},n.setShadow=function(){this.attr({style:{shadowBlur:6,shadowColor:"#ccc"}})},n.cancelShadow=function(){this.attr({style:{shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0}})},n.on("mouseover",(function(){this.dragging||this.anch.show(),this.oldz=this.z,this.attr({z:800})})),n.on("mouseout",(function(){this.attr({z:this.oldz})})),n.on("click",(function(){this.__zr&&this.__zr.trigger("selectNode",{node:this})})),n.on("dragstart",(function(){this.oldPos=this.position.slice()})),n.on("drag",(function(){this.refreshEdge(),this.anch.hide(),this.__zr&&this.__zr.trigger("hideFrame")})),n.on("dragend",(function(){if(this.createAnchors(),this.anch.refresh(),this.__zr&&this.__zr.trigger("refreshSelectGroup"),this.nodeGroup)if(this.groupTimeout)clearTimeout(this.groupTimeout);else if(this.leaveGroup)return this.__zr.trigger("removeNodeFromGroup",{node:this}),void(this.leaveGroup=!1);this.addToNodeGroup||this.__zr&&this.__zr.trigger("moveNode",{node:this})})),n.on("dblclick",(function(){this.__zr&&this.__zr.trigger("edit",{status:"editNode",node:this,text:this.style.text})}))}return n},hasShape:function(e){return!!Yt[e]}},Kt=function(){function e(t){Object(z["a"])(this,e),this.name=t}return Object(_["a"])(e,[{key:"execute",value:function(){}},{key:"undo",value:function(){}},{key:"redo",value:function(){this.execute()}}]),e}(),Xt=Kt;function Qt(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function Vt(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Qt(Object(i),!0).forEach((function(t){Object(G["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Qt(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var Zt=function(e){function t(e,i){var o;return Object(z["a"])(this,t),o=Object(B["a"])(this,Object(L["a"])(t).call(this,"addShape")),o.nodes=e,o.editor=i,o}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"execute",value:function(){var e=this;this.nodes.forEach((function(t){e.editor.addNode(t)}))}},{key:"undo",value:function(){var e=this;this.nodes.forEach((function(t){e.editor.removeNode(t)}))}}]),t}(Xt),ei=function(e){function t(e,i){var o;return Object(z["a"])(this,t),o=Object(B["a"])(this,Object(L["a"])(t).call(this,"RemoveShape")),o.nodes=e,o.editor=i,o.edges=o.getEdges(),o}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"getEdges",value:function(){var e=this,t=[];return this.nodes.forEach((function(i){var o=e.editor.getEdgesByNode(i);o.forEach((function(e){-1==t.indexOf(e)&&t.push(e)}))})),t}},{key:"execute",value:function(){var e=this;this.edges.forEach((function(t){e.editor.removeEdge(t)})),this.nodes.forEach((function(t){if(t.nodeGroup){var i=t.nodeGroup;t.oldRemoveGroup=i,i.removeNode(t),i.refresh()}e.editor.removeNode(t)})),this.editor.frame.hide()}},{key:"undo",value:function(){var e=this;this.edges.forEach((function(t){e.editor.addEdge(t),e.editor.add(t)})),this.nodes.forEach((function(t){e.editor.addNode(t),t.oldRemoveGroup&&(t.oldRemoveGroup.addNode(t),t.nodeGroup.refresh(),t.oldRemoveGroup=null)}))}}]),t}(Xt),ti=function(e){function t(e,i,o){var n;return Object(z["a"])(this,t),n=Object(B["a"])(this,Object(L["a"])(t).call(this,"movePos")),n.item=e,n.oldPos=i.slice(),n.newPos=o.slice(),n.isExec=!0,n}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"execute",value:function(){this.isExec||(this.item.attr({position:this.newPos.slice()}),this.isExec=!0,this.item.refreshEdge())}},{key:"undo",value:function(){this.item.attr({position:this.oldPos.slice()}),this.isExec=!1,this.item.refreshEdge()}},{key:"refreshGroup",value:function(){"group"==this.item.nodeType&&this.item.refresh(),this.item.nodeGroup&&this.item.nodeGroup.refresh()}}]),t}(Xt),ii=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,"manyCmd")),i.cmds=e,i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"execute",value:function(){this.cmds.forEach((function(e){e.execute(),"movePos"==e.name&&(e.refreshEdge&&e.refreshEdge(),e.refreshGroup())}))}},{key:"undo",value:function(){this.cmds.forEach((function(e){e.undo(),"movePos"==e.name&&(e.refreshEdge&&e.refreshEdge(),e.refreshGroup())}))}}]),t}(Xt),oi=function(e){function t(e,i){var o;return Object(z["a"])(this,t),o=Object(B["a"])(this,Object(L["a"])(t).call(this,"addedge")),o.edge=e,o.editor=i,o}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"execute",value:function(){this.editor.addEdge(this.edge)}},{key:"undo",value:function(){this.editor.removeEdge(this.edge)}}]),t}(Xt),ni=function(e){function t(e,i){var o;return Object(z["a"])(this,t),o=Object(B["a"])(this,Object(L["a"])(t).call(this,"removeEdge")),o.edge=e,o.editor=i,o}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"execute",value:function(){this.editor.removeEdge(this.edge)}},{key:"undo",value:function(){this.editor.addEdge(this.edge)}}]),t}(Xt),ai=function(e){function t(e,i,o){var n;return Object(z["a"])(this,t),n=Object(B["a"])(this,Object(L["a"])(t).call(this,"createGroup")),n.group=e,n.topGroup=i,n.editor=o,n}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"execute",value:function(){var e=this;this.topGroup&&(this.topGroup.redoGroup(),this.editor.addGroup(this.topGroup),this.topGroup.addNode(this.group),this.group.nodes.forEach((function(t){var i=e.topGroup.nodes,o=i.indexOf(t);i.splice(o,1)}))),this.editor.addGroup(this.group),this.group.redoGroup()}},{key:"undo",value:function(){this.topGroup&&(this.topGroup.cancelGroup(),this.editor.removeGroup(this.topGroup)),this.group.cancelGroup(),this.editor.removeGroup(this.group)}}]),t}(Xt),si=function(e){function t(e,i){var o;return Object(z["a"])(this,t),o=Object(B["a"])(this,Object(L["a"])(t).call(this,"cancelGroup")),o.group=e,o.editor=i,o.topGroup=e.topGroup,o.edges=i.getEdgesByGroup(e),o}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"execute",value:function(){var e=this;this.editor.removeGroup(this.group),this.topGroup&&this.topGroup.removeNode(this.group),this.group.nodes.forEach((function(t){e.topGroup?("group"==t.nodeType?t.topGroup=e.topGroup:t.nodeGroup=e.topGroup,e.topGroup.addNode(t)):"group"==t.nodeType?t.topGroup=null:t.nodeGroup=null})),this.edges.forEach((function(t){e.editor.removeEdge(t)}))}},{key:"undo",value:function(){var e=this;this.editor.addGroup(this.group),this.group.topGroup=this.topGroup,this.group.nodes.forEach((function(t){e.topGroup&&e.topGroup.removeNode(t),"group"==t.nodeType?t.topGroup=e.group:t.nodeGroup=e.group})),this.topGroup&&this.topGroup.addNode(this.group),this.edges.forEach((function(t){e.editor.addEdge(t)}))}}]),t}(Xt),ri=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,"removeNodeFromGroup")),i.node=e,i.group=i.node.nodeGroup,i.oldPos=i.node.oldPos.slice(),i.newPos=i.node.position.slice(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"execute",value:function(){this.node.attr({position:[this.newPos[0],this.newPos[1]]}),this.group.removeNode(this.node),this.node.refreshEdge()}},{key:"undo",value:function(){this.node.attr({position:[this.oldPos[0],this.oldPos[1]]}),this.group.addNode(this.node),this.node.refreshEdge()}}]),t}(Xt),ci=function(e){function t(e,i){var o;return Object(z["a"])(this,t),o=Object(B["a"])(this,Object(L["a"])(t).call(this,"addNodeToGroup")),o.node=e,o.oldGroup=e.nodeGroup,o.newGroup=i,o.oldPos=e.oldPos.slice(),o.newPos=e.position.slice(),o}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"execute",value:function(){this.oldGroup&&(this.oldGroup.removeNode(this.node),this.node.groupTimeout&&(clearTimeout(this.node.groupTimeout),this.node.groupTimeout=null)),this.node.attr({position:this.newPos.slice()}),this.newGroup.addNode(this.node),this.node.refreshEdge()}},{key:"undo",value:function(){this.newGroup.removeNode(this.node),this.oldGroup&&(this.node.attr({position:this.oldPos.slice()}),this.oldGroup.addNode(this.node)),this.node.attr({position:this.oldPos.slice()}),this.node.refreshEdge()}}]),t}(Xt),hi=function(e){function t(e,i,o){var n;return Object(z["a"])(this,t),n=Object(B["a"])(this,Object(L["a"])(t).call(this,"changeNode")),n.node=e,n.oldData=i,n.newData=o,n}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"execute",value:function(){this.node.setData(this.newData),this.node.refresh()}},{key:"undo",value:function(){this.node.setData(this.oldData),this.node.refresh()}}]),t}(Xt),li=function(e){function t(e,i,o,n){var a;return Object(z["a"])(this,t),a=Object(B["a"])(this,Object(L["a"])(t).call(this,"changeGroup")),a.group=e,a.oldData=i,a.newData=o,a.mark=n,a}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"execute",value:function(){"head"==this.mark?this.group.setHeadStyle(this.newData):this.group.setGroupStyle(this.newData)}},{key:"undo",value:function(){"head"==this.mark?this.group.setHeadStyle(this.oldData):this.group.setGroupStyle(this.oldData)}}]),t}(Xt),di=function(e){function t(e){var i;return Object(z["a"])(this,t),i=Object(B["a"])(this,Object(L["a"])(t).call(this,"removeGroup")),i.group=e,i.topGroup=i.group.topGroup,i.allItems=i.group.getAllItems(),i.editor=i.group.editor,i.edges=i.getAllEdges(),i}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"getAllEdges",value:function(){var e=this,t=this.editor.getAllEdgesByGroup(this.group);return this.allItems.forEach((function(i){if("node"==i.nodeType){var o=e.editor.getEdgesByNode(i);o.forEach((function(e){-1==t.indexOf(e)&&t.push(e)}))}})),t}},{key:"execute",value:function(){var e=this;this.group.editor.removeGroup(this.group),this.allItems.forEach((function(t){"node"==t.nodeType?e.editor.removeNode(t):"group"==t.nodeType&&e.editor.removeGroup(t)})),this.edges.forEach((function(t){e.editor.removeEdge(t)})),this.topGroup&&this.topGroup.removeNode(this.group)}},{key:"undo",value:function(){var e=this;this.editor.addGroup(this.group),this.allItems.forEach((function(t){"node"==t.nodeType?e.editor.addNode(t):"group"==t.nodeType&&e.editor.addGroup(t)})),this.edges.forEach((function(t){e.editor.addEdge(t),e.editor.add(t)})),this.group.refresh(),this.topGroup&&(this.topGroup.addNode(this.group),this.group.topGroup=this.topGroup)}}]),t}(Xt),ui=function(e){function t(e,i){var o;return Object(z["a"])(this,t),o=Object(B["a"])(this,Object(L["a"])(t).call(this,"changeGroupHead")),o.group=e,o.showHead=i,o}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"execute",value:function(){this.group.changeHead(this.showHead)}},{key:"undo",value:function(){this.group.changeHead(!this.showHead)}}]),t}(Xt),fi=function(e){function t(e,i,o){var n;return Object(z["a"])(this,t),n=Object(B["a"])(this,Object(L["a"])(t).call(this,"changeEdge")),n.edge=e,n.oldData=i,n.newData=o,n.edge.unactive(),n}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"execute",value:function(){this.edge.setData(this.newData)}},{key:"undo",value:function(){this.edge.setData(this.oldData)}}]),t}(Xt),pi=function(e){function t(e,i,o){var n;return Object(z["a"])(this,t),n=Object(B["a"])(this,Object(L["a"])(t).call(this,"changeEdgeText")),n.edge=e,n.oldText=i,n.newText=o,n}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"execute",value:function(){this.edge.setText(this.newText)}},{key:"undo",value:function(){this.edge.setText(this.oldText)}}]),t}(Xt),gi=function(e){function t(e,i){var o;return Object(z["a"])(this,t),o=Object(B["a"])(this,Object(L["a"])(t).call(this,"changeEdge")),o.edge=e,o.data=i,o.edge.unactive(),o}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"execute",value:function(){"anch"==this.data.mark?"from"==this.data.position?(this.data.newCenter&&this.edge.setFromPoint(Vt({},this.data.newCenter),!0),this.data.newNode&&(this.edge.setFromNode(this.data.newNode),this.edge.setFromAnch(this.data.newAnch))):(this.data.newCenter&&this.edge.setToPoint(Vt({},this.data.newCenter),!0),this.data.newNode&&(this.edge.setToNode(this.data.newNode),this.edge.setToAnch(this.data.newAnch))):"point"==this.data.mark&&("from"==this.data.position?(this.edge.setFromPoint({x:this.data.newCenter.x,y:this.data.newCenter.y},!0),this.data.newNode&&(this.edge.setFromNode(this.data.newNode),this.edge.setFromAnch(this.data.newAnch))):(this.edge.setToPoint({x:this.data.newCenter.x,y:this.data.newCenter.y}),this.data.newNode&&(this.edge.setToNode(this.data.newNode),this.edge.setToAnch(this.data.newAnch))))}},{key:"undo",value:function(){"anch"==this.data.mark?"from"==this.data.position?(this.data.oldCenter&&this.edge.setFromPoint(Vt({},this.data.oldCenter),!0),this.data.oldNode&&(this.edge.setFromNode(this.data.oldNode),this.edge.setFromAnch(this.data.oldAnch))):(this.data.oldCenter&&this.edge.setToPoint(Vt({},this.data.oldCenter),!0),this.data.oldNode&&(this.edge.setToNode(this.data.oldNode),this.edge.setToAnch(this.data.oldAnch))):"point"==this.data.mark&&("from"==this.data.position?(this.edge.setFromPoint({x:this.data.oldCenter.x,y:this.data.oldCenter.y},!0),this.data.newNode&&this.edge.removeFromNode()):(this.edge.setToPoint({x:this.data.oldCenter.x,y:this.data.oldCenter.y}),this.data.newNode&&this.edge.removeToNode()))}}]),t}(Xt),yi=function(){function e(t){Object(z["a"])(this,e),this.editor=t,this.w=6,this.isShow=!0,this.createBar(),this.initEvent(),this.hide()}return Object(_["a"])(e,[{key:"addTo",value:function(e){this.zr=e,e.add(this.lefttopbar),e.add(this.leftbottombar),e.add(this.righttopbar),e.add(this.rightbottombar),e.add(this.frame)}},{key:"createBar",value:function(){var e=this.w;this.frame=new M.a.Rect({style:{fill:"transparent"}}),this.lefttopbar=new M.a.Rect({style:{fill:"#fff",stroke:"red",lineWidth:1},shape:{width:e,height:e},draggable:!0,cursor:"nw-resize",z:30001}),this.righttopbar=new M.a.Rect({style:{fill:"#fff",stroke:"red",lineWidth:1},shape:{width:e,height:e},draggable:!0,cursor:"ne-resize",z:30001}),this.leftbottombar=new M.a.Rect({style:{fill:"#fff",stroke:"red",lineWidth:1},shape:{width:e,height:e},draggable:!0,cursor:"sw-resize",z:30001}),this.rightbottombar=new M.a.Rect({style:{fill:"#fff",stroke:"red",lineWidth:1},shape:{width:e,height:e},draggable:!0,cursor:"se-resize",z:30001}),this.hide()}},{key:"hide",value:function(){this.isShow&&(this.lefttopbar.hide(),this.leftbottombar.hide(),this.righttopbar.hide(),this.rightbottombar.hide(),this.frame.hide(),this.isShow=!1)}},{key:"show",value:function(){this.isShow||(this.lefttopbar.show(),this.leftbottombar.show(),this.righttopbar.show(),this.rightbottombar.show(),this.frame.show(),this.isShow=!0)}},{key:"boxSelect",value:function(e,t){this.boxItem=t,e.x=parseInt(e.x)+.5,e.y=parseInt(e.y)+.5,e.width=e.width-1,e.height=e.height-1,this.box=e,this.frame.attr({position:[e.x,e.y],style:{stroke:"red",lineWidth:1},shape:{x:0,y:0,width:e.width,height:e.height}}),this.show()}},{key:"refreshBar",value:function(){var e=this.w;this.lefttopbar.attr({position:[this.box.x,this.box.y],shape:{x:-e/2,y:-e/2}}),this.righttopbar.attr({position:[this.box.x+this.box.width,this.box.y],shape:{x:-e/2,y:-e/2}}),this.leftbottombar.attr({position:[this.box.x,this.box.y+this.box.height],shape:{x:-e/2,y:-e/2}}),this.rightbottombar.attr({position:[this.box.x+this.box.width,this.box.y+this.box.height],shape:{x:-e/2,y:-e/2}})}},{key:"refreshGroup",value:function(){var e=this.box,t=this.boxItem.position.slice();if("ellipse"==this.boxItem.type){var i=e.width/2,o=e.height/2,n=e.x+i,a=e.y+o;this.boxItem.attr({shape:{cx:n-t[0],cy:a-t[1],rx:i,ry:o}})}else"image"==this.boxItem.type?this.boxItem.attr({position:[e.x,e.y],style:{width:e.width,height:e.height}}):this.boxItem.attr({position:[e.x,e.y],shape:{x:0,y:0,width:e.width,height:e.height}})}},{key:"initEvent",value:function(){var e,t,i,o,n,a,s,r=this,c=this,h=!1,l=[this.lefttopbar,this.leftbottombar,this.righttopbar,this.rightbottombar];l.forEach((function(r,l){r.on("dragstart",(function(r){o=c.box.x,n=c.box.y,a=c.box.width,s=c.box.height,h=!0,e=r.offsetX,t=r.offsetY,i=c.boxItem.getData(),c.editor.status="resizeNode"})),r.on("drag",(function(i){if(h){var r=i.offsetX-e,d=i.offsetY-t;0==l?(c.box.x=o+r,c.box.y=n+d,c.box.width=a-r,c.box.height=s-d):1==l?(c.box.x=o+r,c.box.y=n,c.box.width=a-r,c.box.height=s+d):2==l?(c.box.x=o,c.box.y=n+d,c.box.width=a+r,c.box.height=s-d):(c.box.x=o,c.box.y=n,c.box.width=a+r,c.box.height=s+d),c.refreshGroup(),c.boxSelect(c.box,c.boxItem),c.refreshBar(),c.boxItem.refreshEdge(),c.boxItem.nodeGroup&&c.boxItem.nodeGroup.refresh()}})),r.on("dragend",(function(){this.__zr&&this.__zr.trigger("resizeNode",{oldData:i}),h=!1,c.editor.status=""}))})),document.addEventListener("mouseup",(function(){h&&(h=!1,r.editor.status="")}))}}]),e}(),mi=yi,xi=i("3835"),vi=(i("7db0"),function(e,t){return[e[0]+t[0],e[1]+t[1]]}),wi=function(e,t){return[e[0]*t,e[1]*t]},bi=function(e,t){return[t[0]-e[0],t[1]-e[1]]},ki=function(e,t){return e[0]*t[1]-e[1]*t[0]===0},Si=function(e,t){return e[0]*t[0]+e[1]*t[1]},Ai=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return[e[0]/t,e[1]/t]};function Oi(e){var t=e.entryPoint,i=void 0===t?[0,0]:t,o=e.entryDirection,n=void 0===o?[0,1]:o,a=e.entryExt,s=void 0===a?10:a,r=e.exitPoint,c=void 0===r?[10,10]:r,h=e.exitDirection,l=void 0===h?[1,0]:h,d=e.exitExt,u=void 0===d?10:d,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;if(null===l||"0,0"==l.join()){var p=bi(c,i);l=Math.abs(p[0])>Math.abs(p[1])?[p[0]/Math.abs(p[0]),0]:[0,p[1]/Math.abs(p[1])]}var g=vi(i,wi(n,s)),y=vi(c,wi(l,u));l=wi(l,-1);var m,x,v=[y[0]-g[0],0],w=[0,y[1]-g[1]],b=[v,w],k=b.find((function(e){return ki(e,n)}));m=Si(k,n)>0?k:Di(b,k);var S=b.find((function(e){return ki(e,l)}));x=Si(S,l)>0?S:Di(b,S);var A=Si(m,x)>0?2:1,O=Di(b,x),D=[];if(D.push({position:i,direction:null},{position:g,direction:n}),1==A){var C=vi(g,m),P=Ci(m),T=vi(C,x),E=Ci(x);D.push({position:C,direction:P},{position:T,direction:E})}else{var j=vi(g,wi(m,f)),N=Ci(m),F=vi(j,O),G=Ci(O),z=vi(F,wi(x,1-f)),_=Ci(x);D.push({position:j,direction:N},{position:F,direction:G,type:"pathMiddleP"},{position:z,direction:_})}return D.push({position:c,direction:l}),D.filter((function(e){return!1!==e.direction}))}function Di(e,t){return e.find((function(e){return e!=t}))}function Ci(e){return(0!=e[0]||0!=e[1])&&(0==e[0]?[0,e[1]/Math.abs(e[1])]:0==e[1]?[e[0]/Math.abs(e[0]),0]:Ai(e))}var Pi=Oi;function Ti(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function Ei(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ti(Object(i),!0).forEach((function(t){Object(G["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ti(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var ji=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#666",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#666",r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"#fff",c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"polyline",h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"solid";return Object(z["a"])(this,t),e=Object(B["a"])(this,Object(L["a"])(t).call(this)),e.fromNode=i,e.toNode=o,e.direct="",e.stroke=a,e.textFill=s||"#fff",e.lineDashType=h,e.textBackgroundColor=r,e.fontStyle="normal",e.fontWeight="normal",e.lineCenter=[],e.status="create",e.cpx={cpx1:0,cpy1:0,cpx2:0,cpy2:0,fromcx:0,fromcy:0,tocx:0,tocy:0},e.entryDirection=[1,0],e.exitDirection=[-1,0],e.entryExt=20,e.exitExt=20,e.text=n,e.lineWidth=1,e.type=c,e.temx=0,e.temy=0,e.nodeType="edge",e.create(),e.initEvent(),e.relateText.hide(),e}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"setLineDashType",value:function(){"solid"==this.lineDashType?this.lineDash=[0]:"dott"==this.lineDashType?this.lineDash=[2,2]:"dash"==this.lineDashType?this.lineDash=[6,3]:"dashed"==this.lineDashType&&(this.lineDash=[10,4,4,4])}},{key:"create",value:function(){var e=this;this.setLineDashType(),"bs"==this.type?this.bs=new M.a.BezierCurve({style:{stroke:this.stroke,lineWidth:this.lineWidth,lineDash:this.lineDash},z:16}):"polyline"==this.type?this.bs=new M.a.Polyline({style:{stroke:this.stroke,lineWidth:this.lineWidth,lineDash:this.lineDash},z:16}):this.bs=new M.a.Line({style:{stroke:this.stroke,lineWidth:this.lineWidth,lineDash:this.lineDash},z:16}),this.cpx1=new M.a.Circle({style:{stroke:"#666",fill:"#fff"},shape:{r:4},draggable:!0,z:2e4}),this.cpx2=new M.a.Circle({style:{stroke:"#666",fill:"#fff"},shape:{r:4},draggable:!0,z:2e4}),this.fromPointCircle=new M.a.Circle({style:{fill:"#fff",stroke:"red",shadowColor:"yellow",shadowBlur:3},shape:{r:4},z:1e4}),this.toPointCircle=new M.a.Circle({style:{fill:"#fff",stroke:"red",shadowColor:"yellow",shadowBlur:3},shape:{r:4},z:1e4}),this.fromPointCircle.edge=this,this.fromPointCircle.edgeType="from",this.toPointCircle.edge=this,this.toPointCircle.edgeType="to",this.line1=new M.a.Line({style:{stroke:"#ccc"},z:1e4}),this.line2=new M.a.Line({style:{stroke:"#ccc"},z:1e4}),this.pl=new M.a.Polygon({style:{stroke:this.stroke,fill:this.stroke},z:17}),this.relateText=new M.a.Text({style:{text:this.text,textFill:this.textFill,fontSize:12,fontStyle:this.fontSize,fontWeight:this.fontWeight,textBackgroundColor:this.textBackgroundColor,textPadding:[2,2],textBorderRadius:2},z:17}).on("dblclick",(function(t){t.relate=e,e.__zr.trigger("editRelate",t)})),this.add(this.bs),this.add(this.line1),this.add(this.line2),this.add(this.cpx1),this.add(this.cpx2),this.add(this.fromPointCircle),this.add(this.toPointCircle),this.add(this.pl),this.add(this.relateText),this.cpx1.relate=this,this.cpx1.mark="from",this.cpx2.relate=this,this.cpx2.mark="to",this.cpx1.hide(),this.cpx2.hide(),this.line1.hide(),this.line2.hide(),this.fromPointCircle.hide(),this.toPointCircle.hide(),this.pl.hide()}},{key:"setFromNode",value:function(e){this.fromNode=e}},{key:"setFromAnch",value:function(e){this.fromAnch=e,e&&(this.setFromPoint(this.fromNode.getAnchorByIndex(e.point.index)),this._refresh())}},{key:"removeFromNode",value:function(){this.fromNode=null,this.fromAnch=null}},{key:"setFromPoint",value:function(e,t){this.fromPoint=Ei({},this.fromPoint,{},e),this.cpx.x1=e.x,this.cpx.y1=e.y,this.calcDirection(),t&&(this._refresh(),this.renderText())}},{key:"calc",value:function(e,t){var i,o=this.fromPoint;e&&t?(this.toPoint={x:e,y:t},i=this.toPoint):i=this.toPoint;var n=o.x+(i.x-o.x)/4,a=o.y+(i.y-o.y)/4,s=o.x+(i.x-o.x)/4*3,r=o.y+(i.y-o.y)/4*3;return{x1:o.x,y1:o.y,x2:i.x,y2:i.y,cpx1:n,cpx2:s,cpy1:a,cpy2:r}}},{key:"judgeDirect",value:function(e,t){var i="";return i=e.x>=t.x?"left":"right",e.y>=t.y?i+="top":i+="bottom",i}},{key:"calcDirection",value:function(){this.fromPoint&&this.fromPoint.direct&&("top"==this.fromPoint.direct?this.entryDirection=[0,-1]:"right"==this.fromPoint.direct?this.entryDirection=[1,0]:"bottom"==this.fromPoint.direct?this.entryDirection=[0,1]:this.entryDirection=[-1,0]),this.toPoint&&this.toPoint.direct&&("top"==this.toPoint.direct?this.exitDirection=[0,-1]:"right"==this.toPoint.direct?this.exitDirection=[1,0]:"bottom"==this.toPoint.direct?this.exitDirection=[0,1]:this.exitDirection=[-1,0])}},{key:"polylineConnection",value:function(e,t){e&&t&&(this.toPoint={x:e,y:t}),this.calcDirection();var i={entryPoint:[this.fromPoint.x,this.fromPoint.y],exitPoint:[this.toPoint.x,this.toPoint.y],entryDirection:this.entryDirection,exitDirection:this.exitDirection,entryExt:this.entryExt,exitExt:this.exitExt};if("number"==typeof i.entryPoint[0]&&"number"==typeof i.entryPoint[0]&&"number"==typeof i.exitPoint[0]&&"number"==typeof i.exitPoint[0]){var o=Pi(i),n=[];o.forEach((function(e){n.push(e.position)})),this.cpx.cpx1=n[1][0],this.cpx.cpy1=n[1][1],this.cpx.cpx2=n[n.length-2][0],this.cpx.cpy2=n[n.length-2][1];var a=o.length,s=parseInt(a/2)-1;this.lineCenter=[(n[s][0]+n[s+1][0])/2,(n[s][1]+n[s+1][1])/2],this.lineWidth%2==1?n.forEach((function(e){e[0]=parseInt(e[0])+.5,e[1]=parseInt(e[1])+.5})):n.forEach((function(e){e[0]=parseInt(e[0]),e[1]=parseInt(e[1])})),this.cpx.points=M.a.util.clone(n),this.cpx.lineCenter=this.lineCenter.slice(),this.bs.attr({shape:{points:n}}),this.renderText()}}},{key:"move",value:function(e,t){if("left"==this.fromPoint.direct||"right"==this.fromPoint.direct?e>this.fromPoint.x||e>this.temx?this.exitDirection=[-1,0]:(e<this.fromPoint.x||e<this.temx)&&(this.exitDirection=[1,0]):t>this.fromPoint.y||t>this.temy?this.exitDirection=[0,-1]:(t<this.fromPoint.y||e<this.temy)&&(this.exitDirection=[0,1]),this.temx=e,this.temy=t,"polyline"==this.type)this.polylineConnection(e,t);else{var i=this.calc(e,t);this.bs.attr({shape:i}),this._refresh()}}},{key:"calcPoints",value:function(e){if(e){var t;t="line"==this.type?Math.atan((e.x1-e.x2)/(e.y1-e.y2)):Math.atan((e.cpx2-e.x2)/(e.cpy2-e.y2));var i=8,o=3,n=[],a=[],s=[];"line"==this.type?e.y1>=e.y2?(a[0]=i*Math.sin(t)- -o*Math.cos(t)+e.x2,a[1]=i*Math.cos(t)+-o*Math.sin(t)+e.y2,s[0]=i*Math.sin(t)-o*Math.cos(t)+e.x2,s[1]=i*Math.cos(t)+o*Math.sin(t)+e.y2):(a[0]=-i*Math.sin(t)- -o*Math.cos(t)+e.x2,a[1]=-i*Math.cos(t)+-o*Math.sin(t)+e.y2,s[0]=-i*Math.sin(t)-o*Math.cos(t)+e.x2,s[1]=-i*Math.cos(t)+o*Math.sin(t)+e.y2):e.cpy2>=e.y2?(a[0]=i*Math.sin(t)- -o*Math.cos(t)+e.x2,a[1]=i*Math.cos(t)+-o*Math.sin(t)+e.y2,s[0]=i*Math.sin(t)-o*Math.cos(t)+e.x2,s[1]=i*Math.cos(t)+o*Math.sin(t)+e.y2):(a[0]=-i*Math.sin(t)- -o*Math.cos(t)+e.x2,a[1]=-i*Math.cos(t)+-o*Math.sin(t)+e.y2,s[0]=-i*Math.sin(t)-o*Math.cos(t)+e.x2,s[1]=-i*Math.cos(t)+o*Math.sin(t)+e.y2);var r=[e.x2,e.y2];return n.push(a,s,r),n}}},{key:"setToNode",value:function(e){this.toNode=e}},{key:"setToAnch",value:function(e){this.toAnch=e,e&&(this.setToPoint(this.toNode.getAnchorByIndex(e.point.index)),this._refresh())}},{key:"removeToNode",value:function(){this.toNode=null,this.toAnch=null}},{key:"setToPoint",value:function(e){this.toPoint=Ei({},this.toPoint,{},e),this.cpx.x2=e.x,this.cpx.y2=e.y,this.calcDirection(),this._refresh(),this.renderText()}},{key:"active",value:function(){if(this.status="active",this.bs.setStyle("stroke","orange"),this.fromPointCircle.attr({shape:{cx:this.cpx.x1,cy:this.cpx.y1}}),this.toPointCircle.attr({shape:{cx:this.cpx.x2,cy:this.cpx.y2}}),this.fromPointCircle.show(),this.toPointCircle.show(),"bs"==this.type){var e=this.cpx;this.cpx1.attr({position:[e.cpx1,e.cpy1]}),this.cpx2.attr({position:[e.cpx2,e.cpy2]}),this.cpx1.show(),this.cpx2.show(),this.line1.show(),this.line2.show()}}},{key:"unactive",value:function(){this.status="over",this.bs.setStyle("stroke",this.stroke),this.cpx1.hide(),this.cpx2.hide(),this.line1.hide(),this.line2.hide(),this.fromPointCircle.hide(),this.toPointCircle.hide()}},{key:"isactive",value:function(){return"active"==this.status}},{key:"setTextBackground",value:function(e){this.textBackgroundColor=e,this.relateText.attr({style:{textBackgroundColor:e}})}},{key:"flush",value:function(){this._refresh()}},{key:"refresh",value:function(){this._refresh()}},{key:"doRefresh",value:function(){this._refresh()}},{key:"showCircle",value:function(){this.fromPointCircle.show(),this.toPointCircle.show()}},{key:"initEvent",value:function(){var e=this;this.bs.on("click",(function(){e.active(),e.__zr&&e.__zr.trigger("clearSelectNode"),e.__zr&&e.__zr.trigger("selectEdge",{edge:e})})),this.bs.on("dblclick",(function(t){t.edge=e,t.status="editEdge",t.text=e.relateText.style.text,e.__zr&&e.__zr.trigger("edit",t)})),this.bs.on("contextmenu",(function(t){e.active(),e.__zr&&e.__zr.trigger("showRelateLinkMenu",t)})),this.fromPointCircle.on("mousedown",(function(){e.fromPointCircle.oldCenter={x:e.fromPointCircle.shape.cx,y:e.fromPointCircle.shape.cy}})),this.toPointCircle.on("mousedown",(function(){e.toPointCircle.oldCenter={x:e.toPointCircle.shape.cx,y:e.toPointCircle.shape.cy}})),this.cpx1.on("drag",(function(){var t=e.cpx1.position.slice();e.cpx.cpx1=t[0],e.cpx.cpy1=t[1],e._refresh()})),this.cpx2.on("drag",(function(){var t=e.cpx2.position.slice();e.cpx.cpx2=t[0],e.cpx.cpy2=t[1],e._refresh()}))}},{key:"setCpx1",value:function(e,t,i,o){this.cpx.cpx1=e,this.cpx.cpy1=t,this.setx1(e,t,i,o),this._refresh()}},{key:"setCpx2",value:function(e,t,i,o){this.cpx.cpx2=e,this.cpx.cpy2=t,this.setx2(e,t,i,o),this._refresh()}},{key:"_refresh",value:function(){var e;this.setLineDashType();var t=this.cpx;"bs"==this.type||"line"==this.type?this.bs.attr({shape:t}):(this.fromPoint=Ei({},this.fromPoint,{},{x:this.cpx.x1,y:this.cpx.y1}),this.toPoint=Ei({},this.toPoint,{},{x:this.cpx.x2,y:this.cpx.y2}),this.polylineConnection()),this.line1.attr({shape:{x1:t.x1,y1:t.y1,x2:t.cpx1,y2:t.cpy1}}),this.line2.attr({shape:{x1:t.x2,y1:t.y2,x2:t.cpx2,y2:t.cpy2}}),e=this.calcPoints(t),this.pl.attr({shape:{points:e}}),this.pl.show(),this.renderText()}},{key:"setx1",value:function(e,t){var i=this.fromNode.getPosition(),o=this.fromNode.getBoundingRect();e>=i.x-2&&e<=i.x+o.width+2?(this.cpx.x1=e,this.cpx.fromcx=e-i.x):(e<i.x-2||e>i.x+o.width+2)&&t>i.y-2&&t<i.y+o.height+2&&(this.cpx.y1=t,this.cpx.fromcy=t-i.y)}},{key:"setx2",value:function(e,t){var i=this.toNode.getPosition(),o=this.toNode.getBoundingRect();e>i.x-2&&e<i.x+o.width+2?(this.cpx.x2=e,this.cpx.tocx=e-i.x):(e<i.x-2||e>i.x+o.width+2)&&t>i.y-2&&t<i.y+o.height+2&&(this.cpx.y2=t,this.cpx.tocy=t-i.y)}},{key:"getCpx",value:function(){return{cpx1:this.cpx.cpx1,cpx2:this.cpx.cpx2,cpy1:this.cpx.cpy1,cpy2:this.cpx.cpy2,x1:this.cpx.x1,y1:this.cpx.y1,x2:this.cpx.x2,y2:this.cpx.y2,points:M.a.util.clone(this.cpx.points),lineCenter:this.lineCenter.slice(),type:this.type}}},{key:"setCpx",value:function(e){if(this.cpx=M.a.util.clone(e),"polyline"==e.type){this.cpx=e,this.lineCenter=this.cpx.lineCenter.slice(),this.bs.attr({shape:{points:e.points}});var t=this.calcPoints(e);this.pl.attr({shape:{points:t}}),this.renderText()}else this._refresh()}},{key:"setPosition",value:function(e,t){this.attr({position:[e,t]})}},{key:"renderText",value:function(){var e,t=this.cpx,i=[t.x1,t.y1],o=[t.cpx1,t.cpy1],n=[t.cpx2,t.cpy2],a=[t.x2,t.y2];e="bs"==this.type?this.threeBezier(.5,i,o,n,a):"polyline"==this.type?this.lineCenter:[(i[0]+a[0])/2,(i[1]+a[1])/2];var s=this.relateText.getBoundingRect(),r=e[0]-s.width/2,c=e[1]-s.height/2;this.relateText.attr({style:{textBackgroundColor:this.textBackgroundColor},position:[r,c]}),this.text?this.relateText.show():this.relateText.hide()}},{key:"setText",value:function(e){this.text=e,this.relateText.setStyle("text",this.text),this.renderText()}},{key:"getText",value:function(){return this.text||this.relateText.style.text}},{key:"setColor",value:function(e){this.stroke=e,this.bs.attr({style:{stroke:e}}),this.pl.attr({style:{stroke:e}})}},{key:"oneBezier",value:function(e,t,i){var o=Object(xi["a"])(t,2),n=o[0],a=o[1],s=Object(xi["a"])(i,2),r=s[0],c=s[1],h=n+(r-n)*e,l=a+(c-a)*e;return[h,l]}},{key:"twoBezier",value:function(e,t,i,o){var n=Object(xi["a"])(t,2),a=n[0],s=n[1],r=Object(xi["a"])(i,2),c=r[0],h=r[1],l=Object(xi["a"])(o,2),d=l[0],u=l[1],f=(1-e)*(1-e)*a+2*e*(1-e)*c+e*e*d,p=(1-e)*(1-e)*s+2*e*(1-e)*h+e*e*u;return[f,p]}},{key:"threeBezier",value:function(e,t,i,o,n){var a=Object(xi["a"])(t,2),s=a[0],r=a[1],c=Object(xi["a"])(n,2),h=c[0],l=c[1],d=Object(xi["a"])(i,2),u=d[0],f=d[1],p=Object(xi["a"])(o,2),g=p[0],y=p[1],m=s*(1-e)*(1-e)*(1-e)+3*u*e*(1-e)*(1-e)+3*g*e*e*(1-e)+h*e*e*e,x=r*(1-e)*(1-e)*(1-e)+3*f*e*(1-e)*(1-e)+3*y*e*e*(1-e)+l*e*e*e;return[m,x]}},{key:"getTextPosition",value:function(){var e=this.position.slice(),t=this.relateText.position.slice();return{x:e[0]+t[0],y:e[1]+t[1]}}},{key:"getTextBox",value:function(){return this.relateText.getBoundingRect()}},{key:"setAttr",value:function(e){this.bs.attr({style:{stroke:e}}),this.pl.attr({style:{stroke:e,fill:this.stroke}}),this.relateText.attr({style:{text:this.text,textFill:this.textFill,fontSize:this.fontSize,fontStyle:this.fontStyle,fontWeight:this.fontWeight,textBackgroundColor:this.textBackgroundColor}})}},{key:"setData",value:function(e){this.id=e["id"],this.text=e["text"],this.stroke=e["stroke"],this.textFill=e["textFill"],this.type=e["type"],this.textBackgroundColor=e["fill"],this.lineDashType=e["lineDashType"]||this.lineDashType,this.lineWidth=e["lineWidth"]||1,this.fontSize=e["fontSize"]||12,this.fontStyle=e["fontStyle"]||"normal",this.fontWeight=e["fontWeight"],this.entryExt=e["ext"],this.exitExt=e["ext"],this.entryDirection=e["entryDirection"],this.exitDirection=e["exitDirection"],e["position"]&&this.setPosition(e["position"][0],e["position"][1]),this.cpx=e["cpx"]||this.getCpx(),this.lineCenter=e["lineCenter"],this.setLineDashType(),this.setAttr(this.stroke,this.textFill,this.textBackgroundColor),this.setText(this.text),this.changeType(this.type),"bs"==this.type&&this.setCpx(e.cpx),this.text?this.relateText.show():this.relateText.hide()}},{key:"getData",value:function(){var e=this.getCpx();return Ei({},{id:this.id||this.bs.id,fromNode:this.fromNode&&this.fromNode.getId()||"",endNode:this.toNode&&this.toNode.getId()||"",fromAnch:this.fromAnch&&this.fromAnch.point.index||"",toAnch:this.toAnch&&this.toAnch.point.index||"",text:this.text,stroke:this.stroke,textFill:this.textFill,lineWidth:this.lineWidth,lineDashType:this.lineDashType,fontSize:this.fontSize,fontStyle:this.fontStyle,fontWeight:this.fontWeight,type:this.type,ext:this.entryExt,lineDash:this.lineDash.slice(),fill:this.textBackgroundColor,lineCenter:this.lineCenter.slice(),entryDirection:this.entryDirection.slice(),entryExt:this.entryExt,exitDirection:this.exitDirection.slice(),exitExt:this.exitExt,cpx:e,position:this.position.slice()})}},{key:"changeType",value:function(e){this.type=e||this.type,this.remove(this.bs),this.bs="bs"==e?new M.a.BezierCurve({style:{stroke:this.stroke,lineWidth:this.lineWidth||1,lineDash:this.lineDash},z:16}):"polyline"==e?new M.a.Polyline({style:{stroke:this.stroke,lineWidth:this.lineWidth||1,lineDash:this.lineDash},z:16}):new M.a.Line({style:{stroke:this.stroke,lineWidth:this.lineWidth||1,lineDash:this.lineDash},z:16}),this.add(this.bs),this.initEvent(),this._refresh()}}]),t}(M.a.Group);function Ni(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function Fi(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ni(Object(i),!0).forEach((function(t){Object(G["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ni(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var Gi=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"新建分组",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#fafafa",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#ccc",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#333",r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"dash",c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return Object(z["a"])(this,t),e=Object(B["a"])(this,Object(L["a"])(t).call(this)),e.nodes=i,e.groupText=o,e.stroke=a,e.fill=n,e.textFill=s,e.strokeType=r,e.headFill="",e.locked=!1,e.lockImage={lockImage:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABEklEQVQ4T2NkoBAwYtOvKCkgz/iftZfhP4MEWJ6R4cV/xt/F959/eIiuHsMAJUFBfgY25tP/GBlSH7x4cxCkQU5CSIuFgWnGvx9//B58+PAB2RBMAyREGv/9/Xf8wet3O5AVKkiIODAyMDjdf/GmDr8B4iKb7718E8TAwPAbzbmsSuIi6++9fONDyIDd916+ccUWNkriIhhycC/IifErMTGxyjH9Y+j5x8RQgs0AmNy/f78fPXr18R4kfKFAWUKk6/9/Br5///+LMTExXsJmwL9///WYGBlfMTIyfLr74k0ZhgF//jIuf/j69Xl8SUNeVNSQhfl/5KgBtAoDBgYGJwYGhi8EMigPAwPDPoxYIDdXAwB8nKARpjp7NAAAAABJRU5ErkJggg==",unLockImage:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA00lEQVQ4T93TIUuDURSA4WdJmC4blvQ/iHmiYYYV2/6FMEw2MSwOhIFhdTBYmFXDksExFlzSosXmTxDkwhe+Xa67sDVPPuc9977nnIoto/JH/Q7ucI49zHGN5zg/BQjFUyzQwzcu0MUZZmVICnCFJhpRt07xopMcYIwn9CPAIZao5gCPGGAYAXbxhvqmgKTvsoMa3rGfmewHWngNeWXAESZoZwCXeMFtDDgu/h1krYsg9ws3/xAQJI5wkHFwj8+UxLAoD1hZ1QTsB6fFvayMcaPD/gW+1yoRIiSCtwAAAABJRU5ErkJggg=="},e.lockImageItem=new M.a.Image({style:{image:e.lockImage.unLockImage,width:16,height:16},z:c+1}),e.getLineDash(),e.showHead=!0,e.anchors=[],e.groupStyle={fill:e.fill,lineWidth:1,stroke:e.stroke,lineDash:e.lineDash},e.headStyle={fill:e.fill,lineWidth:1,stroke:e.stroke,text:e.groupText,textFill:e.textFill,lineDash:e.lineDash,textPosition:"insideLeft",fontSize:12,fontStyle:"",fontWeight:"",transformText:!0},e.z=c,e.groupRect=new M.a.Rect({style:e.groupStyle,z:c}),e.groupHead=new M.a.Rect({style:e.headStyle,z:c}),e.gtext=new M.a.Text({style:{textPadding:[6,10],fontSize:14,text:e.groupText}}),e.nodeType="group",e.add(e.groupRect),e.add(e.groupHead),e.add(e.lockImageItem),e.redoGroup(),e.groupHead.nodeGroup=Object(R["a"])(e),e.groupRect.nodeGroup=Object(R["a"])(e),e.create(),e.createAnchors(),e.anch=new Wt(Object(R["a"])(e)),e.anch.hide(),e.initEvent(),e}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"getId",value:function(){return this.id||this.groupRect.id}},{key:"setId",value:function(e){this.id=e}},{key:"getLineDash",value:function(){"solid"==this.strokeType?this.lineDash=[]:this.lineDash=[4,2]}},{key:"create",value:function(e){if(this.locked){var t=this.position.slice(),i=new M.a.Group,o=i.getBoundingRect([this]);return o.width=parseInt(o.width),o.height=parseInt(o.height),o={x:t[0],y:t[1],width:o.width,height:o.height},this.box=o,void this._refresh()}var n=new M.a.Group,a={};this.gtext.setStyle("text",this.groupText),this.tb=this.gtext.getBoundingRect();var s=this.tb;if(s.height=Math.ceil(s.height),this.nodes.length>0)a=n.getBoundingRect(e||this.nodes),a.x=parseInt(a.x),a.y=parseInt(a.y),a.width=parseInt(a.width),a.height=parseInt(a.height),a.width<40&&(a.width=40),a.height<40&&(a.height=40),a.x-=20,a.width+=40,this.showHead?(a.y=a.y-s.height-20,a.height+=40+s.height,this.groupHead.show()):(a.y=a.y-20,a.height+=40,this.groupHead.hide()),this.box=a;else{var r=this.position.slice();a={x:r[0],y:r[1],width:80,height:60+s.height},this.box=a}this._refresh()}},{key:"toggleLock",value:function(){this.locked=!this.locked,this.locked?this.lockImageItem.attr({style:{image:this.lockImage.lockImage}}):this.lockImageItem.attr({style:{image:this.lockImage.unLockImage}})}},{key:"createAnchors",value:function(){this.anchors=[];var e=this.box,t={x:e.x+e.width/4,y:e.y,index:1,node:this,direct:"top"},i={x:e.x+e.width/2,y:e.y,index:2,node:this,direct:"top"},o={x:e.x+e.width/4*3,y:e.y,index:3,node:this,direct:"top"},n={x:e.x+e.width,y:e.y+e.height/4,index:4,node:this,direct:"right"},a={x:e.x+e.width,y:e.y+e.height/2,index:5,node:this,direct:"right"},s={x:e.x+e.width,y:e.y+e.height/4*3,index:6,node:this,direct:"right"},r={x:e.x+e.width/4,y:e.y+e.height,index:7,node:this,direct:"bottom"},c={x:e.x+e.width/2,y:e.y+e.height,index:8,node:this,direct:"bottom"},h={x:e.x+e.width/4*3,y:e.y+e.height,index:9,node:this,direct:"bottom"},l={x:e.x,y:e.y+e.height/4,index:10,node:this,direct:"left"},d={x:e.x,y:e.y+e.height/2,index:11,node:this,direct:"left"},u={x:e.x,y:e.y+e.height/4*3,index:12,node:this,direct:"left"};this.anchors.push(t,i,o,n,a,s,r,c,h,l,d,u)}},{key:"getAnchorByIndex",value:function(e){return this.anchors.filter((function(t){return t.index==e}))[0]}},{key:"getAnchByIndex",value:function(e){if(this.anch)return this.anch.getBarByIndex(e)}},{key:"getAnchors",value:function(){return this.anchors}},{key:"_refresh",value:function(){var e=this.box;if(this.attr({position:[e.x,e.y]}),this.locked)this.groupRect.attr({style:this.groupStyle}),this.groupHead.attr({style:this.headStyle});else{var t=this.tb;this.groupRect.attr({style:this.groupStyle,shape:{x:.5,y:.5,width:e.width,height:e.height}}),this.groupHead.attr({style:this.headStyle,shape:{x:.5,y:.5,width:e.width,height:t.height}}),this.lockImageItem.attr({position:[e.width-20,5]})}}},{key:"setPosition",value:function(e,t){this.attr({position:[e,t]})}},{key:"getPosition",value:function(){var e=this.position.slice();return{x:e[0],y:e[1]}}},{key:"viewTemGroup",value:function(e,t){if("up"==e){var i=this.nodes.slice();this.create(i.concat(t))}else{var o=this.nodes.filter((function(e){return e!=t}));o.length?this.create(o):this.create([this])}}},{key:"move",value:function(e,t){var i=this.getPosition();this.attr({position:[i.x+e,i.y+t]})}},{key:"addNode",value:function(e){e.nodeGroup=this,this.nodes.indexOf(-1==e)&&(this.nodes.push(e),this.refresh())}},{key:"setLevel",value:function(e){this.z=e,this.groupRect.attr({z:e}),this.groupHead.attr({z:e})}},{key:"getLevel",value:function(){return this.z}},{key:"removeNode",value:function(e){var t=this.nodes.indexOf(e);t>-1&&this.nodes.splice(t,1),e.nodeGroup=null,this.refresh()}},{key:"refresh",value:function(){this.create(),this.refreshEdge();var e=this.topGroup;while(e)e.refresh(),e=e.topGroup}},{key:"refreshEdge",value:function(){this.createAnchors(),this.anch.refresh(),this.__zr&&this.__zr.trigger("refreshEdge",{node:this})}},{key:"cancelGroup",value:function(){this.nodes.forEach((function(e){e.nodeGroup=null}))}},{key:"redoGroup",value:function(){var e=this;this.nodes.forEach((function(t){t.nodeGroup=e}))}},{key:"getStyle",value:function(){var e=this.groupHead.style;return Fi({stroke:this.stroke,groupFill:this.fill,text:this.text,showHead:this.showHead},e)}},{key:"getGroupStyle",value:function(){return M.a.util.clone(this.groupStyle)}},{key:"setGroupStyle",value:function(e){this.stroke=e.stroke,this.fill=e.fill,this.groupStyle=Fi({},this.groupStyle,{},e),this.headStyle.stroke=this.stroke,this.refresh()}},{key:"getHeadStyle",value:function(){return M.a.util.clone(this.headStyle)}},{key:"setHeadStyle",value:function(e){this.headFill=e.fill,this.groupText=e.text,this.headStyle=Fi({},this.headStyle,{},e),this.gtext.setStyle("fontSize",e.fontSize),this.gtext.setStyle("text",e.groupText),this.refresh()}},{key:"changeHead",value:function(e){this.showHead=e,e?this.groupHead.show():this.groupHead.hide(),this.refresh()}},{key:"getGroupData",value:function(e){var t=[];e.nodes.forEach((function(e){if("node"==e.nodeType){var i={type:"node",node:e.getId()};t.push(i)}}));var i={id:e.getId(),nodes:t,topGroup:e.topGroup&&e.topGroup.getId()||"",headStyle:M.a.util.clone(e.groupHead.style),groupStyle:M.a.util.clone(e.groupRect.style),showHead:e.showHead,locked:e.locked};return e.locked&&(i.box=M.a.util.clone(e.box)),i}},{key:"setBox",value:function(e){this.box=e}},{key:"getData",value:function(){return this.getGroupData(this)}},{key:"setOldPos",value:function(){function e(t){t.oldPos=t.position.slice(),t.nodes.forEach((function(t){t.oldPos=t.position.slice(),"group"==t.type&&e(t)}))}e(this)}},{key:"getAllItems",value:function(){var e=[this];function t(i){i.nodes.forEach((function(i){e.push(i),"group"==i.type&&t(i)}))}return t(this),e}},{key:"initEvent",value:function(){var e,t,i,o,n,a,s=this,r=!1,c=!1,h=this;this.on("mouseover",(function(){s.create(),s.createAnchors(),s.anch.refresh(),s.anch.show(),s.lockImageItem.show()})),this.on("mouseout",(function(){s.anch.hide(),s.lockImageItem.hide()})),this.on("mousedown",(function(o){if(s.__zr.trigger("clearSelectItems"),s.__zr.trigger("selectGroup",{group:s}),e=parseInt(o.offsetX),t=parseInt(o.offsetY),r=!0,i=s.position.slice(),s.setOldPos(),a=s.getAllItems(),s.editor){s.editor.multipleSelectEdges(a);var n=new M.a.Group,c=n.getBoundingRect([s]);s.editor.cover.attr({position:[i[0],i[1]],shape:{width:c.width,height:c.height}})}a.forEach((function(e){e.anch&&e.anch.hide()})),s.dragging=!1,document.addEventListener("mousemove",l),document.addEventListener("mouseup",d),o.stopPropagation&&o.stopPropagation()}));var l=function(a){r&&(o=parseInt(a.offsetX-e),n=parseInt(a.offsetY-t),s.editor&&(s.editor.cover.show(),s.editor.cover.attr({position:[i[0]+o,i[1]+n]})),c=!0,s.dragging=!0,s.anch.hide())};this.on("dblclick",(function(){this.showHead&&this.__zr.trigger("edit",{status:"editGroup",group:this,text:this.headStyle.text})})),this.groupRect.on("dragenter",(function(e){var t=e.topTarget;t&&"node"!=t.nodeType||(-1==h.nodes.indexOf(t)?(this.setStyle("stroke","red"),t.addToNodeGroup=!0):(t.groupTime&&(t.groupTime=null,t.leaveGroup=!1,t.groupTimeout&&(clearTimeout(t.groupTimeout),t.groupTimeout=null)),t.addToNodeGroup=!1))})).on("dragleave",(function(e){var t=e.topTarget;t&&"node"!=t.nodeType||(h.nodes.indexOf(t)>-1?h.locked?(this.setStyle("stroke","red"),t.groupTime=+new Date,t.leaveGroup=!0,t.groupTimeout=setTimeout((function(){h.groupRect.setStyle("stroke","#ccc"),clearTimeout(t.groupTimeout),t.groupTimeout=null,t.groupTime=null,t.leaveGroup=!0,h.refresh()}),50)):(this.setStyle("stroke","red"),t.groupTime=+new Date,t.leaveGroup=!0,t.groupTimeout=setTimeout((function(){h.viewTemGroup("down",t),clearTimeout(t.groupTimeout),t.groupTimeout=null,t.groupTime=null,t.leaveGroup=!0}),1500)):(this.setStyle("stroke",h.stroke),t&&(t.addToNodeGroup=!1,t.leaveGroup=!1)))})).on("drop",(function(e){var t=e.topTarget;if(t){if("node"!=t.nodeType)return;-1==h.nodes.indexOf(t)&&(t.addToNodeGroup=!1,this.__zr.trigger("addNodeToGroup",{node:t,group:h}),this.setStyle("stroke",h.stroke),t.leaveGroup=!1)}}));var d=function e(){r&&(s.dragging=!1,r=!1,c&&(s.attr({position:[i[0]+o,i[1]+n]}),s.editor.moveNode(o,n,a),s.__zr.trigger("moveGroup",{group:s}),c=!1,s.create(),s.createAnchors(),s.refreshEdge(),s.anch.refresh(),s.anch.show(),s.editor.cover.hide()),a.forEach((function(e){e.create&&e.create(),e.createAnchors(),e.anch&&e.anch.refresh()}))),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",e)};document.addEventListener("mouseup",d),this.lockImageItem.on("click",(function(){s.toggleLock()}))}}]),t}(M.a.Group),zi=Gi;function _i(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function Bi(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?_i(Object(i),!0).forEach((function(t){Object(G["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_i(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var Li=function(e){function t(e,i){var o;return Object(z["a"])(this,t),o=Object(B["a"])(this,Object(L["a"])(t).call(this)),o.zr=M.a.init(document.getElementById(e),{renderer:"canvas"}),o.id=o.uuid(),o.data=i||{},o.stack=new U(o.data.stackStep||50),o.nodes=[],o.facilities=[],o.borders=[],o.rightBorders=[],o.downBorders=[],o.leftBorders=[],o.upBorders=[],o.fAndO=[],o.downLoadText=[],o.edges=[],o.groups=[],o.alertLines={},o.status="",o.scale=1,o.frame=new mi(Object(R["a"])(o)),o.frame.addTo(Object(R["a"])(o)),o.selectFrame=new M.a.Rect({style:{fill:"#1890ff",opacity:.1},shape:{x:0,y:0,width:0,heigt:0},z:1e4}),o.zr.add(o.selectFrame),o.selectFrame.hide(),o.zr.add(Object(R["a"])(o)),o.cover=new M.a.Rect({style:{fill:"rgb(231, 247, 254)",stroke:"rgb(178, 222, 254)",opacity:.6},shape:{width:0,height:0},z:1e5}),o.cover.hide(),o.add(o.cover),o.commandChange(),o.initEvent(),o}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"init",value:function(e,t){var i=this;if(this.nodes=[],this.edges=[],this.groups=[],this.removeAll(),this.add(this.cover),this.frame.addTo(this),this.attr({position:[0,0]}),!e||!e.type||"cicadaFlow"!=e.type)throw new Error("不支持的数据");this.initData=e;var o=e.node,n=e.group,a=e.edge;o.forEach((function(e){var o=Jt.getShape(e.command,e,t);o.setData(e),t||(o.createAnchors(),o.anch.refresh()),i.addNode(o)})),n.forEach((function(e){var t=[];e.nodes.forEach((function(e){t.push(i.getNodeById(e.node))}));var o=new zi(t);o.setHeadStyle(e.headStyle),o.setGroupStyle(e.groupStyle),o.setId(e.id),o.changeHead(e.showHead),e.locked&&(o.setBox(e.box),o.toggleLock()),i.addGroup(o)})),n.forEach((function(e){if(e.topGroup){var t=i.getGroupById(e.topGroup),o=i.getGroupById(e.id);o.topGroup=t,t.nodes.push(o),t.refresh()}})),a.forEach((function(e){var t=new ji;if(t.setData(e),e.fromNode){var o=i.getItemById(e.fromNode),n=o.getAnchByIndex(e.fromAnch);t.setFromNode(o),t.setFromAnch(n)}if(e.endNode){var a=i.getItemById(e.endNode),s=a.getAnchByIndex(e.toAnch);t.setToNode(a),t.setToAnch(s)}i.addEdge(t)}))}},{key:"clearHistory",value:function(){this.stack.clear()}},{key:"getItemById",value:function(e){var t=this.nodes.concat(this.groups);return t.filter((function(t){return t.getId()==e}))[0]}},{key:"getNodeById",value:function(e){return this.nodes.filter((function(t){return t.getId()==e}))[0]}},{key:"getGroupById",value:function(e){return this.groups.filter((function(t){return t.getId()==e}))[0]}},{key:"getEdgeById",value:function(e){return this.edges.filter((function(t){return t.getId()==e}))[0]}},{key:"parseSvg",value:function(){}},{key:"addShape",value:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.execute("addShape",e[t]);else this.execute("addShape",e)}},{key:"getSafeArea",value:function(e,t,i){var o,n,a,s,r,c,h=e.position,l=e.shape.width,d=e.shape.height;if(i){var u=9999;o=u,n=u,a=u,s=u}else o=e.safe.right/t,n=e.safe.left/t,a=e.safe.up/t,s=e.safe.down/t,r=e.safe.operation/t,c=e.safe.back/t;return{right:{topLeft:{x:h[0]+l,y:h[1]},topRight:{x:h[0]+l+o,y:h[1]},downRight:{x:h[0]+l,y:h[1]+d},downLeft:{x:h[0]+l+o,y:h[1]+d},start:{x:h[0]+l,y:h[1]+d/2}},left:{topLeft:{x:h[0]-n,y:h[1]},topRight:{x:h[0],y:h[1]},downRight:{x:h[0],y:h[1]+d},downLeft:{x:h[0]-n,y:h[1]+d},start:{x:h[0],y:h[1]+d/2}},up:{topLeft:{x:h[0],y:h[1]-a},topRight:{x:h[0]+l,y:h[1]-a},downRight:{x:h[0]+l,y:h[1]},downLeft:{x:h[0],y:h[1]},start:{x:h[0]+l/2,y:h[1]}},down:{topLeft:{x:h[0],y:h[1]+d},topRight:{x:h[0]+l,y:h[1]},downRight:{x:h[0]+l,y:h[1]+d+s},downLeft:{x:h[0],y:h[1]+d+s},start:{x:h[0]+l/2,y:h[1]+d}},extrSafe:{operation:r,back:c}}}},{key:"checkRight",value:function(e,t,i,o){for(var n=i.right,a=t.indexOf(o),s=Number.MAX_VALUE,r=0;r<t.length;r++){var c,h,l;if(r!==a)if(0===t[r].kind?(c="1"===t[r].slopeDirection?t[r].shape.x2:t[r].shape.x1,h=t[r].shape.y1,l=t[r].shape.y2):(c=t[r].position[0],h=t[r].position[1],l=h+t[r].shape.height),!(h>n.downRight.y||l<n.topRight.y)){var d=n.topRight.x;1===e&&3===t[r].kind&&("3"===t[r].face&&"1"===o.face&&(d+=i.extrSafe.operation),"1"===t[r].face&&"3"===o.face&&(d+=i.extrSafe.back)),c>n.topLeft.x&&c<d&&(s=Math.min(c-n.topLeft.x,s))}}return s===Number.MAX_VALUE||{x1:n.start.x,y1:n.start.y,x2:n.start.x+s,y2:n.start.y,text:this.getLength(s)}}},{key:"checkLeft",value:function(e,t,i,o){for(var n=i.left,a=t.indexOf(o),s=Number.MAX_VALUE,r=0;r<t.length;r++){var c,h,l;if(r!==a)if(0===t[r].kind?(c="1"===t[r].slopeDirection?t[r].shape.x2:t[r].shape.x1,h=t[r].shape.y2,l=t[r].shape.y1):(c=t[r].position[0]+t[r].shape.width,h=t[r].position[1],l=h+t[r].shape.height),!(h>n.downRight.y||l<n.topRight.y)){var d=n.topLeft.x;1===e&&3===t[r].kind&&("3"===t[r].face&&"1"===o.face&&(d-=i.extrSafe.back),"1"===t[r].face&&"3"===o.face&&(d-=i.extrSafe.operation)),c>d&&c<n.topRight.x&&(s=Math.min(n.topRight.x-c,s))}}return s===Number.MAX_VALUE||{x1:n.start.x,y1:n.start.y,x2:n.start.x-s,y2:n.start.y,text:this.getLength(s)}}},{key:"checkUp",value:function(e,t,i,o){for(var n=i.up,a=t.indexOf(o),s=Number.MAX_VALUE,r=0;r<t.length;r++){var c,h,l;if(r!==a)if(0===t[r].kind?(c=t[r].shape.x1,h=t[r].shape.x2,l="1"===t[r].slopeDirection?t[r].shape.y2:t[r].shape.y1):(c=t[r].position[0],h=c+t[r].shape.width,l=t[r].position[1]+t[r].shape.height),!(c>n.downRight.x||h<n.downLeft.x)){var d=n.topLeft.y;1===e&&3===t[r].kind&&("0"===t[r].face&&"2"===o.face&&(d-=i.extrSafe.back),"2"===t[r].face&&"0"===o.face&&(d-=i.extrSafe.operation)),l<n.downLeft.y&&l>d&&(s=Math.min(n.downLeft.y-l,s))}}return s===Number.MAX_VALUE||{x1:n.start.x,y1:n.start.y,x2:n.start.x,y2:n.start.y-s,text:this.getLength(s)}}},{key:"checkDown",value:function(e,t,i,o){for(var n=i.down,a=t.indexOf(o),s=Number.MAX_VALUE,r=0;r<t.length;r++){var c,h,l;if(r!==a)if(0===t[r].kind?(c=t[r].shape.x2,h=t[r].shape.x1,l="1"===t[r].slopeDirection?t[r].shape.y2:t[r].shape.y1):(c=t[r].position[0],h=c+t[r].shape.width,l=t[r].position[1]),!(c>n.downRight.x||h<n.downLeft.x)){var d=n.downLeft.y;1===e&&3===t[r].kind&&("0"===t[r].face&&"2"===o.face&&(d+=i.extrSafe.operation),"2"===t[r].face&&"0"===o.face&&(d+=i.extrSafe.back)),l<d&&l>n.topLeft.y&&(s=Math.min(l-n.topLeft.y,s))}}return s===Number.MAX_VALUE||{x1:n.start.x,y1:n.start.y,x2:n.start.x,y2:n.start.y+s,text:this.getLength(s)}}},{key:"getLength",value:function(e){e*=this.scale;var t=e+"",i=t.indexOf(".");return t.substring(0,i+2)}},{key:"checkSafe",value:function(){var e=this;this.facilities.forEach((function(t){t.alerts=[];var i=e.getSafeArea(t,e.scale),o=e.checkRight(1,e.fAndO,i,t);if(!0!==o)e.buildAlertLineCmd(t.alerts,o,1);else{var n=e.checkRight(1,e.downBorders,i);!0!==n&&e.buildAlertLineCmd(t.alerts,n,1)}var a=e.checkLeft(1,e.fAndO,i,t);if(!0!==a)e.buildAlertLineCmd(t.alerts,a,1);else{var s=e.checkLeft(1,e.upBorders,i);!0!==s&&e.buildAlertLineCmd(t.alerts,s,1)}var r=e.checkUp(1,e.fAndO,i,t);if(!0!==r)e.buildAlertLineCmd(t.alerts,r,0);else{var c=e.checkUp(1,e.rightBorders,i);!0!==c&&e.buildAlertLineCmd(t.alerts,c,0)}var h=e.checkDown(1,e.fAndO,i,t);if(!0!==h)e.buildAlertLineCmd(t.alerts,h,0,4);else{var l=e.checkDown(1,e.leftBorders,i);!0!==l&&e.buildAlertLineCmd(t.alerts,l,0,4)}})),e.updateAlertLine(e.facilities)}},{key:"buildParameter",value:function(){this.facilities=this.nodes.filter((function(e){return 3===e.kind})),this.fAndO=this.nodes.filter((function(e){return 3===e.kind||2===e.kind})),this.borders=this.nodes.filter((function(e){return 0===e.kind})),this.rightBorders=this.borders.filter((function(e){return 0===e.direction})),this.downBorders=this.borders.filter((function(e){return 1===e.direction})),this.leftBorders=this.borders.filter((function(e){return 2===e.direction})),this.upBorders=this.borders.filter((function(e){return 3===e.direction})),this.downLoadText=this.nodes.filter((function(e){return 6===e.kind}))}},{key:"checkObstaceDistance",value:function(e){var t=this;e.alerts=[];var i=t.getSafeArea(e,t.scale,!0),o=t.checkRight(2,this.fAndO,i,e);if(!0!==o)t.buildAlertLineCmd(e.alerts,o,1,5);else{var n=t.checkRight(2,this.downBorders,i);!0!==n&&t.buildAlertLineCmd(e.alerts,n,1,5)}var a=t.checkLeft(2,this.fAndO,i,e);if(!0!==a)t.buildAlertLineCmd(e.alerts,a,1,5);else{var s=t.checkLeft(2,this.upBorders,i);!0!==s&&t.buildAlertLineCmd(e.alerts,s,1,5)}var r=t.checkUp(2,this.fAndO,i,e);if(!0!==r)t.buildAlertLineCmd(e.alerts,r,0,5);else{var c=t.checkUp(2,this.rightBorders,i);!0!==c&&t.buildAlertLineCmd(e.alerts,c,0,5)}var h=t.checkDown(2,this.fAndO,i,e);if(!0!==h)t.buildAlertLineCmd(e.alerts,h,0,5);else{var l=t.checkDown(2,this.leftBorders,i);!0!==l&&t.buildAlertLineCmd(e.alerts,l,0,5)}t.updateObLine([e])}},{key:"buildAlertLineCmd",value:function(e,t,i,o){var n,a,s=t.x1,r=t.x2,c=t.y1,h=t.y2,l=t.text,d=5===o?"blue":"red";e.push({command:"line",kind:o||4,shape:{x1:s,y1:c,x2:r,y2:h},draggable:!1,style:{stroke:d,lineWidth:2},z:300}),0===i?(n=(s+r)/2+2,a=(c+h)/2-10):(n=(s+r)/2-10,a=(c+h)/2+2),e.push({command:"text",kind:o||4,x:n,y:a,draggable:!1,style:{text:l,fontSize:15,textFill:d}})}},{key:"updateAlertLine",value:function(e){this.clearFaAlert();for(var t=0;t<e.length;t++)for(var i=0;i<e[t].alerts.length;i++)this.execute("addAlertLine",e[t].alerts[i])}},{key:"updateObLine",value:function(e){this.clearOBAlert();for(var t=0;t<e.length;t++)for(var i=0;i<e[t].alerts.length;i++)this.execute("addAlertLine",e[t].alerts[i])}},{key:"clearFaAlert",value:function(){this.execute("clearAlert")}},{key:"clearOBAlert",value:function(){this.execute("clearOBAlert")}},{key:"execute",value:function(e,t,i){var o,n=[];switch(e){case"addShape":t.x=t.x-this.position[0],t.y=t.y-this.position[1];try{t.image&&(t.command="image");var a=Jt.getShape(t.command,t);this.stack.execute(new Zt([a],this))}catch(A){window.console.log(A)}0===a.kind&&this.scale!==a.scale&&(this.scale=a.scale),3!==a.kind&&2!==a.kind||this.checkSafe();break;case"addAlertLine":t.x=t.x-this.position[0],t.y=t.y-this.position[1];try{var s=Jt.getShape(t.command,t);this.stack.execute(new Zt([s],this))}catch(A){window.console.log(A)}break;case"moveNode":i.length&&(i.forEach((function(e){if("node"==e.nodeType){var t=e.oldPos.slice(),i=e.position.slice(),o=new ti(e,t,i);n.push(o)}})),n.length&&(o=new ii(n),this.stack.execute(o))),3!==i[0].kind&&2!==i[0].kind||this.checkSafe(),2===i[0].kind&&this.checkObstaceDistance(i[0]);break;case"addEdge":var r=t.edge;this.stack.execute(new oi(r,this));break;case"createGroup":this.stack.execute(new ai(t.group,t.topGroup,this));break;case"cancelGroup":this.stack.execute(new si(t.group,this.zr));break;case"removeNodeFromGroup":this.stack.execute(new ri(t.node));break;case"addNodeToGroup":this.stack.execute(new ci(t.node,t.group));break;case"changeNode":i.length&&(i.forEach((function(e){var i=e.getData(),o=M.a.util.clone(i);Object.assign(o,t);var a=new hi(e,i,o);n.push(a)})),o=new ii(n),this.stack.execute(o)),3!==i[0].kind&&2!==i[0].kind||(this.checkObstaceDistance(i[0]),this.checkSafe()),2===i[0].kind&&this.checkObstaceDistance(i[0]);break;case"resizeNode":var c=this.getSelectNodes()[0],h=c.getData(),l=new hi(c,t.oldData,h);this.stack.execute(l);break;case"changeGroup":var d,u,f=t.mark,p=t.group,g=t.style;"head"==f?(d=Bi({},p.getHeadStyle()),u=Bi({},d,{},g),this.stack.execute(new li(p,d,u,f))):"group"==f?(d=Bi({},p.getGroupStyle()),u=Bi({},d,{},g),this.stack.execute(new li(p,d,u,f))):this.stack.execute(new ui(p,t.showHead));break;case"deleteNode":this.stack.execute(new ei([t.node],this)),this.clearOBAlert(),this.clearFaAlert(),this.checkSafe();break;case"deleteAll":while(this.nodes.length>0)this.stack.execute(new ei(this.nodes,this));break;case"clearAlert":var y=this.nodes.filter((function(e){return 4===e.kind}));this.stack.execute(new ei(y,this));break;case"clearOBAlert":var m=this.nodes.filter((function(e){return 5===e.kind}));this.stack.execute(new ei(m,this));break;case"deleteNodes":this.stack.execute(new ei(t.nodes,this));break;case"deleteGroup":this.stack.execute(new di(t.group,this));break;case"deleteEdge":this.stack.execute(new ni(t.edge,this));break;case"changeEdge":var x=t.type;if("changeAnch"==x)"anch"==t.mark?this.stack.execute(new gi(t.edge,t)):"point"==t.mark&&this.stack.execute(new gi(t.edge,t));else if("text"==t.mark){var v=t.edge.getText(),w=t.style.text;this.stack.execute(new pi(t.edge,v,w))}else{var b,k;b=t.edge.getData(),k=Bi({},b,{},t.style),this.stack.execute(new fi(t.edge,b,k))}break;case"ungroup":var S=t.group;S&&this.stack.execute(new si(S,this));break}this.buildParameter()}},{key:"undo",value:function(){this.stack.undo()}},{key:"redo",value:function(){this.stack.redo()}},{key:"commandChange",value:function(){var e=this;this.stack.change=function(){e.refreshHistory()}}},{key:"refreshFullEdge",value:function(){this.fullSelectEdges.length&&this.fullSelectEdges.forEach((function(e){var t=e.oldPos?e.oldPos.slice():e.position.slice(),i=e.position.slice(),o=i[0]-t[0],n=i[1]-t[1],a=M.a.util.clone(e.oldCpx);if(a.x1=a.x1+o,a.x2=a.x2+o,a.y1=a.y1+n,a.y2=a.y2+n,a.cpx1=parseFloat(a.cpx1)+o,a.cpy1=parseFloat(a.cpy1)+n,a.cpx2=parseFloat(a.cpx2)+o,a.cpy2=parseFloat(a.cpy2)+n,"polyline"==e.type){var s=a.points;s.forEach((function(e){e[0]=e[0]+o,e[1]=e[1]+n})),a.points=s;var r=a.lineCenter.slice();a.lineCenter[0]=r[0]+o,a.lineCenter[1]=r[1]+n}e.setCpx(a),e.refresh(),e.setPosition(0,0)}))}},{key:"refreshHistory",value:function(){this.zr.trigger("undoredo",{undo:!!this.stack.canUndo(),redo:!!this.stack.canRedo()})}},{key:"uuid",value:function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function t(){return e()+e()+e()+e()}return t()}},{key:"getData",value:function(){var e=this.nodes.map((function(e){return e.getData()})),t=this.groups.map((function(e){return e.getData()})),i=this.edges.map((function(e){return e.getData()}));return{id:this.id,type:"cicadaFlow",node:e,group:t,edge:i}}},{key:"rotate",value:function(e,t){if("node"==e){var i={};"0"===t.face?i.face="1":"1"===t.face?i.face="2":"2"===t.face?i.face="3":"3"===t.face&&(i.face="0"),t.alignFace&&("0"===t.alignFace?i.alignFace="1":"1"===t.alignFace?i.alignFace="2":"2"===t.alignFace?i.alignFace="3":"3"===t.alignFace&&(i.alignFace="0")),t.safe&&(i.safe={up:t.safe.left,right:t.safe.up,down:t.safe.right,left:t.safe.down,operation:t.safe.operation,back:t.safe.back}),i.shape=t.shape;var o=[i.shape.height,i.shape.width];i.shape.width=o[0],i.shape.height=o[1],i.shape=Object.assign({},t.shape),i.originData=Object.assign({},t.originData);var n=[i.originData.height,i.originData.width];if(i.originData.width=n[0],i.originData.height=n[1],i.shape.nodes)for(var a=0;a<i.shape.nodes.length;a++){var s=i.shape.nodes[a],r=[s.width,s.height];s.height=r[0],s.width=r[1]}this.execute("changeNode",i,[t])}}},{key:"mirror",value:function(e,t){var i=Object.assign({},t);if("node"==e){var o=t.position.slice();if(i.x=o[0],i.y=o[1]+t.shape.height+20,"0"===t.face&&(i.face="2"),"2"===t.face&&(i.face="0"),"0"===t.alignFace&&(i.alignFace="2"),"2"===t.alignFace&&(i.alignFace="0"),t.safe){var n={up:t.safe.down,down:t.safe.up,left:t.safe.left,right:t.safe.right,operation:t.safe.operation,back:t.safe.back};i.safe=n}i.originData.safe=i.safe,this.execute("addShape",i)}}},{key:"copy",value:function(e,t){var i=this,o=[],n=[];if("node"==e){if(t.forEach((function(e){var t=e.position.slice(),n=M.a.util.clone(e.getData());n.id=i.uuid();var a=Jt.getShape(n.command,n,!1);o.push(a),a.attr({position:[t[0]+20,t[1]+20]}),a.kind=e.kind,a.face=e.face,a.cost=e.cost,a.safe=Object.assign({},e.safe),a.createAnchors(),a.anch.refresh()})),o.length){var a=new Zt(o,this);this.stack.execute(a)}}else if("group"==e){var s=M.a.util.clone(t.getData());t.nodes.forEach((function(e){if("node"==e.nodeType){var t=e.position.slice(),n=M.a.util.clone(e.getData());n.id=i.uuid();var a=Jt.getShape(n.command,n,!1);o.push(a),a.attr({position:[t[0]+20,t[1]+20]}),a.createAnchors(),a.anch.refresh()}}));var r=new zi(o);r.editor=this,r.setGroupStyle(s.groupStyle),r.setHeadStyle(s.headStyle),r.changeHead(s.showHead);var c=new ai(r,null,this),h=new Zt(o,this);n.push(c),n.push(h),this.stack.execute(new ii(n))}}},{key:"selectItem",value:function(e){this.clearSelectItems(),e.active();var t=new M.a.Group,i=t.getBoundingRect([e]);this.frame.boxSelect(i,e),this.frame.refreshBar(),this.frame.show()}},{key:"selectItems",value:function(e){this.clearSelectItems();var t=new M.a.Group;e.forEach((function(e){e.selected=!0,t.add(e)}));var i=t.getBoundingRect(e);this.frame.boxSelect(i,e)}},{key:"getSelectItems",value:function(){return this.nodes.filter((function(e){return e.selected})).concat(this.edges.filter((function(e){return e.selected})))}},{key:"getSelectNodes",value:function(){return this.nodes.filter((function(e){return e.selected||e.dragging}))}},{key:"getSelectEdges",value:function(){return this.edges.filter((function(e){return e.selected}))}},{key:"getEdgesByNode",value:function(e){var t=[];return this.edges.forEach((function(i){i.fromNode!=e&&i.toNode!=e||-1==t.indexOf(i)&&t.push(i)})),t}},{key:"clearSelectItems",value:function(){this.nodes.forEach((function(e){e.unactive()})),this.edges.forEach((function(e){e.unactive()})),this.groups.forEach((function(e){return e.selected=!1})),this.frame.hide()}},{key:"addNode",value:function(e){var t=this;this.nodes.push(e),this.add(e),e.anch&&e.anch.bars.forEach((function(e){t.add(e)}))}},{key:"addEdge",value:function(e){-1==this.edges.indexOf(e)&&(this.edges.push(e),this.add(e),e.editor=this)}},{key:"removeEdge",value:function(e){var t=this.edges.indexOf(e);t>-1&&(this.remove(e),this.edges.splice(t,1))}},{key:"removeNode",value:function(e){var t=this,i=this.nodes.indexOf(e);i>-1&&(this.nodes.splice(i,1),e.anch&&e.anch.bars.forEach((function(e){t.remove(e)})),this.remove(e))}},{key:"getAllEdgesByGroup",value:function(e){var t=this;if(e){var i=this.getEdgesByGroup(e),o=e.nodes;return o.forEach((function(e){var o=t.getEdgesByNode(e);o.forEach((function(e){-1==i.indexOf(e)&&i.push(e)}))})),i}return[]}},{key:"showAllAnch",value:function(){this.hasShowAllAnch||(this.nodes.forEach((function(e){e.time&&clearTimeout(e.time),e.anch.show()})),this.groups.forEach((function(e){e.time&&clearTimeout(e.time),e.anch.show()})),this.hasShowAllAnch=!0)}},{key:"hideAllAnch",value:function(){this.nodes.forEach((function(e){e.anch.hide()})),this.hasShowAllAnch=!1}},{key:"getEdgesByGroup",value:function(e){var t=[];return this.edges.forEach((function(i){i.fromNode!=e&&i.toNode!=e||-1==t.indexOf(i)&&t.push(i)})),t}},{key:"multipleSelect",value:function(){var e=this.selectFrame.getBoundingRect(),t=new M.a.Group,i=this.position.slice();this.nodes.forEach((function(o){var n=t.getBoundingRect([o]);n.x=n.x+i[0],n.y=n.y+i[1],e.intersect(n)?o.active():o.unactive()}))}},{key:"multipleSelectEdges",value:function(e){var t=this;this.selectGroups=[],this.fullSelectEdges=[],this.notFullSelectEdges=[];var i=e||this.getSelectNodes(),o=[],n=[];i.forEach((function(e){if("node"==e.nodeType){e.nodeGroup&&-1==t.selectGroups.indexOf(e.nodeGroup)&&t.selectGroups.push(e.nodeGroup);var a=t.getEdgesByNode(e);a.forEach((function(e){i.indexOf(e.fromNode)>-1&&i.indexOf(e.toNode)>-1?-1==n.indexOf(e)&&(n.push(e),e.oldCpx=Bi({},{},{},e.getCpx()),e.oldPos=e.position.slice()):-1==o.indexOf(e)&&(o.push(e),e.oldCpx=Bi({},{},{},e.getCpx()),e.oldPos=e.position.slice())}))}else if("group"==e.nodeType){var s=t.getEdgesByGroup(e);s.forEach((function(e){i.indexOf(e.fromNode)>-1&&i.indexOf(e.toNode)>-1?-1==n.indexOf(e)&&(n.push(e),e.oldCpx=Bi({},{},{},e.getCpx()),e.oldPos=e.position.slice()):-1==o.indexOf(e)&&(o.push(e),e.oldCpx=Bi({},{},{},e.getCpx()),e.oldPos=e.position.slice())}))}})),this.fullSelectEdges=n,this.notFullSelectEdges=o}},{key:"moveNode",value:function(e,t,i){var o=this;window.console.log(e);var n=i||this.getSelectNodes();n.forEach((function(i){var n=i.oldPos;i.attr({position:[n[0]+e,n[1]+t]}),o.moveEdge(e,t,i)})),2!==n[0].kind&&3!==n[0].kind||this.checkObstaceDistance(n[0])}},{key:"moveRefreshEdge",value:function(){this.fullSelectEdges.forEach((function(e){e.refresh()})),this.notFullSelectEdges.forEach((function(e){e.refresh()}))}},{key:"viewProGroup",value:function(){var e=this.getSelectNodes();e.forEach((function(e){e.nodeGroup?e.groupTime&&e.groupEndTime&&e.groupEndTime-e.groupTime>1e3&&e.nodeGroup.viewTemGroup("down",e):e.groupTime&&e.groupEndTime&&e.temporaryGroup&&e.groupEndTime-e.groupTime>1e3&&e.temporaryGroup.viewTemGroup("up",e)}))}},{key:"dropProGroup",value:function(){var e=this.getSelectNodes();e.forEach((function(e){e.nodeGroup?e.groupTime&&e.groupEndTime&&e.groupEndTime-e.groupTime>1e3&&e.nodeGroup.removeNode(e):e.groupTime&&e.groupEndTime&&e.temporaryGroup&&e.groupEndTime-e.groupTime>1e3&&e.temporaryGroup.addNode(e)}))}},{key:"moveEdge",value:function(e,t,i){this.fullSelectEdges.forEach((function(i){var o=M.a.util.clone(i.oldCpx);if(o.x1=o.x1+e,o.x2=o.x2+e,o.y1=o.y1+t,o.y2=o.y2+t,o.cpx1=o.cpx1+e,o.cpy1=o.cpy1+t,o.cpx2=o.cpx2+e,o.cpy2=o.cpy2+t,"polyline"==i.type){var n=o.points;n.forEach((function(i){i[0]=i[0]+e,i[1]=i[1]+t})),o.points=n;var a=o.lineCenter.slice();o.lineCenter[0]=a[0]+e,o.lineCenter[1]=a[1]+t}i.setCpx(o),i.refresh()})),this.notFullSelectEdges.forEach((function(e){"group"==i.nodeType&&i.create(),i.createAnchors(),e.fromNode==i?(e.setFromPoint(i.getAnchorByIndex(e.fromAnch.point.index)),e.refresh()):e.toNode==i&&(e.setToPoint(i.getAnchorByIndex(e.toAnch.point.index)),e.refresh())}))}},{key:"updateNodeAnch",value:function(){var e=this.getSelectNodes();e.forEach((function(e){e.createAnchors(),e.anch&&e.anch.refresh()}))}},{key:"setShadow",value:function(){this.nodes.forEach((function(e){return e.setShadow()})),this.groups.forEach((function(e){return e.setShadow()})),this.edges.forEach((function(e){return e.setShadow()}))}},{key:"cancelShadow",value:function(){this.nodes.forEach((function(e){return e.cancelShadow()})),this.groups.forEach((function(e){return e.cancelShadow()})),this.edges.forEach((function(e){return e.cancelShadow()}))}},{key:"leftAlign",value:function(){var e=[],t=this.getSelectNodes();if(t.length>1){var i=new M.a.Group,o=i.getBoundingRect(t);t.forEach((function(t){t.oldPos=t.position.slice();var n=i.getBoundingRect([t]),a=o.x-n.x,s=t.position.slice();s[0]=s[0]+parseInt(a),t.attr({position:s.slice()}),t.refreshEdge(),t.nodeGroup&&-1==e.indexOf(t.nodeGroup)&&e.push(t.nodeGroup)})),this.execute("moveNode",{},t),e.forEach((function(e){e.refresh()}))}}},{key:"rightAlign",value:function(){var e=[],t=this.getSelectNodes();if(t.length>1){var i=new M.a.Group,o=i.getBoundingRect(t);t.forEach((function(t){t.oldPos=t.position.slice();var n=i.getBoundingRect([t]),a=o.x+o.width-n.x-n.width,s=t.position.slice();s[0]=s[0]+parseInt(a),t.attr({position:s.slice()}),t.refreshEdge(),t.nodeGroup&&-1==e.indexOf(t.nodeGroup)&&e.push(t.nodeGroup)})),this.execute("moveNode",{},t),e.forEach((function(e){e.refresh()}))}}},{key:"verticalAlign",value:function(){var e=[],t=this.getSelectNodes();if(t.length>1){var i=new M.a.Group,o=i.getBoundingRect([t[0]]),n=o.x+o.width/2;t.forEach((function(o){if(o.oldPos=o.position.slice(),o!=t[0]){var a=i.getBoundingRect([o]),s=a.x+a.width/2,r=n-s,c=o.position.slice();c[0]=c[0]+parseInt(r),o.attr({position:c.slice()})}o.refreshEdge(),o.nodeGroup&&-1==e.indexOf(o.nodeGroup)&&e.push(o.nodeGroup)})),this.execute("moveNode",{},t),e.forEach((function(e){e.refresh()}))}}},{key:"horizontalAlign",value:function(){var e=[],t=this.getSelectNodes();if(t.length>1){var i=new M.a.Group,o=i.getBoundingRect([t[0]]),n=o.y+o.height/2;t.forEach((function(o){if(o.oldPos=o.position.slice(),o!=t[0]){var a=i.getBoundingRect([o]),s=a.y+a.height/2,r=n-s,c=o.position.slice();c[1]=c[1]+parseInt(r),o.attr({position:c.slice()})}o.refreshEdge(),o.nodeGroup&&-1==e.indexOf(o.nodeGroup)&&e.push(o.nodeGroup)})),this.execute("moveNode",{},t),e.forEach((function(e){e.refresh()}))}}},{key:"createGroup",value:function(){var e,t=this.getSelectNodes();if(t.length>1){var i=t.every((function(e){return!e.nodeGroup}));if(i)e=new zi(t),e.editor=this,this.execute("createGroup",{group:e});else{var o=t.every((function(e){return e.nodeGroup}));if(o){var n=t[0].nodeGroup,a=t.every((function(e){return e.nodeGroup==n}));if(a){var s=n.getLevel();e=new zi(t,"新建分组","#fafafa","#ccc","#333","dash",s+1),e.editor=this,e.topGroup=n,this.execute("createGroup",{group:e,topGroup:n})}}}}}},{key:"listen",value:function(e,t){this.zr.on(e,t)}},{key:"removeListen",value:function(e,t){this.zr.off(e,t)}},{key:"emit",value:function(e,t){this.zr.trigger(e,t)}},{key:"addGroup",value:function(e){var t=this;-1==this.groups.indexOf(e)&&(this.add(e),e.anch.bars.forEach((function(e){t.add(e)})),this.groups.push(e),e.editor=this)}},{key:"removeGroup",value:function(e){var t=this,i=this.groups.indexOf(e);i>-1&&(this.groups.splice(i,1),this.remove(e),e.anch.bars.forEach((function(e){t.remove(e)})))}},{key:"refreshGroup",value:function(){this.groups.forEach((function(e){e.refresh()}))}},{key:"showAnch",value:function(e,t){if("selectEdge"!=this.status&&"selectFrame"!=this.status){var i=new M.a.Group,o=this.position.slice(),n=0;"isCreateLink"!=this.status&&"changeEdge"!=this.status||(n=30);var a=this.nodes.concat(this.groups);a.forEach((function(a){if(a.dragging)a.anch&&a.anch.hide();else{var s=i.getBoundingRect([a]);s.x=s.x+o[0]-n,s.y=s.y+o[1]-n,s.width=s.width+2*n,s.height=s.height+2*n,s.contain(e,t)?a.anch&&a.anch.show():a.anch&&a.anch.hide()}}))}}},{key:"offEvent",value:function(){this.zr.off()}},{key:"initEvent",value:function(){var e=this;function t(e,t){clearTimeout(e.tId),e.tId=setTimeout((function(){e.call(t)}),300)}window.onresize=function(){t((function(){var t=document.getElementById("flowEditor").offsetWidth,i=document.getElementById("flowEditor").offsetHeight;e.zr.resize({width:t,height:i}),window.console.log(t,i)}))},this.zr.on("selectNode",(function(t){e.selectItem(t.node)})),this.zr.on("clearSelectItems",(function(){e.clearSelectItems()})),this.zr.on("judgeWidthGroup",(function(){e.judgeWidthGroup()})),this.zr.on("viewProGroup",(function(){e.viewProGroup()})),this.zr.on("hideFrame",(function(){e.frame.hide()})),this.zr.on("selectFrame",(function(){e.status="selectFrame"})),this.zr.on("moveGroup",(function(t){var i=t.group;e.execute("moveNode",{dx:l,dy:d},i.getAllItems())})),this.zr.on("refreshEdge",(function(t){var i,o=t.node;i="node"==o.nodeType?e.getEdgesByNode(o):e.getEdgesByGroup(o),i.forEach((function(e){e.fromNode==o?(e.setFromPoint(o.getAnchorByIndex(e.fromAnch.point.index)),e.refresh()):e.toNode==o&&(e.setToPoint(o.getAnchorByIndex(e.toAnch.point.index)),e.refresh())}))})),this.zr.on("moveNode",(function(t){var i=t.node,o=e.getSelectNodes();i&&-1==o.indexOf(i)&&(o=o.concat([i])),e.execute("moveNode",{dx:l,dy:d},o)})),this.zr.on("removeNodeFromGroup",(function(t){e.execute("removeNodeFromGroup",{node:t.node})})),this.zr.on("addNodeToGroup",(function(t){e.execute("addNodeToGroup",t)})),this.zr.on("resizeNode",(function(t){e.execute("resizeNode",t)})),this.zr.on("refreshSelectGroup",(function(){e.selectGroups.forEach((function(e){return e.refresh()}))}));var i,o,n,a,s=!1,r=0,c=0,h=!1,l=0,d=0,u=null,f=function(){},p=function t(){e.selectFrame.attr({shape:{x:0,y:0,width:0,heigt:0}}),e.status="",e.selectFrame.hide(),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",t)};this.zr.on("mousedown",(function(t){if(r=t.offsetX,c=t.offsetY,s=!0,u=e.position.slice(),t.target||(e.zr.trigger("clearSelectItems"),"selectFrame"==e.status&&(e.selectFrame.attr({shape:{x:r,y:c}}),e.selectFrame.show()),document.addEventListener("mousemove",f),document.addEventListener("mouseup",p)),t.target){if(t.target.mark&&"anch"==t.target.mark){if(h&&i)return e.remove(i),e.status="",void(h=!1);a=t.target,e.status="isCreateLink",h=!0,i=new ji(a.node),i.setFromPoint(Bi({},a.point)),i.fromAnch=a,e.add(i)}var l=e.getSelectNodes();l.forEach((function(e){e.oldPos=e.position.slice()})),"node"==t.target.nodeType&&e.multipleSelectEdges(),t.target.edge&&(e.status="changeEdge",o=t.target.edge,n=t.target)}})),this.zr.on("mousemove",(function(t){if(l=t.offsetX-r,d=t.offsetY-c,e.showAnch(t.offsetX,t.offsetY),s){if((h||"changeEdge"==e.status)&&h&&i.move(t.offsetX-u[0],t.offsetY-u[1]),"selectFrame"==e.status)return;if(!h&&t.target&&"node"==t.target.nodeType){if("resizeNode"==e.status||"changeEdge"==e.status)return;e.moveNode(l,d),e.viewProGroup()}if("changeEdge"==e.status&&o&&n){var a=n.oldCenter.x,f=n.oldCenter.y;n.attr({shape:{cx:a+l,cy:f+d}}),"from"==n.edgeType?o.setFromPoint({x:a+l,y:f+d},!0):o.setToPoint({x:a+l,y:f+d})}}})),this.zr.on("mouseup",(function(t){if(t.target&&t.target.mark&&"anch"==t.target.mark){if(h){if(t.target==a)return e.removeEdge(i),void(e.status="");try{i.setToNode(t.target.node),i.setToPoint(Bi({},t.target.point)),i.toAnch=t.target,e.execute("addEdge",{edge:i})}catch(t){e.removeEdge(i),i=null,e.status=""}finally{i=null,e.status=""}}if("changeEdge"==e.status){if("from"==n.edgeType)if(o.fromNode){if(o.fromAnch!=t.target){var l=o.fromNode,d=o.fromAnch;e.execute("changeEdge",{edge:o,type:"changeAnch",position:"from",oldNode:l,oldAnch:d,newNode:t.target.node,newAnch:t.target,mark:"anch"})}}else e.execute("changeEdge",{edge:o,type:"changeAnch",position:"from",oldCenter:Bi({},n.oldCenter),newCenter:{x:n.shape.cx,y:n.shape.cy},newNode:t.target.node,newAnch:t.target,mark:"point"});else if(o.toNode){if(o.toAnch!=t.target){var u=o.toNode,f=o.toAnch;e.execute("changeEdge",{edge:o,type:"changeAnch",position:"to",oldNode:u,oldAnch:f,newNode:t.target.node,newAnch:t.target,mark:"anch"})}}else e.execute("changeEdge",{edge:o,type:"changeAnch",position:"to",oldCenter:Bi({},n.oldCenter),newCenter:{x:n.shape.cx,y:n.shape.cy},newNode:t.target.node,newAnch:t.target,mark:"point"});o.refresh(),e.status="",n=null,o=null}}if("changeEdge"==e.status){if("from"==n.edgeType)if(o.fromNode){var p=o.fromNode,g=o.fromAnch;o.removeFromNode(),e.execute("changeEdge",{edge:o,type:"changeAnch",position:"from",oldNode:p,oldAnch:g,oldCenter:Bi({},n.oldCenter),newCenter:{x:n.shape.cx,y:n.shape.cy},mark:"anch"})}else e.execute("changeEdge",{edge:o,type:"changeAnch",position:"from",oldCenter:Bi({},n.oldCenter),newCenter:{x:n.shape.cx,y:n.shape.cy},mark:"point"});else if(o.toNode)if(o.toNode){var y=o.toNode,m=o.toAnch;o.removeToNode(),e.execute("changeEdge",{edge:o,type:"changeAnch",position:"to",oldNode:y,oldAnch:m,oldCenter:Bi({},n.oldCenter),newCenter:{x:n.shape.cx,y:n.shape.cy},mark:"anch"})}else e.execute("changeEdge",{edge:o,type:"changeAnch",position:"to",oldCenter:Bi({},n.oldCenter),newCenter:{x:n.shape.cx,y:n.shape.cy},mark:"point"});e.status="",n=null,o=null}i&&e.remove(i),e.selectFrame.ignore?e.updateNodeAnch():e.zr.trigger("selectNodes"),h=!1,s=!1,r=0,c=0}))}}]),t}(M.a.Group),Ri=Li,Ii=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"div-editable",attrs:{contenteditable:"true"},domProps:{innerHTML:e._s(e.innerText)},on:{input:e.changeText,focus:function(t){e.isChange=!1},blur:e.blurFunc}})},$i=[],Mi={name:"Edit",props:{value:{type:String,default:""}},data:function(){return{innerText:this.value,isChange:!0}},watch:{value:function(e){this.isChange&&(this.innerText=e)}},methods:{changeText:function(){this.$emit("input",this.$el.innerHTML)},blurFunc:function(){this.isChange=!0,this.$emit("blurFunc")}}},Wi=Mi,Ui=Object(w["a"])(Wi,Ii,$i,!1,null,null,null),Hi=Ui.exports,qi=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"show",rawName:"v-show",value:e.showCombine,expression:"showCombine"}],staticClass:"combine",attrs:{id:"combine"},on:{dragover:e.dragover,dragstart:e.dragstart,drop:e.drop}},[i("div",{staticClass:"customize-win-header"},[i("div",{staticClass:"close iconfont icon-guanbi",on:{click:e.closeCombine}})]),i("div",{staticClass:"row",staticStyle:{"font-size":"20px","font-weight":"bold"}},[e._v("新建组合")]),i("div",{staticClass:"row"},[i("span",[e._v("从左侧将设备拖入生成组合")]),e._v(" "),i("span",[i("Button",{on:{click:function(t){return e.deleteAll()}}},[e._v("清除")])],1)]),i("div",{staticClass:"row"},[i("span",[e._v("名称：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.combine.name,expression:"combine.name"}],staticClass:"image-url",attrs:{placeholder:"名字/编号",type:"text"},domProps:{value:e.combine.name},on:{input:function(t){t.target.composing||e.$set(e.combine,"name",t.target.value)}}}),i("span",[i("span",[e._v("对齐方式：")]),i("RadioGroup",{on:{"on-change":e.updateAlign},model:{value:e.alignType,callback:function(t){e.alignType=t},expression:"alignType"}},[i("Radio",{attrs:{label:"0"}},[e._v("背面")]),i("Radio",{attrs:{label:"1"}},[e._v("操作面")])],1)],1)]),e._m(0),i("div",{staticClass:"row"},[i("span",{staticStyle:{"padding-right":"20px"}},[e._v("安全距离：")]),i("span",[i("span",[e._v("上侧：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.combine.safe.up,expression:"combine.safe.up"}],staticClass:"safe-input",attrs:{placeholder:"单位cm，默认为0",type:"text"},domProps:{value:e.combine.safe.up},on:{input:function(t){t.target.composing||e.$set(e.combine.safe,"up",t.target.value)}}})]),i("span",[i("span",[e._v("下侧：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.combine.safe.down,expression:"combine.safe.down"}],staticClass:"safe-input",attrs:{placeholder:"单位cm，默认为0",type:"text"},domProps:{value:e.combine.safe.down},on:{input:function(t){t.target.composing||e.$set(e.combine.safe,"down",t.target.value)}}})]),i("span",[i("span",[e._v("左侧：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.combine.safe.left,expression:"combine.safe.left"}],staticClass:"safe-input",attrs:{placeholder:"单位cm，默认为0",type:"text"},domProps:{value:e.combine.safe.left},on:{input:function(t){t.target.composing||e.$set(e.combine.safe,"left",t.target.value)}}})]),i("span",[i("span",[e._v("右侧：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.combine.safe.right,expression:"combine.safe.right"}],staticClass:"safe-input",attrs:{placeholder:"单位cm，默认为0",type:"text"},domProps:{value:e.combine.safe.right},on:{input:function(t){t.target.composing||e.$set(e.combine.safe,"right",t.target.value)}}})])]),i("div",{staticClass:"row"},[i("span",{staticStyle:{"padding-right":"20px"}},[e._v("额外距离：")]),i("span",[i("span",[e._v("操作面与操作面：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.combine.safe.operation,expression:"combine.safe.operation"}],staticClass:"safe-input",attrs:{placeholder:"单位cm，默认为0",type:"text"},domProps:{value:e.combine.safe.operation},on:{input:function(t){t.target.composing||e.$set(e.combine.safe,"operation",t.target.value)}}})]),i("span",[i("span",[e._v("背面与背面：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.combine.safe.back,expression:"combine.safe.back"}],staticClass:"safe-input",attrs:{placeholder:"单位cm，默认为0",type:"text"},domProps:{value:e.combine.safe.back},on:{input:function(t){t.target.composing||e.$set(e.combine.safe,"back",t.target.value)}}})]),e._v(" "),i("Button",{staticClass:"foot-button",attrs:{type:"primary"},on:{click:e.addCombine}},[e._v("确定")])],1)])},Yi=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"row cavans",attrs:{id:"combineCavans"}},[i("div",{attrs:{id:"combineEditor"}})])}];function Ji(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function Ki(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ji(Object(i),!0).forEach((function(t){Object(G["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ji(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var Xi=function(e){function t(e,i){var o;return Object(z["a"])(this,t),o=Object(B["a"])(this,Object(L["a"])(t).call(this)),o.zr=M.a.init(document.getElementById(e),{renderer:"canvas"}),o.id=o.uuid(),o.data=i||{},o.stack=new U(o.data.stackStep||50),o.nodes=[],o.facilities=[],o.borders=[],o.rightBorders=[],o.downBorders=[],o.leftBorders=[],o.upBorders=[],o.fAndO=[],o.startPos=0,o.edges=[],o.groups=[],o.alertLines={},o.status="",o.alignType="0",o.scale=1,o.frame=new mi(Object(R["a"])(o)),o.frame.addTo(Object(R["a"])(o)),o.selectFrame=new M.a.Rect({style:{fill:"#1890ff",opacity:.1},shape:{x:0,y:0,width:0,heigt:0},z:1e4}),o.zr.add(o.selectFrame),o.selectFrame.hide(),o.zr.add(Object(R["a"])(o)),o.cover=new M.a.Rect({style:{fill:"rgb(231, 247, 254)",stroke:"rgb(178, 222, 254)",opacity:.6},shape:{width:0,height:0},z:1e5}),o.cover.hide(),o.add(o.cover),o.commandChange(),o.initEvent(),o}return Object(I["a"])(t,e),Object(_["a"])(t,[{key:"init",value:function(e,t){var i=this;if(this.nodes=[],this.edges=[],this.groups=[],this.removeAll(),this.add(this.cover),this.frame.addTo(this),this.attr({position:[0,0]}),!e||!e.type||"cicadaFlow"!=e.type)throw new Error("不支持的数据");this.initData=e;var o=e.node,n=e.group,a=e.edge;o.forEach((function(e){var o=Jt.getShape(e.command,e,t);o.setData(e),t||(o.createAnchors(),o.anch.refresh()),i.addNode(o)})),n.forEach((function(e){var t=[];e.nodes.forEach((function(e){t.push(i.getNodeById(e.node))}));var o=new zi(t);o.setHeadStyle(e.headStyle),o.setGroupStyle(e.groupStyle),o.setId(e.id),o.changeHead(e.showHead),e.locked&&(o.setBox(e.box),o.toggleLock()),i.addGroup(o)})),n.forEach((function(e){if(e.topGroup){var t=i.getGroupById(e.topGroup),o=i.getGroupById(e.id);o.topGroup=t,t.nodes.push(o),t.refresh()}})),a.forEach((function(e){var t=new ji;if(t.setData(e),e.fromNode){var o=i.getItemById(e.fromNode),n=o.getAnchByIndex(e.fromAnch);t.setFromNode(o),t.setFromAnch(n)}if(e.endNode){var a=i.getItemById(e.endNode),s=a.getAnchByIndex(e.toAnch);t.setToNode(a),t.setToAnch(s)}i.addEdge(t)}))}},{key:"clearHistory",value:function(){this.stack.clear()}},{key:"getItemById",value:function(e){var t=this.nodes.concat(this.groups);return t.filter((function(t){return t.getId()==e}))[0]}},{key:"getNodeById",value:function(e){return this.nodes.filter((function(t){return t.getId()==e}))[0]}},{key:"getGroupById",value:function(e){return this.groups.filter((function(t){return t.getId()==e}))[0]}},{key:"getEdgeById",value:function(e){return this.edges.filter((function(t){return t.getId()==e}))[0]}},{key:"parseSvg",value:function(){}},{key:"addShape",value:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.execute("addShape",e[t]);else this.execute("addShape",e)}},{key:"getSafeArea",value:function(e,t,i){var o,n,a,s,r=e.position,c=e.shape.width,h=e.shape.height;if(i){var l=9999;o=l,n=l,a=l,s=l}else o=e.safe.right/t,n=e.safe.left/t,a=e.safe.up/t,s=e.safe.down/t;return{right:{topLeft:{x:r[0]+c,y:r[1]},topRight:{x:r[0]+c+o,y:r[1]},downRight:{x:r[0]+c,y:r[1]+h},downLeft:{x:r[0]+c+o,y:r[1]+h},start:{x:r[0]+c,y:r[1]+h/2}},left:{topLeft:{x:r[0]-n,y:r[1]},topRight:{x:r[0],y:r[1]},downRight:{x:r[0],y:r[1]+h},downLeft:{x:r[0]-n,y:r[1]+h},start:{x:r[0],y:r[1]+h/2}},up:{topLeft:{x:r[0],y:r[1]-a},topRight:{x:r[0]+c,y:r[1]-a},downRight:{x:r[0]+c,y:r[1]},downLeft:{x:r[0],y:r[1]},start:{x:r[0]+c/2,y:r[1]}},down:{topLeft:{x:r[0],y:r[1]+h},topRight:{x:r[0]+c,y:r[1]},downRight:{x:r[0]+c,y:r[1]+h+s},downLeft:{x:r[0],y:r[1]+h+s},start:{x:r[0]+c/2,y:r[1]+h}}}}},{key:"checkRight",value:function(e,t,i){for(var o=e.indexOf(i),n=0;n<e.length;n++){var a,s,r;if(n!==o)if(0===e[n].kind?(a=e[n].shape.x1,s=e[n].shape.y1,r=e[n].shape.y2):(a=e[n].position[0],s=e[n].position[1],r=s+e[n].shape.height),!(s>t.downRight.y||r<t.topRight.y)&&a>t.topLeft.x&&a<t.topRight.x){var c=a-t.topLeft.x;return{x1:t.start.x,y1:t.start.y,x2:t.start.x+c,y2:t.start.y,text:this.getLength(c)}}}return!0}},{key:"checkLeft",value:function(e,t,i){for(var o=e.indexOf(i),n=0;n<e.length;n++){var a,s,r;if(n!==o)if(0===e[n].kind?(a=e[n].shape.x1,s=e[n].shape.y2,r=e[n].shape.y1):(a=e[n].position[0]+e[n].shape.width,s=e[n].position[1],r=s+e[n].shape.height),!(s>t.downRight.y||r<t.topRight.y)&&a>t.topLeft.x&&a<t.topRight.x){var c=t.topRight.x-a;return{x1:t.start.x,y1:t.start.y,x2:t.start.x-c,y2:t.start.y,text:this.getLength(c)}}}return!0}},{key:"checkUp",value:function(e,t,i){for(var o=e.indexOf(i),n=0;n<e.length;n++){var a,s,r;if(n!==o)if(0===e[n].kind?(a=e[n].shape.x1,s=e[n].shape.x2,r=e[n].shape.y1):(a=e[n].position[0],s=a+e[n].shape.width,r=e[n].position[1]+e[n].shape.height),!(a>t.downRight.x||s<t.downLeft.x)&&r<t.downLeft.y&&r>t.topLeft.y){var c=t.downLeft.y-r;return{x1:t.start.x,y1:t.start.y,x2:t.start.x,y2:t.start.y-c,text:this.getLength(c)}}}return!0}},{key:"checkDown",value:function(e,t,i){for(var o=e.indexOf(i),n=0;n<e.length;n++){var a,s,r;if(n!==o)if(0===e[n].kind?(a=e[n].shape.x2,s=e[n].shape.x1,r=e[n].shape.y1):(a=e[n].position[0],s=a+e[n].shape.width,r=e[n].position[1]),!(a>t.downRight.x||s<t.downLeft.x)&&r<t.downLeft.y&&r>t.topLeft.y){var c=r-t.topLeft.y;return{x1:t.start.x,y1:t.start.y,x2:t.start.x,y2:t.start.y+c,text:this.getLength(c)}}}return!0}},{key:"getLength",value:function(e){e*=this.scale;var t=e+"",i=t.indexOf(".");return t.substring(0,i+2)}},{key:"checkSafe",value:function(){var e=this;this.facilities.forEach((function(t){t.alerts=[];var i=e.getSafeArea(t,e.scale),o=e.checkRight(e.fAndO,i.right,t);if(!0!==o)e.buildAlertLineCmd(t.alerts,o,1);else{var n=e.checkRight(e.downBorders,i.right);!0!==n&&e.buildAlertLineCmd(t.alerts,n,1)}var a=e.checkLeft(e.fAndO,i.left,t);if(!0!==a)e.buildAlertLineCmd(t.alerts,a,1);else{var s=e.checkLeft(e.upBorders,i.left);!0!==s&&e.buildAlertLineCmd(t.alerts,s,1)}var r=e.checkUp(e.fAndO,i.up,t);if(!0!==r)e.buildAlertLineCmd(t.alerts,r,0);else{var c=e.checkUp(e.rightBorders,i.up);!0!==c&&e.buildAlertLineCmd(t.alerts,c,0)}var h=e.checkDown(e.fAndO,i.down,t);if(!0!==h)e.buildAlertLineCmd(t.alerts,h,0,4);else{var l=e.checkDown(e.leftBorders,i.down);!0!==l&&e.buildAlertLineCmd(t.alerts,l,0,4)}})),e.updateAlertLine(e.facilities)}},{key:"buildParameter",value:function(){this.facilities=this.nodes.filter((function(e){return 3===e.kind})),this.fAndO=this.nodes.filter((function(e){return 3===e.kind||2===e.kind})),this.borders=this.nodes.filter((function(e){return 0===e.kind})),this.rightBorders=this.borders.filter((function(e){return 0===e.direction})),this.downBorders=this.borders.filter((function(e){return 1===e.direction})),this.leftBorders=this.borders.filter((function(e){return 2===e.direction})),this.upBorders=this.borders.filter((function(e){return 3===e.direction}))}},{key:"checkObstaceDistance",value:function(e){var t=this;e.alerts=[];var i=t.getSafeArea(e,t.scale,!0),o=t.checkRight(this.fAndO,i.right,e);if(!0!==o)t.buildAlertLineCmd(e.alerts,o,1,5);else{var n=t.checkRight(this.downBorders,i.right);!0!==n&&t.buildAlertLineCmd(e.alerts,n,1,5)}var a=t.checkLeft(this.fAndO,i.left,e);if(!0!==a)t.buildAlertLineCmd(e.alerts,a,1,5);else{var s=t.checkLeft(this.upBorders,i.left);!0!==s&&t.buildAlertLineCmd(e.alerts,s,1,5)}var r=t.checkUp(this.fAndO,i.up,e);if(!0!==r)t.buildAlertLineCmd(e.alerts,r,0,5);else{var c=t.checkUp(this.rightBorders,i.up);!0!==c&&t.buildAlertLineCmd(e.alerts,c,0,5)}var h=t.checkDown(this.fAndO,i.down,e);if(!0!==h)t.buildAlertLineCmd(e.alerts,h,0,5);else{var l=t.checkDown(this.leftBorders,i.down);!0!==l&&t.buildAlertLineCmd(e.alerts,l,0,5)}t.updateObLine([e])}},{key:"buildAlertLineCmd",value:function(e,t,i,o){var n,a,s=t.x1,r=t.x2,c=t.y1,h=t.y2,l=t.text,d=5===o?"blue":"red";e.push({command:"line",kind:o||4,shape:{x1:s,y1:c,x2:r,y2:h},draggable:!1,style:{stroke:d,lineWidth:2},z:300}),0===i?(n=(s+r)/2+2,a=(c+h)/2-10):(n=(s+r)/2-10,a=(c+h)/2+2),e.push({command:"text",kind:o||4,x:n,y:a,draggable:!1,style:{text:l,fontSize:15,textFill:d}})}},{key:"updateAlertLine",value:function(e){this.clearFaAlert();for(var t=0;t<e.length;t++)for(var i=0;i<e[t].alerts.length;i++)this.execute("addAlertLine",e[t].alerts[i])}},{key:"updateObLine",value:function(e){this.clearOBAlert();for(var t=0;t<e.length;t++)for(var i=0;i<e[t].alerts.length;i++)this.execute("addAlertLine",e[t].alerts[i])}},{key:"clearFaAlert",value:function(){this.execute("clearAlert")}},{key:"clearOBAlert",value:function(){this.execute("clearOBAlert")}},{key:"winResize",value:function(){var e=document.getElementById("combineCavans").offsetWidth,t=document.getElementById("combineCavans").offsetHeight;this.zr.resize({width:e,height:t}),window.console.log(e,t)}},{key:"calXY",value:function(e){var t=20,i=20;if(this.nodes.length>0)for(var o=0;o<this.nodes.length;o++)t+=this.nodes[o].data.shape.width;e.x=t,e.y=i}},{key:"adjustShape",value:function(e){if(this.calXY(e),1!=this.alignType){if("1"===e.face||"3"===e.face){var t=[e.shape.height,e.shape.width];e.shape.width=t[0],e.shape.height=t[1]}e.face="2"}else{if("1"===e.face||"3"===e.face){var i=[e.shape.height,e.shape.width];e.shape.width=i[0],e.shape.height=i[1]}e.face="0"}}},{key:"updateAlign",value:function(e){if(this.alignType=e,0!==this.nodes.length){for(var t=[],i=0;i<this.nodes.length;i++)t.push(Object.assign({},this.nodes[i]));this.execute("deleteAll");for(var o=0;o<t.length;o++)t[o].data.face="0"===e?"2":"0",this.execute("addShape",t[o])}}},{key:"execute",value:function(e,t){switch(this.winResize(),e){case"addShape":this.adjustShape(t),t.draggable=!1;try{t.image&&(t.command="image");var i=Jt.getShape(t.command,t);3===i.kind&&this.stack.execute(new Zt([i],this))}catch(o){window.console.log(o)}break;case"deleteAll":while(this.nodes.length>0)this.stack.execute(new ei(this.nodes,this));break}this.buildParameter()}},{key:"undo",value:function(){this.stack.undo()}},{key:"redo",value:function(){this.stack.redo()}},{key:"commandChange",value:function(){var e=this;this.stack.change=function(){e.refreshHistory()}}},{key:"refreshFullEdge",value:function(){this.fullSelectEdges.length&&this.fullSelectEdges.forEach((function(e){var t=e.oldPos?e.oldPos.slice():e.position.slice(),i=e.position.slice(),o=i[0]-t[0],n=i[1]-t[1],a=M.a.util.clone(e.oldCpx);if(a.x1=a.x1+o,a.x2=a.x2+o,a.y1=a.y1+n,a.y2=a.y2+n,a.cpx1=parseFloat(a.cpx1)+o,a.cpy1=parseFloat(a.cpy1)+n,a.cpx2=parseFloat(a.cpx2)+o,a.cpy2=parseFloat(a.cpy2)+n,"polyline"==e.type){var s=a.points;s.forEach((function(e){e[0]=e[0]+o,e[1]=e[1]+n})),a.points=s;var r=a.lineCenter.slice();a.lineCenter[0]=r[0]+o,a.lineCenter[1]=r[1]+n}e.setCpx(a),e.refresh(),e.setPosition(0,0)}))}},{key:"refreshHistory",value:function(){this.zr.trigger("undoredo",{undo:!!this.stack.canUndo(),redo:!!this.stack.canRedo()})}},{key:"uuid",value:function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function t(){return e()+e()+e()+e()}return t()}},{key:"getData",value:function(){var e=this.nodes.map((function(e){return e.getData()})),t=this.groups.map((function(e){return e.getData()})),i=this.edges.map((function(e){return e.getData()}));return{id:this.id,type:"cicadaFlow",node:e,group:t,edge:i}}},{key:"copy",value:function(e,t){var i=this,o=[],n=[];if("node"==e){if(t.forEach((function(e){var t=e.position.slice(),n=M.a.util.clone(e.getData());n.id=i.uuid();var a=Jt.getShape(n.command,n,!1);o.push(a),a.attr({position:[t[0]+20,t[1]+20]}),a.kind=e.kind,a.face=e.face,a.safe=Object.assign({},e.safe),a.createAnchors(),a.anch.refresh()})),o.length){var a=new Zt(o,this);this.stack.execute(a)}}else if("group"==e){var s=M.a.util.clone(t.getData());t.nodes.forEach((function(e){if("node"==e.nodeType){var t=e.position.slice(),n=M.a.util.clone(e.getData());n.id=i.uuid();var a=Jt.getShape(n.command,n,!1);o.push(a),a.attr({position:[t[0]+20,t[1]+20]}),a.createAnchors(),a.anch.refresh()}}));var r=new zi(o);r.editor=this,r.setGroupStyle(s.groupStyle),r.setHeadStyle(s.headStyle),r.changeHead(s.showHead);var c=new ai(r,null,this),h=new Zt(o,this);n.push(c),n.push(h),this.stack.execute(new ii(n))}}},{key:"selectItems",value:function(e){this.clearSelectItems();var t=new M.a.Group;e.forEach((function(e){e.selected=!0,t.add(e)}));var i=t.getBoundingRect(e);this.frame.boxSelect(i,e)}},{key:"getSelectItems",value:function(){return this.nodes.filter((function(e){return e.selected})).concat(this.edges.filter((function(e){return e.selected})))}},{key:"getSelectNodes",value:function(){return this.nodes.filter((function(e){return e.selected||e.dragging}))}},{key:"getSelectEdges",value:function(){return this.edges.filter((function(e){return e.selected}))}},{key:"getEdgesByNode",value:function(e){var t=[];return this.edges.forEach((function(i){i.fromNode!=e&&i.toNode!=e||-1==t.indexOf(i)&&t.push(i)})),t}},{key:"clearSelectItems",value:function(){this.nodes.forEach((function(e){e.unactive()})),this.edges.forEach((function(e){e.unactive()})),this.groups.forEach((function(e){return e.selected=!1})),this.frame.hide()}},{key:"addNode",value:function(e){var t=this;this.nodes.push(e),this.add(e),e.anch&&e.anch.bars.forEach((function(e){t.add(e)}))}},{key:"addEdge",value:function(e){-1==this.edges.indexOf(e)&&(this.edges.push(e),this.add(e),e.editor=this)}},{key:"removeEdge",value:function(e){var t=this.edges.indexOf(e);t>-1&&(this.remove(e),this.edges.splice(t,1))}},{key:"removeNode",value:function(e){var t=this,i=this.nodes.indexOf(e);i>-1&&(this.nodes.splice(i,1),e.anch&&e.anch.bars.forEach((function(e){t.remove(e)})),this.remove(e))}},{key:"getAllEdgesByGroup",value:function(e){var t=this;if(e){var i=this.getEdgesByGroup(e),o=e.nodes;return o.forEach((function(e){var o=t.getEdgesByNode(e);o.forEach((function(e){-1==i.indexOf(e)&&i.push(e)}))})),i}return[]}},{key:"showAllAnch",value:function(){this.hasShowAllAnch||(this.nodes.forEach((function(e){e.time&&clearTimeout(e.time),e.anch.show()})),this.groups.forEach((function(e){e.time&&clearTimeout(e.time),e.anch.show()})),this.hasShowAllAnch=!0)}},{key:"hideAllAnch",value:function(){this.nodes.forEach((function(e){e.anch.hide()})),this.hasShowAllAnch=!1}},{key:"getEdgesByGroup",value:function(e){var t=[];return this.edges.forEach((function(i){i.fromNode!=e&&i.toNode!=e||-1==t.indexOf(i)&&t.push(i)})),t}},{key:"multipleSelect",value:function(){var e=this.selectFrame.getBoundingRect(),t=new M.a.Group,i=this.position.slice();this.nodes.forEach((function(o){var n=t.getBoundingRect([o]);n.x=n.x+i[0],n.y=n.y+i[1],e.intersect(n)?o.active():o.unactive()}))}},{key:"multipleSelectEdges",value:function(e){var t=this;this.selectGroups=[],this.fullSelectEdges=[],this.notFullSelectEdges=[];var i=e||this.getSelectNodes(),o=[],n=[];i.forEach((function(e){if("node"==e.nodeType){e.nodeGroup&&-1==t.selectGroups.indexOf(e.nodeGroup)&&t.selectGroups.push(e.nodeGroup);var a=t.getEdgesByNode(e);a.forEach((function(e){i.indexOf(e.fromNode)>-1&&i.indexOf(e.toNode)>-1?-1==n.indexOf(e)&&(n.push(e),e.oldCpx=Ki({},{},{},e.getCpx()),e.oldPos=e.position.slice()):-1==o.indexOf(e)&&(o.push(e),e.oldCpx=Ki({},{},{},e.getCpx()),e.oldPos=e.position.slice())}))}else if("group"==e.nodeType){var s=t.getEdgesByGroup(e);s.forEach((function(e){i.indexOf(e.fromNode)>-1&&i.indexOf(e.toNode)>-1?-1==n.indexOf(e)&&(n.push(e),e.oldCpx=Ki({},{},{},e.getCpx()),e.oldPos=e.position.slice()):-1==o.indexOf(e)&&(o.push(e),e.oldCpx=Ki({},{},{},e.getCpx()),e.oldPos=e.position.slice())}))}})),this.fullSelectEdges=n,this.notFullSelectEdges=o}},{key:"moveRefreshEdge",value:function(){this.fullSelectEdges.forEach((function(e){e.refresh()})),this.notFullSelectEdges.forEach((function(e){e.refresh()}))}},{key:"viewProGroup",value:function(){var e=this.getSelectNodes();e.forEach((function(e){e.nodeGroup?e.groupTime&&e.groupEndTime&&e.groupEndTime-e.groupTime>1e3&&e.nodeGroup.viewTemGroup("down",e):e.groupTime&&e.groupEndTime&&e.temporaryGroup&&e.groupEndTime-e.groupTime>1e3&&e.temporaryGroup.viewTemGroup("up",e)}))}},{key:"dropProGroup",value:function(){var e=this.getSelectNodes();e.forEach((function(e){e.nodeGroup?e.groupTime&&e.groupEndTime&&e.groupEndTime-e.groupTime>1e3&&e.nodeGroup.removeNode(e):e.groupTime&&e.groupEndTime&&e.temporaryGroup&&e.groupEndTime-e.groupTime>1e3&&e.temporaryGroup.addNode(e)}))}},{key:"moveEdge",value:function(e,t,i){this.fullSelectEdges.forEach((function(i){var o=M.a.util.clone(i.oldCpx);if(o.x1=o.x1+e,o.x2=o.x2+e,o.y1=o.y1+t,o.y2=o.y2+t,o.cpx1=o.cpx1+e,o.cpy1=o.cpy1+t,o.cpx2=o.cpx2+e,o.cpy2=o.cpy2+t,"polyline"==i.type){var n=o.points;n.forEach((function(i){i[0]=i[0]+e,i[1]=i[1]+t})),o.points=n;var a=o.lineCenter.slice();o.lineCenter[0]=a[0]+e,o.lineCenter[1]=a[1]+t}i.setCpx(o),i.refresh()})),this.notFullSelectEdges.forEach((function(e){"group"==i.nodeType&&i.create(),i.createAnchors(),e.fromNode==i?(e.setFromPoint(i.getAnchorByIndex(e.fromAnch.point.index)),e.refresh()):e.toNode==i&&(e.setToPoint(i.getAnchorByIndex(e.toAnch.point.index)),e.refresh())}))}},{key:"updateNodeAnch",value:function(){var e=this.getSelectNodes();e.forEach((function(e){e.createAnchors(),e.anch&&e.anch.refresh()}))}},{key:"setShadow",value:function(){this.nodes.forEach((function(e){return e.setShadow()})),this.groups.forEach((function(e){return e.setShadow()})),this.edges.forEach((function(e){return e.setShadow()}))}},{key:"cancelShadow",value:function(){this.nodes.forEach((function(e){return e.cancelShadow()})),this.groups.forEach((function(e){return e.cancelShadow()})),this.edges.forEach((function(e){return e.cancelShadow()}))}},{key:"leftAlign",value:function(){var e=[],t=this.getSelectNodes();if(t.length>1){var i=new M.a.Group,o=i.getBoundingRect(t);t.forEach((function(t){t.oldPos=t.position.slice();var n=i.getBoundingRect([t]),a=o.x-n.x,s=t.position.slice();s[0]=s[0]+parseInt(a),t.attr({position:s.slice()}),t.refreshEdge(),t.nodeGroup&&-1==e.indexOf(t.nodeGroup)&&e.push(t.nodeGroup)})),this.execute("moveNode",{},t),e.forEach((function(e){e.refresh()}))}}},{key:"rightAlign",value:function(){var e=[],t=this.getSelectNodes();if(t.length>1){var i=new M.a.Group,o=i.getBoundingRect(t);t.forEach((function(t){t.oldPos=t.position.slice();var n=i.getBoundingRect([t]),a=o.x+o.width-n.x-n.width,s=t.position.slice();s[0]=s[0]+parseInt(a),t.attr({position:s.slice()}),t.refreshEdge(),t.nodeGroup&&-1==e.indexOf(t.nodeGroup)&&e.push(t.nodeGroup)})),this.execute("moveNode",{},t),e.forEach((function(e){e.refresh()}))}}},{key:"verticalAlign",value:function(){var e=[],t=this.getSelectNodes();if(t.length>1){var i=new M.a.Group,o=i.getBoundingRect([t[0]]),n=o.x+o.width/2;t.forEach((function(o){if(o.oldPos=o.position.slice(),o!=t[0]){var a=i.getBoundingRect([o]),s=a.x+a.width/2,r=n-s,c=o.position.slice();c[0]=c[0]+parseInt(r),o.attr({position:c.slice()})}o.refreshEdge(),o.nodeGroup&&-1==e.indexOf(o.nodeGroup)&&e.push(o.nodeGroup)})),this.execute("moveNode",{},t),e.forEach((function(e){e.refresh()}))}}},{key:"horizontalAlign",value:function(){var e=[],t=this.getSelectNodes();if(t.length>1){var i=new M.a.Group,o=i.getBoundingRect([t[0]]),n=o.y+o.height/2;t.forEach((function(o){if(o.oldPos=o.position.slice(),o!=t[0]){var a=i.getBoundingRect([o]),s=a.y+a.height/2,r=n-s,c=o.position.slice();c[1]=c[1]+parseInt(r),o.attr({position:c.slice()})}o.refreshEdge(),o.nodeGroup&&-1==e.indexOf(o.nodeGroup)&&e.push(o.nodeGroup)})),this.execute("moveNode",{},t),e.forEach((function(e){e.refresh()}))}}},{key:"createGroup",value:function(){var e,t=this.getSelectNodes();if(t.length>1){var i=t.every((function(e){return!e.nodeGroup}));if(i)e=new zi(t),e.editor=this,this.execute("createGroup",{group:e});else{var o=t.every((function(e){return e.nodeGroup}));if(o){var n=t[0].nodeGroup,a=t.every((function(e){return e.nodeGroup==n}));if(a){var s=n.getLevel();e=new zi(t,"新建分组","#fafafa","#ccc","#333","dash",s+1),e.editor=this,e.topGroup=n,this.execute("createGroup",{group:e,topGroup:n})}}}}}},{key:"listen",value:function(e,t){this.zr.on(e,t)}},{key:"removeListen",value:function(e,t){this.zr.off(e,t)}},{key:"emit",value:function(e,t){this.zr.trigger(e,t)}},{key:"addGroup",value:function(e){var t=this;-1==this.groups.indexOf(e)&&(this.add(e),e.anch.bars.forEach((function(e){t.add(e)})),this.groups.push(e),e.editor=this)}},{key:"removeGroup",value:function(e){var t=this,i=this.groups.indexOf(e);i>-1&&(this.groups.splice(i,1),this.remove(e),e.anch.bars.forEach((function(e){t.remove(e)})))}},{key:"refreshGroup",value:function(){this.groups.forEach((function(e){e.refresh()}))}},{key:"showAnch",value:function(e,t){if("selectEdge"!=this.status&&"selectFrame"!=this.status){var i=new M.a.Group,o=this.position.slice(),n=0;"isCreateLink"!=this.status&&"changeEdge"!=this.status||(n=30);var a=this.nodes.concat(this.groups);a.forEach((function(a){if(a.dragging)a.anch&&a.anch.hide();else{var s=i.getBoundingRect([a]);s.x=s.x+o[0]-n,s.y=s.y+o[1]-n,s.width=s.width+2*n,s.height=s.height+2*n,s.contain(e,t)?a.anch&&a.anch.show():a.anch&&a.anch.hide()}}))}}},{key:"offEvent",value:function(){this.zr.off()}},{key:"initEvent",value:function(){var e=this;function t(e,t){clearTimeout(e.tId),e.tId=setTimeout((function(){e.call(t)}),300)}window.onresize=function(){t((function(){var t=document.getElementById("combineCavans").offsetWidth,i=document.getElementById("combineCavans").offsetHeight;e.zr.resize({width:t,height:i}),window.console.log(t,i)}))},this.zr.on("clearSelectItems",(function(){e.clearSelectItems()})),this.zr.on("judgeWidthGroup",(function(){e.judgeWidthGroup()})),this.zr.on("viewProGroup",(function(){e.viewProGroup()})),this.zr.on("hideFrame",(function(){e.frame.hide()})),this.zr.on("selectFrame",(function(){e.status="selectFrame"})),this.zr.on("refreshEdge",(function(t){var i,o=t.node;i="node"==o.nodeType?e.getEdgesByNode(o):e.getEdgesByGroup(o),i.forEach((function(e){e.fromNode==o?(e.setFromPoint(o.getAnchorByIndex(e.fromAnch.point.index)),e.refresh()):e.toNode==o&&(e.setToPoint(o.getAnchorByIndex(e.toAnch.point.index)),e.refresh())}))})),this.zr.on("removeNodeFromGroup",(function(t){e.execute("removeNodeFromGroup",{node:t.node})})),this.zr.on("addNodeToGroup",(function(t){e.execute("addNodeToGroup",t)})),this.zr.on("resizeNode",(function(t){e.execute("resizeNode",t)})),this.zr.on("refreshSelectGroup",(function(){e.selectGroups.forEach((function(e){return e.refresh()}))}));var i,o,n,a,s=!1,r=0,c=0,h=!1,l=0,d=0,u=null,f=function(){},p=function t(){e.selectFrame.attr({shape:{x:0,y:0,width:0,heigt:0}}),e.status="",e.selectFrame.hide(),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",t)};this.zr.on("mousedown",(function(t){if(r=t.offsetX,c=t.offsetY,s=!0,u=e.position.slice(),t.target||(e.zr.trigger("clearSelectItems"),"selectFrame"==e.status&&(e.selectFrame.attr({shape:{x:r,y:c}}),e.selectFrame.show()),document.addEventListener("mousemove",f),document.addEventListener("mouseup",p)),t.target){if(t.target.mark&&"anch"==t.target.mark){if(h&&i)return e.remove(i),e.status="",void(h=!1);a=t.target,e.status="isCreateLink",h=!0,i=new ji(a.node),i.setFromPoint(Ki({},a.point)),i.fromAnch=a,e.add(i)}var l=e.getSelectNodes();l.forEach((function(e){e.oldPos=e.position.slice()})),"node"==t.target.nodeType&&e.multipleSelectEdges(),t.target.edge&&(e.status="changeEdge",o=t.target.edge,n=t.target)}})),this.zr.on("mousemove",(function(t){if(l=t.offsetX-r,d=t.offsetY-c,e.showAnch(t.offsetX,t.offsetY),s){if((h||"changeEdge"==e.status)&&h&&i.move(t.offsetX-u[0],t.offsetY-u[1]),"selectFrame"==e.status)return;if(!h&&t.target&&"node"==t.target.nodeType){if("resizeNode"==e.status||"changeEdge"==e.status)return;e.moveNode(l,d),e.viewProGroup()}if("changeEdge"==e.status&&o&&n){var a=n.oldCenter.x,f=n.oldCenter.y;n.attr({shape:{cx:a+l,cy:f+d}}),"from"==n.edgeType?o.setFromPoint({x:a+l,y:f+d},!0):o.setToPoint({x:a+l,y:f+d})}}})),this.zr.on("mouseup",(function(t){if(t.target&&t.target.mark&&"anch"==t.target.mark){if(h){if(t.target==a)return e.removeEdge(i),void(e.status="");try{i.setToNode(t.target.node),i.setToPoint(Ki({},t.target.point)),i.toAnch=t.target,e.execute("addEdge",{edge:i})}catch(t){e.removeEdge(i),i=null,e.status=""}finally{i=null,e.status=""}}if("changeEdge"==e.status){if("from"==n.edgeType)if(o.fromNode){if(o.fromAnch!=t.target){var l=o.fromNode,d=o.fromAnch;e.execute("changeEdge",{edge:o,type:"changeAnch",position:"from",oldNode:l,oldAnch:d,newNode:t.target.node,newAnch:t.target,mark:"anch"})}}else e.execute("changeEdge",{edge:o,type:"changeAnch",position:"from",oldCenter:Ki({},n.oldCenter),newCenter:{x:n.shape.cx,y:n.shape.cy},newNode:t.target.node,newAnch:t.target,mark:"point"});else if(o.toNode){if(o.toAnch!=t.target){var u=o.toNode,f=o.toAnch;e.execute("changeEdge",{edge:o,type:"changeAnch",position:"to",oldNode:u,oldAnch:f,newNode:t.target.node,newAnch:t.target,mark:"anch"})}}else e.execute("changeEdge",{edge:o,type:"changeAnch",position:"to",oldCenter:Ki({},n.oldCenter),newCenter:{x:n.shape.cx,y:n.shape.cy},newNode:t.target.node,newAnch:t.target,mark:"point"});o.refresh(),e.status="",n=null,o=null}}if("changeEdge"==e.status){if("from"==n.edgeType)if(o.fromNode){var p=o.fromNode,g=o.fromAnch;o.removeFromNode(),e.execute("changeEdge",{edge:o,type:"changeAnch",position:"from",oldNode:p,oldAnch:g,oldCenter:Ki({},n.oldCenter),newCenter:{x:n.shape.cx,y:n.shape.cy},mark:"anch"})}else e.execute("changeEdge",{edge:o,type:"changeAnch",position:"from",oldCenter:Ki({},n.oldCenter),newCenter:{x:n.shape.cx,y:n.shape.cy},mark:"point"});else if(o.toNode)if(o.toNode){var y=o.toNode,m=o.toAnch;o.removeToNode(),e.execute("changeEdge",{edge:o,type:"changeAnch",position:"to",oldNode:y,oldAnch:m,oldCenter:Ki({},n.oldCenter),newCenter:{x:n.shape.cx,y:n.shape.cy},mark:"anch"})}else e.execute("changeEdge",{edge:o,type:"changeAnch",position:"to",oldCenter:Ki({},n.oldCenter),newCenter:{x:n.shape.cx,y:n.shape.cy},mark:"point"});e.status="",n=null,o=null}i&&e.remove(i),e.selectFrame.ignore?e.updateNodeAnch():e.zr.trigger("selectNodes"),h=!1,s=!1,r=0,c=0}))}}]),t}(M.a.Group),Qi=Xi,Vi={name:"Combine",data:function(){return{showCombine:!1,combine:{name:"",safe:{up:0,right:0,down:0,left:0,operation:0,back:0}},alignType:"0"}},mounted:function(){var e=this;m.$on("showCombine",(function(t){e.showCombine=t.isShow,e.editor=new Qi("combineEditor")}))},methods:{dragover:function(e){e.preventDefault()},dragstart:function(e){e.preventDefault()},drop:function(e){this.editor.alignType=this.alignType;var t,i,o=e.dataTransfer.getData("addShape");e.offsetX?(t=parseInt(e.offsetX)+.5,i=parseInt(e.offsetY)+.5):(t=parseInt(e.pageX)+.5-140,i=parseInt(e.pageY)+.5-50);try{var n=JSON.parse(o);n["x"]=t,n["y"]=i,n.alignType=this.alignType,this.editor.addShape(n)}catch(a){}},trim:function(e){return e.replace(/^\s+|\s+$/gm,"")},deleteAll:function(){this.editor.execute("deleteAll",{node:this.node})},addCombine:function(){var e=0,t=0,i=this.editor.nodes;if(""!==this.combine.name&&i.length>0){for(var o=0;o<i.length;o++)e+=i[o].data.shape.width,t=Math.max(t,i[o].data.shape.height);var n=function(e){for(var t=0,i=0;i<e.length;i++)t+=e[i].originData.cost;return t},a={width:e,height:t,safe:this.combine.safe,kind:5,name:this.combine.name,nodes:this.editor.nodes.slice(),alignType:this.alignType,alignFace:"0",face:"0"===this.alignType?"2":"0",cost:n(this.editor.nodes)};m.$emit("addCombine",{node:a}),this.closeCombine()}},closeCombine:function(){this.showCombine=!1,m.$emit("closeCombine")},updateAlign:function(e){this.editor.updateAlign(e)}}},Zi=Vi,eo=(i("cf4f"),Object(w["a"])(Zi,qi,Yi,!1,null,"5d3cbf3c",null)),to=eo.exports,io=(i("4d63"),i("466d"),function(){var e=navigator.userAgent.toLowerCase(),t=window.opera,i={ie:/(msie\s|trident.*rv:)([\w.]+)/.test(e),opera:!!t&&t.version,webkit:e.indexOf(" applewebkit/")>-1,mac:e.indexOf("macintosh")>-1,quirks:"BackCompat"==document.compatMode};i.gecko="Gecko"==navigator.product&&!i.webkit&&!i.opera&&!i.ie;var o=0;if(i.ie){var n=e.match(/(?:msie\s([\w.]+))/),a=e.match(/(?:trident.*rv:([\w.]+))/);o=n&&a&&n[1]&&a[1]?Math.max(1*n[1],1*a[1]):n&&n[1]?1*n[1]:a&&a[1]?1*a[1]:0,i.ie11Compat=11==document.documentMode,i.ie9Compat=9==document.documentMode,i.ie8=!!document.documentMode,i.ie8Compat=8==document.documentMode,i.ie7Compat=7==o&&!document.documentMode||7==document.documentMode,i.ie6Compat=o<7||i.quirks,i.ie9above=o>8,i.ie9below=o<9}return/chrome\/(\d+\.\d)/i.test(e)&&(i.chrome=+RegExp["$1"]),/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(e)&&!/chrome/i.test(e)&&(i.safari=+(RegExp["$1"]||RegExp["$2"])),i.opera&&(o=parseFloat(t.version())),i.webkit&&(o=parseFloat(e.match(/ applewebkit\/(\d+)/)[1])),i.version=o,i.isCompatible=!i.mobile&&(i.ie&&o>=6||i.gecko&&o>=10801||i.opera&&o>=9.5||i.air&&o>=1||i.webkit&&o>=522||!1),i}),oo=io,no=function(){function e(e){for(var t in e)e[t.toUpperCase()]=e[t];return e}var t=function(e){for(var t=arguments,i=1;i<t.length;i++){var o=t[i];for(var n in o)e.hasOwnProperty(n)||(e[n]=o[n])}return e},i=e({isindex:1,fieldset:1}),o=e({input:1,button:1,select:1,textarea:1,label:1}),n=t(e({a:1}),o),a=t({iframe:1},n),s=e({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),r=e({ins:1,del:1,script:1,style:1}),c=t(e({b:1,acronym:1,bdo:1,var:1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),r),h=t(e({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),c),l=t(e({p:1}),h),d=t(e({iframe:1}),h,o),u=e({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,var:1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),f=t(e({a:0}),d),p=e({tr:1}),g=e({"#":1}),y=t(e({param:1}),u),m=t(e({form:1}),i,a,s,l),x=e({li:1,ol:1,ul:1}),v=e({style:1,script:1}),w=e({base:1,link:1,meta:1,title:1}),b=t(w,v),k=e({head:1,body:1}),S=e({html:1}),A=e({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),O=e({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return e({$nonBodyContent:t(S,k,w),$block:A,$inline:f,$inlineWithA:t(e({a:1}),f),$body:t(e({script:1,style:1}),A),$cdata:e({script:1,style:1}),$empty:O,$nonChild:e({iframe:1,textarea:1}),$listItem:e({dd:1,dt:1,li:1}),$list:e({ul:1,ol:1,dl:1}),$isNotEmpty:e({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:e({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,var:1}),$removeEmptyBlock:e({p:1,div:1}),$tableContent:e({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:e({pre:1,script:1,style:1,textarea:1}),html:k,head:b,style:g,script:g,body:m,base:{},link:{},meta:{},title:g,col:{},tr:e({td:1,th:1}),img:{},embed:{},colgroup:e({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:m,td:m,br:{},th:m,center:m,kbd:f,button:t(l,s),basefont:{},h5:f,h4:f,samp:f,h6:f,ol:x,h1:f,h3:f,option:g,h2:f,form:t(i,a,s,l),select:e({optgroup:1,option:1}),font:f,ins:f,menu:x,abbr:f,label:f,table:e({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:f,tfoot:p,cite:f,li:m,input:{},iframe:m,strong:f,textarea:g,noframes:m,big:f,small:f,span:e({"#":1,br:1,b:1,strong:1,u:1,i:1,em:1,sub:1,sup:1,strike:1,span:1}),hr:f,dt:f,sub:f,optgroup:e({option:1}),param:{},bdo:f,var:f,div:m,object:y,sup:f,dd:m,strike:f,area:{},dir:x,map:t(e({area:1,form:1,p:1}),i,r,s),applet:y,dl:e({dt:1,dd:1}),del:f,isindex:{},fieldset:t(e({legend:1}),u),thead:p,ul:x,acronym:f,b:f,a:t(e({a:1}),d),blockquote:t(e({td:1,tr:1,tbody:1,li:1}),m),caption:f,i:f,u:f,tbody:p,s:f,address:t(a,l),tt:f,legend:f,q:f,pre:t(c,n),p:t(e({a:1}),f),em:f,dfn:f})},ao=no;function so(e){return e?e.replace(/&((g|l|quo)t|amp|#39);/g,(function(e){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'"}[e]})):""}var ro=oo().ie&&"6"==oo().version?"\ufeff":"​",co=function(e){var t=new RegExp(ro,"g"),i=e.replace(/[\n\r]/g,"");return i=i.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,(function(e,t,i){return ao().$block[i]?"\n":t||""})),so(i.replace(t,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," "))},ho=co,lo={name:"Editor",components:{Edit:Hi,Combine:to},data:function(){return{left:0,top:0,width:0,height:0,text:"",plainTxt:"",editModel:!1,icon:[],colors:"#194d33",show:!1,edge:null,showInfoDraw:!1,offsetX:0,dowloadDetail:{isShow:!1,name:""},columns:[{title:"设备名",key:"name"},{title:"数量(个)",key:"count"},{title:"花费(元)",key:"cost"}],datas:[],summary:0}},mounted:function(){var e=this,t=this;function i(e){if(window.getSelection){e.focus();var t=window.getSelection();t.selectAllChildren(e),t.collapseToEnd()}else if(document.selection){var i=document.selection.createRange();i.moveToElementText(e),i.collapse(!1),i.select()}}this.editor=new Ri("flowEditor"),m.$on("leftAlign",(function(){e.editor.leftAlign()})),m.$on("rightAlign",(function(){e.editor.rightAlign()})),m.$on("horizontalAlign",(function(){e.editor.horizontalAlign()})),m.$on("verticalAlign",(function(){e.editor.verticalAlign()})),m.$on("createGroup",(function(){e.editor.createGroup()})),m.$on("redo",(function(){e.editor.redo()})),m.$on("undo",(function(){e.editor.undo()})),m.$on("undo",(function(){e.editor.undo()})),m.$on("updateOffsetX",(function(t){e.offsetX=t.x})),m.$on("showInfoDraw",(function(){"selectNode"==e.status&&m.$emit("showInfoDrawWithNode",{node:e.node})})),m.$on("rotate",(function(){"selectNode"!=e.status&&"selectNodes"!=e.status||e.editor.rotate("node",e.node)})),m.$on("initFlow",(function(t){try{e.editor.clearHistory(),e.editor.refreshHistory(),e.editor.init(t.data),m.$emit("refreshMap",{editor:e.editor})}catch(t){window.console.log(t),alert("不支持的数据")}})),m.$on("copy",(function(){e.editStatus||("selectNode"==e.status||"selectNodes"==e.status?e.editor.copy("node",e.editor.getSelectNodes()):"selectGroup"==e.status&&e.editor.copy("group",e.group))})),m.$on("mirror",(function(){e.editStatus||"selectNode"!=e.status&&"selectNodes"!=e.status||e.editor.mirror("node",e.node)})),m.$on("delete",(function(){"selectNode"==e.status?e.editor.execute("deleteNode",{node:e.node}):"selectNodes"==e.status?e.editor.execute("deleteNodes",{nodes:e.nodes}):"selectGroup"==e.status?e.editor.execute("deleteGroup",{group:e.group}):"selectEdge"==e.status&&e.editor.execute("deleteEdge",{edge:e.edge})})),m.$on("deleteAll",(function(){e.editor.execute("deleteAll",{node:e.node})})),m.$on("saveData",(function(){e.exportDesign(),t.dowloadDetail.isShow=!0})),m.$on("changeNode",(function(t){var i=t.nodes||e.editor.getSelectNodes();e.editor.execute("changeNode",t,i)})),m.$on("align",(function(t){e.editor[t.align]&&e.editor[t.align]()})),m.$on("changeGroup",(function(t){e.editor.execute("changeGroup",t)})),m.$on("changeEdge",(function(t){e.editor.execute("changeEdge",t)})),m.$on("ungroup",(function(){e.editStatus||"selectGroup"==e.status&&e.editor.execute("ungroup",{group:e.group})})),m.$on("selectFrame",(function(){e.editor.emit("selectFrame")})),m.$on("shadow",(function(t){var i=t.shadow;i?e.editor.setShadow():e.editor.cancelShadow()})),this.editor.listen("selectNode",(function(e){t.status="selectNode",t.node=e.node,m.$emit("selectNode",{node:e.node}),2!==e.node.kind&&3!==e.node.kind||t.editor.checkObstaceDistance(e.node)})),this.editor.listen("selectNodes",(function(i){if(i&&i.nodes.length>1)t.status="selectNodes",t.nodes=i.nodes,m.$emit("selectNodes",{nodes:i.nodes});else{var o=e.editor.getSelectNodes();1==o.length?(t.status="selectNode",t.node=o[0],m.$emit("selectNode",{node:o[0]})):o.length>1&&(t.status="selectNodes",t.nodes=o,m.$emit("selectNodes",{nodes:o}))}})),this.editor.listen("selectGroup",(function(e){t.status="selectGroup",t.group=e.group,m.$emit("selectGroup",e)})),this.editor.listen("selectEdge",(function(i){t.status="selectEdge",e.editor.status="selectEdge",t.edge=i.edge,m.$emit("selectEdge",i)})),this.editor.listen("undoredo",(function(t){m.$emit("undoredo",t),m.$emit("refreshMap",{editor:e.editor})})),this.editor.listen("clearSelectItems",(function(){m.$emit("clearSelect"),e.editor.execute("clearOBAlert",e.node)})),this.editor.listen("edit",(function(o){t.editStatus=o.status;var n=new M.a.Group,a=null,s=o.text,r=null;switch(t.editModel=!0,o.status){case"editNode":t.node=o.node,a=n.getBoundingRect([e.node]),t.left=a.x+e.editor.position[0],t.top=a.y+e.editor.position[1],t.width=a.width,t.height=a.height,t.text=t.domText(s),s="";break;case"editGroup":t.editGroup=o.group,a=n.getBoundingRect([t.group.groupHead]),r=n.getBoundingRect([t.group]),t.left=r.x+e.editor.position[0],t.top=r.y+e.editor.position[1],t.width=a.width,t.height=a.height,t.text=t.domText(s),s="";break;case"editEdge":t.edge=o.edge;var c=o.edge.getData();if(c.text)a=n.getBoundingRect([o.edge.relateText]),t.left=a.x+e.editor.position[0],t.top=a.y+e.editor.position[1],t.width=a.width,t.height=a.height,t.text=t.domText(c.text);else{var h=c.cpx;t.left=h.x1+e.editor.position[0],t.top=h.y1+e.editor.position[1],t.width=80,t.height=20}break}t.$nextTick((function(){i(t.$refs["edit"].$el)}))}))},methods:{dragover:function(e){e.preventDefault()},dragstart:function(e){e.preventDefault()},drop:function(e){if("none"==document.getElementById("combine").style.display){var t,i,o=e.dataTransfer.getData("addShape");e.offsetX?(t=parseInt(e.offsetX)+.5,i=parseInt(e.offsetY)+.5):(t=parseInt(e.pageX)+.5-140,i=parseInt(e.pageY)+.5-50);try{var n=JSON.parse(o);n["x"]=t,n["y"]=i,this.editor.addShape(n)}catch(a){}}},trim:function(e){return e.replace(/^\s+|\s+$/gm,"")},exportDesign:function(){this.dowloadDetail.isShow=!0;for(var e=[],t=this.editor.facilities,i=0,o=0;o<t.length;o++){for(var n=!1,a=0;a<e.length;a++)t[o].originData.name===e[a].name&&(e[a].count++,e[a].cost+=t[o].originData.cost,i+=t[o].originData.cost,n=!0);n||(e.push({name:t[o].originData.name,count:1,cost:t[o].originData.cost}),i+=t[o].originData.cost)}this.datas=e,this.summary=i},removeDowloadMsg:function(){var e=this.editor.downLoadText;e&&e.length>0&&this.editor.execute("deleteNodes",{nodes:e})},AddText:function(e){var t={style:{text:e.name,fontSize:e.size,fontWeight:e.isBold?"bold":"normal"},command:"text",position:[0,0],draggable:!1,x:e.x,y:e.y,kind:6};this.editor.execute("addShape",t)},buildDownloadMsg:function(){this.removeDowloadMsg();var e=30;this.AddText({name:"设计图:",size:20,isBold:!1,x:this.offsetX+5,y:10}),this.AddText({name:this.dowloadDetail.name,size:40,isBold:!0,x:this.offsetX+900,y:e}),e+=40;for(var t=0;t<this.datas.length;t++)e+=30,this.AddText({name:this.datas[t].name,size:20,isBold:!1,x:this.offsetX+900,y:e}),this.AddText({name:this.datas[t].count+"个",size:20,isBold:!1,x:this.offsetX+1100,y:e}),this.AddText({name:this.datas[t].cost+"元",size:20,isBold:!1,x:this.offsetX+1250,y:e});e+=40,this.AddText({name:"总计： "+this.summary+"元",size:30,isBold:!0,x:this.offsetX+900,y:e})},download:function(e){if(""!==this.dowloadDetail.name){var t=null,i=null;switch(e){case"json":var o=JSON.stringify(this.editor._());this.downloadFile(o,"flowchart.json");break;case"png":this.buildDownloadMsg(),t={x:0,y:0,width:1800,height:800},document.getElementById("download-canvas").style.width=t.width+"px",document.getElementById("download-canvas").style.height=t.height+"px",i=new Ri("download-canvas"),i.init(JSON.parse(JSON.stringify(this.editor.getData())),!0),i.attr({position:[-parseInt(t.x),-parseInt(t.y)]});try{i.zr.painter.getRenderedCanvas({backgroundColor:"white"}).toBlob((function(e){var t=window.URL.createObjectURL(e);window.console.log(t),window.open(t)}),"image/png")}catch(n){document.getElementById("download-win").style.display="block"}break}this.removeDowloadMsg()}},downloadFile:function(e,t){var i=document.createElement("a"),o=new Blob([e]),n=window.URL.createObjectURL(o);i.href=n,i.download=t,i.click(),window.URL.revokeObjectURL(n)},updateText:function(){var e=ho(this.text);this.plainTxt=this.trim(e),"editNode"==this.editStatus&&m.$emit("changeNode",{style:{text:this.trim(e)},nodes:[this.node]}),"editGroup"==this.editStatus&&m.$emit("changeGroup",{mark:"head",style:{text:this.trim(e)},group:this.editGroup}),"editEdge"==this.editStatus&&m.$emit("changeEdge",{mark:"text",style:{text:this.trim(e)},edge:this.edge}),this.editModel=!1,this.editStatus="",this.text="",this.plainTxt=""},domText:function(e){var t=[],i=e.split("\n");return i.forEach((function(e){t.push("<div>"+e+"</div>")})),t.join("")},closeDownLoadWin:function(){document.getElementById("download-win").style.display="none"}}},uo=lo,fo=(i("791a"),Object(w["a"])(uo,N,F,!1,null,"5a0648a2",null)),po=fo.exports,go=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"property"},[i("v-canvas",{directives:[{name:"show",rawName:"v-show",value:e.showCanvas,expression:"showCanvas"}]}),i("Node",{directives:[{name:"show",rawName:"v-show",value:e.showNode,expression:"showNode"}]}),i("Group",{directives:[{name:"show",rawName:"v-show",value:e.showGroup,expression:"showGroup"}]}),i("Edge",{directives:[{name:"show",rawName:"v-show",value:e.showEdge,expression:"showEdge"}]})],1)},yo=[],mo=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"node",on:{click:function(t){return e.hideWin(t)}}},[i("div",{staticClass:"node-header"},[e._v(" "+e._s(e.text)+" ")]),i("div",{staticClass:"section-group clearfix"},[i("h3",[e._v(e._s(e.$t("node.head")))]),i("p",[i("span",[e._v(e._s(e.$t("node.fill")))]),i("span",{staticClass:"color-picker",style:{background:e.nodeData.style.fill},on:{click:function(t){return t.stopPropagation(),e.showColorPicker("fill")}}}),i("Sketch-picker",{directives:[{name:"show",rawName:"v-show",value:e.nodeData.fillshow,expression:"nodeData.fillshow"}],on:{input:e.updateFill},model:{value:e.nodeData.style.fill,callback:function(t){e.$set(e.nodeData.style,"fill",t)},expression:"nodeData.style.fill"}})],1),i("p",[i("span",[e._v(e._s(e.$t("node.stroke")))]),i("span",{staticClass:"color-picker",style:{background:e.nodeData.style.stroke},on:{click:function(t){return t.stopPropagation(),e.showColorPicker("stroke")}}}),i("Sketch-picker",{directives:[{name:"show",rawName:"v-show",value:e.nodeData.strokeshow,expression:"nodeData.strokeshow"}],on:{input:e.updateStroke},model:{value:e.nodeData.style.stroke,callback:function(t){e.$set(e.nodeData.style,"stroke",t)},expression:"nodeData.style.stroke"}})],1)]),i("div",{staticClass:"section-group clearfix"},[i("h3",[e._v(e._s(e.$t("node.font")))]),i("p",[i("span",[e._v(e._s(e.$t("node.fontSize")))]),i("span",{staticClass:"font-size right color-picker",on:{click:function(t){return t.stopPropagation(),e.showColorPicker("fontsize")}}},[e._v(e._s(e.nodeData.style.fontSize))]),i("ul",{directives:[{name:"show",rawName:"v-show",value:e.nodeData.fontsizeshow,expression:"nodeData.fontsizeshow"}],staticClass:"font-size-select"},e._l(e.fontsize,(function(t){return i("li",{key:t,on:{click:function(i){return e.pickFontSize(t)}}},[e._v(e._s(t))])})),0)]),i("p",[i("span",[e._v(e._s(e.$t("node.textFill")))]),i("span",{staticClass:"color-picker",style:{background:e.nodeData.style.textFill},on:{click:function(t){return t.stopPropagation(),e.showColorPicker("textFill")}}}),i("Sketch-picker",{directives:[{name:"show",rawName:"v-show",value:e.nodeData.textfillshow,expression:"nodeData.textfillshow"}],on:{input:e.updateTextFill},model:{value:e.nodeData.style.textFill,callback:function(t){e.$set(e.nodeData.style,"textFill",t)},expression:"nodeData.style.textFill"}})],1),i("p",[i("span",{staticClass:"left"},[e._v(e._s(e.$t("node.fontStyle")))]),i("span",{class:"textPos right iconfont icon-qingxie"+("italic"==e.nodeData.style.fontStyle?" active":""),on:{click:function(t){return e.setStyle(t)}}}),i("span",{class:"textPos right iconfont icon-jiacu"+("bold"==e.nodeData.style.fontWeight?" active":""),on:{click:function(t){return e.setBold(t)}}})]),i("p",[i("span",{staticClass:"left"},[e._v(e._s(e.$t("node.position")))]),i("span",{class:"textPos right iconfont icon-you"+("left"==e.nodeData.style.textPosition?" active":""),staticStyle:{transform:"rotate(180deg)"},on:{click:function(t){return e.setTextPos(t,"left")}}}),i("span",{class:"textPos right iconfont icon-arrow-down-last"+("bottom"==e.nodeData.style.textPosition?" active":""),on:{click:function(t){return e.setTextPos(t,"bottom")}}}),i("span",{class:"textPos right iconfont icon-you"+("right"==e.nodeData.style.textPosition?" active":""),on:{click:function(t){return e.setTextPos(t,"right")}}}),i("span",{class:"textPos right iconfont icon-arrow-down-last"+("top"==e.nodeData.style.textPosition?" active":""),staticStyle:{transform:"rotate(180deg)"},on:{click:function(t){return e.setTextPos(t,"top")}}}),i("span",{class:"textPos right iconfont icon-juzhong"+("inside"==e.nodeData.style.textPosition?" active":""),on:{click:function(t){return e.setTextPos(t,"inside")}}})])]),e.multipleSelect?i("div",{staticClass:"section-group clearfix"},[i("h3",[e._v(e._s(e.$t("node.nodeAlign")))]),i("ul",[i("li",{staticClass:"iconfont icon-halign",on:{click:function(t){return e.align("horizontalAlign")}}}),i("li",{staticClass:"iconfont icon-juzhongduiqi",on:{click:function(t){return e.align("verticalAlign")}}}),i("li",{staticClass:"iconfont icon-align-left",on:{click:function(t){return e.align("leftAlign")}}}),i("li",{staticClass:"iconfont icon-youduiqi",on:{click:function(t){return e.align("rightAlign")}}})])]):e._e(),i("div",{staticClass:"section-group clearfix"},[i("h3",[e._v(e._s(e.$t("node.prefabrication")))]),i("ul",{staticClass:"theme"},e._l(e.preStyle,(function(t,o){return i("li",{key:o,staticClass:"theme-item",style:{background:t.fill,"border-color":t.stroke},on:{click:function(i){return e.changeNodeStyle(t)}}})})),0)])])},xo=[],vo=i("c345"),wo={node:[{fill:"rgb(231,253,250)",stroke:"rgb(149, 231, 226)",textFill:"#333"},{fill:"#e7f7fe",stroke:"#b2defe",textFill:"#333"},{fill:"#fef7e7",stroke:"#fedcab",textFill:"#333"},{fill:"#f8f0fe",stroke:"#d7bdf4",textFill:"#333"},{fill:"rgb(255, 218, 218)",stroke:"rgb(247, 155, 155)",textFill:"#333"},{fill:"#fbfbca",stroke:"#f7f71c",textFill:"#333"},{fill:"#7EA6E0",stroke:"#333",textFill:"#333"},{fill:"#FFCE9F",stroke:"#333",textFill:"#333"},{fill:"#A9C4EB",stroke:"#333",textFill:"#333"},{fill:"#DFEFCA",stroke:"#333",textFill:"#333"},{fill:"#D1F5FF",stroke:"#333",textFill:"#333"},{fill:"#D4AEF9",stroke:"#333",textFill:"#333"},{fill:"#80beaf",stroke:"#333",textFill:"#333"},{fill:"#b3ddd1",stroke:"#333",textFill:"#333"},{fill:"#d1dce2",stroke:"#333",textFill:"#333"},{fill:"#f58994",stroke:"#333",textFill:"#333"},{fill:"#ee9c6c",stroke:"#333",textFill:"#333"},{fill:"#86e3ce",stroke:"#333",textFill:"#333"},{fill:"#d0e6a5",stroke:"#333",textFill:"#333"},{fill:"#ffdd94",stroke:"#333",textFill:"#333"},{fill:"#fa897b",stroke:"#333",textFill:"#333"},{fill:"#ccabd8",stroke:"#333",textFill:"#333"},{fill:"#60efdb",stroke:"#333",textFill:"#333"},{fill:"#bef2e5",stroke:"#333",textFill:"#333"},{fill:"#c5e7f1",stroke:"#333",textFill:"#333"},{fill:"#79ceed",stroke:"#333",textFill:"#333"},{fill:"#6f89a2",stroke:"#333",textFill:"#333"},{fill:"#dea3dc",stroke:"#333",textFill:"#333"},{fill:"#f7db70",stroke:"#333",textFill:"#333"},{fill:"#eabebf",stroke:"#333",textFill:"#333"},{fill:"#75cce8",stroke:"#333",textFill:"#333"},{fill:"#a5dee5",stroke:"#333",textFill:"#333"},{fill:"#5d7599",stroke:"#333",textFill:"#333"},{fill:"#abb6c8",stroke:"#333",textFill:"#333"},{fill:"#dadada",stroke:"#333",textFill:"#333"},{fill:"#f7f0c6",stroke:"#333",textFill:"#333"},{fill:"#c2c4b6",stroke:"#333",textFill:"#333"},{fill:"#478ba2",stroke:"#333",textFill:"#333"},{fill:"#de5b6d",stroke:"#333",textFill:"#333"},{fill:"#e9765b",stroke:"#333",textFill:"#333"},{fill:"#f2a490",stroke:"#333",textFill:"#333"},{fill:"#b9d4db",stroke:"#333",textFill:"#333"}],group:[{headStyle:{fill:"#F1ECAA",stroke:"#333",textFill:"#333",textPosition:"insideLeft",fontSize:14,fontStyle:"normal",fontWeight:"normal"},groupStyle:{fill:"#F0BABA",stroke:"#333"}},{headStyle:{fill:"#FD9973",stroke:"#333",textFill:"#333",textPosition:"insideLeft",fontSize:14,fontStyle:"normal",fontWeight:"normal"},groupStyle:{fill:"#5AC39D",stroke:"#333"}},{headStyle:{fill:"#5AB978",stroke:"#333",textFill:"#333",textPosition:"insideLeft",fontSize:14,fontStyle:"normal",fontWeight:"normal"},groupStyle:{fill:"#DD727F",stroke:"#333"}}]},bo=wo;function ko(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function So(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ko(Object(i),!0).forEach((function(t){Object(G["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ko(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var Ao={name:"Node",components:{"Sketch-picker":vo["Sketch"]},data:function(){return{text:"Single Node",multipleSelect:!1,fontsize:[8,10,12,14,16,18,20,24,28,32,36,40],nodeData:{fillshow:!1,strokeshow:!1,textfillshow:!1,fontsizeshow:!1,style:{fill:"#fff",stroke:"transparent",textFill:"transparent",text:"",lineWidth:1,opacity:1,fontSize:12,fontWeight:"normal",fontStyle:"italic",textPosition:"inside"},shape:{},z:10},preStyle:bo.node}},mounted:function(){var e=this;m.$on("selectNode",(function(t){e.text="Single Node",e.multipleSelect=!1,e.node=t.node;var i=e.node.getData();e.nodeData=So({},e.nodeData,{},i)})),m.$on("selectNodes",(function(t){e.text="Multiple Node",e.multipleSelect=!0,e.nodes=t.nodes})),m.$on("changeLanguage",(function(e){h(e.language)})),this.language=localStorage.getItem("localeLanguage")||"zh",h(this.language)},methods:{align:function(e){m.$emit("align",{align:e})},showColorPicker:function(e){switch(e){case"fill":this.nodeData.strokeshow=!1,this.nodeData.textfillshow=!1,this.nodeData.fontsizeshow=!1,this.nodeData.fillshow?this.nodeData.fillshow=!1:this.nodeData.fillshow=!0;break;case"stroke":this.nodeData.fillshow=!1,this.nodeData.textfillshow=!1,this.nodeData.fontsizeshow=!1,this.nodeData.strokeshow?this.nodeData.strokeshow=!1:this.nodeData.strokeshow=!0;break;case"textFill":this.nodeData.fillshow=!1,this.nodeData.strokeshow=!1,this.nodeData.fontsizeshow=!1,this.nodeData.textfillshow?this.nodeData.textfillshow=!1:this.nodeData.textfillshow=!0;break;case"fontsize":this.nodeData.fillshow=!1,this.nodeData.strokeshow=!1,this.nodeData.textfillshow=!1,this.nodeData.fontsizeshow?this.nodeData.fontsizeshow=!1:this.nodeData.fontsizeshow=!0;break}},updateFill:function(e){var t=e.rgba,i="rgba(".concat(t.r,",").concat(t.g,",").concat(t.b,",").concat(t.a,")");this.nodeData.style.fill=i,m.$emit("changeNode",{style:{fill:i}})},updateStroke:function(e){var t=e.rgba,i="rgb(".concat(t.r,",").concat(t.g,",").concat(t.b,")");this.nodeData.style.stroke=i,m.$emit("changeNode",{style:{stroke:i}})},updateTextFill:function(e){var t=e.rgba,i="rgb(".concat(t.r,",").concat(t.g,",").concat(t.b,")");this.nodeData.style.textFill=i,m.$emit("changeNode",{style:{textFill:i}})},setStyle:function(){"italic"==this.nodeData.style.fontStyle?(this.nodeData.style.fontStyle="",m.$emit("changeNode",{style:{fontStyle:""}})):(this.nodeData.style.fontStyle="italic",m.$emit("changeNode",{style:{fontStyle:"italic"}}))},setBold:function(){"bold"==this.nodeData.style.fontWeight?(this.nodeData.style.fontWeight="",m.$emit("changeNode",{style:{fontWeight:""}})):(this.nodeData.style.fontWeight="bold",m.$emit("changeNode",{style:{fontWeight:"bold"}}))},pickFontSize:function(e){this.nodeData.style.fontSize!=e&&(this.nodeData.style.fontSize=e,m.$emit("changeNode",{style:{fontSize:e}}))},setTextPos:function(e,t){this.nodeData.style.textPosition!=t&&(this.nodeData.style.textPosition=t,m.$emit("changeNode",{style:{textPosition:t}}))},changeNodeStyle:function(e){this.nodeData.style.fill=e.fill,this.nodeData.style.stroke=e.stroke,this.nodeData.style.fontSize=e.fontSize;var t=So({},{},{},e);m.$emit("changeNode",{style:t,z:this.nodeData.z})},hideColorPicker:function(){this.nodeData.fillshow=!1,this.nodeData.strokeshow=!1,this.nodeData.textfillshow=!1,this.nodeData.fontsizeshow=!1},hideWin:function(e){var t=e.target,i=!1;while(t){if(1==t.nodeType&&t&&t.className&&t.className.indexOf("vc-sketch")>-1){i=!0;break}t=t.parentElement}i||this.hideColorPicker()}}},Oo=Ao,Do=(i("8dc2"),Object(w["a"])(Oo,mo,xo,!1,null,"1af651cb",null)),Co=Do.exports,Po=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"group",on:{click:e.hideWin}},[i("div",{staticClass:"node-header"},[e._v(" "+e._s(e.text)+" ")]),i("div",{staticClass:"section-group clearfix"},[i("h3",[e._v(e._s(e.$t("group.head")))]),i("p",[i("span",[e._v(e._s(e.$t("group.fill")))]),i("span",{staticClass:"color-picker",style:{background:e.groupData.groupFill},on:{click:function(t){return t.stopPropagation(),e.showColorPicker("groupfill")}}}),i("Sketch-picker",{directives:[{name:"show",rawName:"v-show",value:e.groupData.groupfillshow,expression:"groupData.groupfillshow"}],on:{input:e.updateFill},model:{value:e.groupData.groupFill,callback:function(t){e.$set(e.groupData,"groupFill",t)},expression:"groupData.groupFill"}})],1),i("p",[i("span",[e._v(e._s(e.$t("group.stroke")))]),i("span",{staticClass:"color-picker",style:{background:e.groupData.stroke},on:{click:function(t){return t.stopPropagation(),e.showColorPicker("stroke")}}}),i("Sketch-picker",{directives:[{name:"show",rawName:"v-show",value:e.groupData.strokeshow,expression:"groupData.strokeshow"}],on:{input:e.updateStroke},model:{value:e.groupData.stroke,callback:function(t){e.$set(e.groupData,"stroke",t)},expression:"groupData.stroke"}})],1),i("p",{staticStyle:{"line-height":"20px","margin-top":"6px"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.groupData.showHead,expression:"groupData.showHead"}],staticClass:"magic-checkbox",attrs:{type:"checkbox",id:"showhead",name:"checkbox"},domProps:{checked:Array.isArray(e.groupData.showHead)?e._i(e.groupData.showHead,null)>-1:e.groupData.showHead},on:{change:function(t){var i=e.groupData.showHead,o=t.target,n=!!o.checked;if(Array.isArray(i)){var a=null,s=e._i(i,a);o.checked?s<0&&e.$set(e.groupData,"showHead",i.concat([a])):s>-1&&e.$set(e.groupData,"showHead",i.slice(0,s).concat(i.slice(s+1)))}else e.$set(e.groupData,"showHead",n)}}}),i("label",{attrs:{for:"showhead"}},[e._v(e._s(e.$t("group.showHead")))])])]),i("div",{staticClass:"section-group clearfix"},[i("h3",[e._v(e._s(e.$t("group.font")))]),i("p",[i("span",[e._v(e._s(e.$t("group.fontSize")))]),i("span",{staticClass:"font-size right color-picker",on:{click:function(t){return t.stopPropagation(),e.showColorPicker("fontsize")}}},[e._v(e._s(e.groupData.fontSize))]),i("ul",{directives:[{name:"show",rawName:"v-show",value:e.groupData.fontsizeshow,expression:"groupData.fontsizeshow"}],staticClass:"font-size-select"},e._l(e.fontsize,(function(t){return i("li",{key:t,on:{click:function(i){return e.pickFontSize(t)}}},[e._v(e._s(t))])})),0)]),i("p",[i("span",[e._v(e._s(e.$t("group.textFill")))]),i("span",{staticClass:"color-picker",style:{background:e.groupData.textFill},on:{click:function(t){return t.stopPropagation(),e.showColorPicker("textfill")}}}),i("Sketch-picker",{directives:[{name:"show",rawName:"v-show",value:e.groupData.textfillshow,expression:"groupData.textfillshow"}],on:{input:e.updateTextFill},model:{value:e.groupData.textFill,callback:function(t){e.$set(e.groupData,"textFill",t)},expression:"groupData.textFill"}})],1),i("p",[i("span",{staticClass:"left"},[e._v(e._s(e.$t("group.fontStyle")))]),i("span",{class:"textPos right iconfont icon-qingxie"+("italic"==e.groupData.fontStyle?" active":""),on:{click:function(t){return e.setStyle(t)}}}),i("span",{class:"textPos right iconfont icon-jiacu"+("bold"==e.groupData.fontWeight?" active":""),on:{click:function(t){return e.setBold(t)}}})]),i("p",[i("span",[e._v(e._s(e.$t("group.fill")))]),i("span",{staticClass:"color-picker",style:{background:e.groupData.fill},on:{click:function(t){return t.stopPropagation(),e.showColorPicker("fill")}}}),i("Sketch-picker",{directives:[{name:"show",rawName:"v-show",value:e.groupData.fillshow,expression:"groupData.fillshow"}],on:{input:e.updateHeadFill},model:{value:e.groupData.fill,callback:function(t){e.$set(e.groupData,"fill",t)},expression:"groupData.fill"}})],1),i("p",[i("span",{staticClass:"left"},[e._v(e._s(e.$t("group.align")))]),i("span",{class:"textPos right iconfont icon-juyou"+("insideRight"==e.groupData.textPosition?" active":""),on:{click:function(t){return e.setTextPos(t,"insideRight")}}}),i("span",{class:"textPos right iconfont icon-juzhong1"+("inside"==e.groupData.textPosition?" active":""),on:{click:function(t){return e.setTextPos(t,"inside")}}}),i("span",{class:"textPos right iconfont icon-juzuo"+("insideLeft"==e.groupData.textPosition?" active":""),on:{click:function(t){return e.setTextPos(t,"insideLeft")}}})])])])},To=[];function Eo(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function jo(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Eo(Object(i),!0).forEach((function(t){Object(G["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Eo(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var No={name:"Group",components:{"Sketch-picker":vo["Sketch"]},data:function(){return{text:"Group",fontsize:[12,14,16,18,20,24,28,32,36,40],groupData:{fillshow:!1,strokeshow:!1,textfillshow:!1,fontsizeshow:!1,groupfillshow:!1,showHead:!0,groupFill:"",stroke:"",fill:"",textAlign:"left",fontSize:14,fontStyle:"",fontWeight:"",textFill:""},theme:bo.group}},watch:{"groupData.showHead":{handler:function(e){m.$emit("changeGroup",{mark:"showHead",showHead:e,group:this.group})}}},mounted:function(){var e=this;m.$on("selectGroup",(function(t){var i=t&&t.group;if(i){var o=i.getStyle();e.groupData=jo({},e.groupData,{},o),e.group=i}})),m.$on("changeLanguage",(function(e){h(e.language)})),this.language=localStorage.getItem("localeLanguage")||"zh",h(this.language)},methods:{align:function(e){m.$emit("align",{align:e})},showColorPicker:function(e){switch(e){case"groupfill":this.groupData.strokeshow=!1,this.groupData.textfillshow=!1,this.groupData.fontsizeshow=!1,this.groupData.fillshow=!1,this.groupData.groupfillshow?this.groupData.groupfillshow=!1:this.groupData.groupfillshow=!0;break;case"stroke":this.groupData.fillshow=!1,this.groupData.textfillshow=!1,this.groupData.fontsizeshow=!1,this.groupData.groupfillshow=!1,this.groupData.strokeshow?this.groupData.strokeshow=!1:this.groupData.strokeshow=!0;break;case"textfill":this.groupData.fillshow=!1,this.groupData.strokeshow=!1,this.groupData.fontsizeshow=!1,this.groupData.groupfillshow=!1,this.groupData.textfillshow?this.groupData.textfillshow=!1:this.groupData.textfillshow=!0;break;case"fontsize":this.groupData.fillshow=!1,this.groupData.strokeshow=!1,this.groupData.textfillshow=!1,this.groupData.groupfillshow=!1,this.groupData.fontsizeshow?this.groupData.fontsizeshow=!1:this.groupData.fontsizeshow=!0;break;case"fill":this.groupData.groupfillshow=!1,this.groupData.strokeshow=!1,this.groupData.textfillshow=!1,this.groupData.fontsizeshow=!1,this.groupData.fillshow?this.groupData.fillshow=!1:this.groupData.fillshow=!0;break}},getRgba:function(e){var t=e.rgba,i="rgba(".concat(t.r,",").concat(t.g,",").concat(t.b,",").concat(t.a,")");return i},updateFill:function(e){var t=this.getRgba(e);this.groupData.groupFill=t,m.$emit("changeGroup",{mark:"group",style:{fill:t},group:this.group})},updateStroke:function(e){var t=this.getRgba(e);this.groupData.stroke=t,m.$emit("changeGroup",{mark:"group",style:{stroke:t},group:this.group})},updateTextFill:function(e){var t=this.getRgba(e);this.groupData.textFill=t,m.$emit("changeGroup",{mark:"head",style:{textFill:t},group:this.group})},updateHeadFill:function(e){var t=this.getRgba(e);this.groupData.fill=t,m.$emit("changeGroup",{mark:"head",style:{fill:t},group:this.group})},setStyle:function(){"italic"==this.groupData.fontStyle?(this.groupData.fontStyle="",m.$emit("changeGroup",{mark:"head",style:{fontStyle:""},group:this.group})):(this.groupData.fontStyle="italic",m.$emit("changeGroup",{mark:"head",style:{fontStyle:"italic"},group:this.group}))},setBold:function(){"bold"==this.groupData.fontWeight?(this.groupData.fontWeight="",m.$emit("changeGroup",{mark:"head",style:{fontWeight:""},group:this.group})):(this.groupData.fontWeight="bold",m.$emit("changeGroup",{mark:"head",style:{fontWeight:"bold"},group:this.group}))},pickFontSize:function(e){this.groupData.fontSize!=e&&(this.groupData.fontSize=e,m.$emit("changeGroup",{mark:"head",style:{fontSize:e},group:this.group}))},setTextPos:function(e,t){this.groupData.textPosition!=t&&(this.groupData.textPosition=t,m.$emit("changeGroup",{mark:"head",style:{textPosition:t},group:this.group}))},hideColorPicker:function(){this.groupData.fillshow=!1,this.groupData.strokeshow=!1,this.groupData.textfillshow=!1,this.groupData.fontsizeshow=!1,this.groupData.groupfillshow=!1},hideWin:function(e){var t=e.target,i=!1;while(t){if(1==t.nodeType&&t&&t.className&&t.className.indexOf("vc-sketch")>-1){i=!0;break}t=t.parentElement}i||this.hideColorPicker()}}},Fo=No,Go=(i("9168"),Object(w["a"])(Fo,Po,To,!1,null,"6edfa479",null)),zo=Go.exports,_o=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},Bo=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"canvas",staticStyle:{display:"none"}},[i("div",{staticClass:"node-header"},[e._v("Canvas")]),i("div",{staticClass:"section-group"})])}],Lo={name:"Canvas",data:function(){return{shadow:!1}},mounted:function(){},methods:{changeShadow:function(){this.shadow=!this.shadow,m.$emit("shadow",{shadow:this.shadow})}}},Ro=Lo,Io=(i("7269"),Object(w["a"])(Ro,_o,Bo,!1,null,"884dae7c",null)),$o=Io.exports,Mo=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"edge",on:{click:e.hideWin}},[i("div",{staticClass:"node-header"},[e._v("Relate Link")]),i("div",{staticClass:"section-group"},[i("h3",[e._v(e._s(e.$t("edge.head")))]),i("p",[i("span",[e._v(e._s(e.$t("edge.stroke")))]),i("span",{staticClass:"color-picker",style:{background:e.edgeData.stroke},on:{click:function(t){return t.stopPropagation(),e.showColorPicker("stroke")}}}),i("Sketch-picker",{directives:[{name:"show",rawName:"v-show",value:e.edgeData.strokeshow,expression:"edgeData.strokeshow"}],on:{input:e.updateStroke},model:{value:e.edgeData.stroke,callback:function(t){e.$set(e.edgeData,"stroke",t)},expression:"edgeData.stroke"}})],1),i("p",[i("span",[e._v(e._s(e.$t("edge.lineDash")))]),e._l(e.lineDash,(function(t,o){return i("span",{key:o,class:"iconfont right lineType lineDash "+t.icon+(e.edgeData.lineDashType==t.name?" active":""),on:{click:function(i){return i.stopPropagation(),e.changeLineDash(t.name)}}})}))],2),i("p",[i("span",[e._v(e._s(e.$t("edge.lineStyle")))]),i("span",{class:"iconfont icon-quxianjiantou right lineType"+("bs"==e.edgeData.type?" active":""),on:{click:function(t){return t.stopPropagation(),e.changeLineType("bs")}}}),i("span",{class:"iconfont icon-zhexianjiantou right lineType"+("polyline"==e.edgeData.type?" active":""),on:{click:function(t){return t.stopPropagation(),e.changeLineType("polyline")}}}),i("span",{class:"iconfont icon-zhixianjiantou right lineType"+("line"==e.edgeData.type?" active":""),on:{click:function(t){return t.stopPropagation(),e.changeLineType("line")}}})]),i("p",{directives:[{name:"show",rawName:"v-show",value:"polyline"==e.edgeData.type,expression:"edgeData.type=='polyline'"}]},[i("span",[e._v(e._s(e.$t("edge.turningDistance")))]),i("span",{staticClass:"font-size right color-picker",on:{click:function(t){return t.stopPropagation(),e.showColorPicker("ext")}}},[e._v(e._s(e.edgeData.ext))]),i("ul",{directives:[{name:"show",rawName:"v-show",value:e.edgeData.extshow,expression:"edgeData.extshow"}],staticClass:"ext-select"},e._l(e.exts,(function(t){return i("li",{key:t,on:{click:function(i){return e.pickExt(t)}}},[e._v(e._s(t))])})),0)])]),i("div",{staticClass:"section-group"},[i("h3",[e._v(e._s(e.$t("edge.font")))]),i("p",[i("span",[e._v(e._s(e.$t("edge.fontSize")))]),i("span",{staticClass:"font-size right color-picker",on:{click:function(t){return t.stopPropagation(),e.showColorPicker("fontsize")}}},[e._v(e._s(e.edgeData.fontSize))]),i("ul",{directives:[{name:"show",rawName:"v-show",value:e.edgeData.fontsizeshow,expression:"edgeData.fontsizeshow"}],staticClass:"font-size-select"},e._l(e.fontsize,(function(t){return i("li",{key:t,on:{click:function(i){return e.pickFontSize(t)}}},[e._v(e._s(t))])})),0)]),i("p",[i("span",[e._v(e._s(e.$t("edge.textFill")))]),i("span",{staticClass:"color-picker",style:{background:e.edgeData.textFill},on:{click:function(t){return t.stopPropagation(),e.showColorPicker("textFill")}}}),i("Sketch-picker",{directives:[{name:"show",rawName:"v-show",value:e.edgeData.textfillshow,expression:"edgeData.textfillshow"}],on:{input:e.updateTextFill},model:{value:e.edgeData.textFill,callback:function(t){e.$set(e.edgeData,"textFill",t)},expression:"edgeData.textFill"}})],1),i("p",[i("span",{staticClass:"left"},[e._v(e._s(e.$t("edge.fontStyle")))]),i("span",{class:"textPos right iconfont icon-qingxie"+("italic"==e.edgeData.fontStyle?" active":""),on:{click:function(t){return e.setStyle(t)}}}),i("span",{class:"textPos right iconfont icon-jiacu"+("bold"==e.edgeData.fontWeight?" active":""),on:{click:function(t){return e.setBold(t)}}})]),i("p",[i("span",[e._v(e._s(e.$t("edge.fill")))]),i("span",{staticClass:"color-picker",style:{background:e.edgeData.fill},on:{click:function(t){return t.stopPropagation(),e.showColorPicker("fill")}}}),i("Sketch-picker",{directives:[{name:"show",rawName:"v-show",value:e.edgeData.fillshow,expression:"edgeData.fillshow"}],on:{input:e.updateFill},model:{value:e.edgeData.fill,callback:function(t){e.$set(e.edgeData,"fill",t)},expression:"edgeData.fill"}})],1)])])},Wo=[];function Uo(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function Ho(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Uo(Object(i),!0).forEach((function(t){Object(G["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Uo(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var qo={name:"Edge",components:{"Sketch-picker":vo["Sketch"]},data:function(){return{fontsize:[12,14,16,18,20,24,28,32,36,40],exts:[20,30,40,50,60,70,80,90,100,120,140,160,180,200,240,280,320,400,460,520,600,700,800,900,1e3],lineDash:[{dash:[6,2,2,2],name:"dashed",icon:"icon-line1"},{dash:[4,2],name:"dash",icon:"icon-line-dashed"},{dash:[1,1],name:"dott",icon:"icon-linedotted"},{dash:[0],name:"solid",icon:"icon-line"}],edgeData:{strokeshow:!1,fillshow:!1,textfillshow:!1,fontsizeshow:!1,extshow:!1,stroke:"",fontSize:12,fontStyle:"",fontWeight:"",fill:"",textFill:"",ext:30,lineDashType:"solid"},edge:null}},mounted:function(){var e=this;m.$on("selectEdge",(function(t){var i=t.edge.getData();e.edge=t.edge,e.edgeData=Ho({},e.edgeData,{},i)})),m.$on("changeLanguage",(function(e){h(e.language)})),this.language=localStorage.getItem("localeLanguage")||"zh",h(this.language)},methods:{showColorPicker:function(e){switch(e){case"stroke":this.edgeData.fillshow=!1,this.edgeData.textfillshow=!1,this.edgeData.fontsizeshow=!1,this.edgeData.extshow=!1,this.edgeData.strokeshow?this.edgeData.strokeshow=!1:this.edgeData.strokeshow=!0;break;case"textFill":this.edgeData.fillshow=!1,this.edgeData.strokeshow=!1,this.edgeData.fontsizeshow=!1,this.edgeData.extshow=!1,this.edgeData.textfillshow?this.edgeData.textfillshow=!1:this.edgeData.textfillshow=!0;break;case"fontsize":this.edgeData.fillshow=!1,this.edgeData.strokeshow=!1,this.edgeData.textfillshow=!1,this.edgeData.extshow=!1,this.edgeData.fontsizeshow?this.edgeData.fontsizeshow=!1:this.edgeData.fontsizeshow=!0;break;case"fill":this.edgeData.fontsizeshow=!1,this.edgeData.strokeshow=!1,this.edgeData.textfillshow=!1,this.edgeData.extshow=!1,this.edgeData.fillshow?this.edgeData.fillshow=!1:this.edgeData.fillshow=!0;break;case"ext":this.edgeData.fontsizeshow=!1,this.edgeData.strokeshow=!1,this.edgeData.textfillshow=!1,this.edgeData.fillshow=!1,this.edgeData.extshow?this.edgeData.extshow=!1:this.edgeData.extshow=!0;break}},getRgba:function(e){var t=e.rgba,i="rgba(".concat(t.r,",").concat(t.g,",").concat(t.b,",").concat(t.a,")");return i},updateStroke:function(e){var t=this.getRgba(e);this.edgeData.stroke=t,m.$emit("changeEdge",{style:{stroke:t},mark:"line",edge:this.edge})},updateTextFill:function(e){var t=this.getRgba(e);this.edgeData.textFill=t,m.$emit("changeEdge",{style:{textFill:t},mark:"text",edge:this.edge})},updateFill:function(e){var t=this.getRgba(e);this.edgeData.fill=t,m.$emit("changeEdge",{style:{fill:t},mark:"text",edge:this.edge})},pickFontSize:function(e){this.edgeData.fontSize!=e&&(this.edgeData.fontSize=e,m.$emit("changeEdge",{mark:"text",style:{fontSize:e},edge:this.edge}))},pickExt:function(e){this.edgeData.ext!=e&&(this.edgeData.ext=e,m.$emit("changeEdge",{mark:"line",style:{ext:e},edge:this.edge}))},setStyle:function(){"italic"==this.edgeData.fontStyle?(this.edgeData.fontStyle="",m.$emit("changeEdge",{style:{fontStyle:""},edge:this.edge,mark:"text"})):(this.edgeData.fontStyle="italic",m.$emit("changeEdge",{style:{fontStyle:"italic"},edge:this.edge,mark:"text"}))},setBold:function(){"bold"==this.edgeData.fontWeight?(this.edgeData.fontWeight="",m.$emit("changeEdge",{style:{fontWeight:""},edge:this.edge,mark:"text"})):(this.edgeData.fontWeight="bold",m.$emit("changeEdge",{style:{fontWeight:"bold"},edge:this.edge,mark:"text"}))},changeLineType:function(e){this.edgeData.type=e,m.$emit("changeEdge",{mark:"type",style:{type:e},edge:this.edge})},changeLineDash:function(e){this.edgeData.lineDashType=e,m.$emit("changeEdge",{mark:"type",style:{lineDashType:e},edge:this.edge})},hideWin:function(e){var t=e.target,i=!1;while(t){if(1==t.nodeType&&t&&t.className&&t.className.indexOf("vc-sketch")>-1){i=!0;break}t=t.parentElement}i||this.hideColorPicker()},hideColorPicker:function(){this.edgeData.fillshow=!1,this.edgeData.strokeshow=!1,this.edgeData.textfillshow=!1,this.edgeData.fontsizeshow=!1,this.edgeData.extshow=!1}}},Yo=qo,Jo=(i("d51a"),Object(w["a"])(Yo,Mo,Wo,!1,null,"647d7996",null)),Ko=Jo.exports,Xo={name:"Property",components:{Node:Co,Group:zo,"v-canvas":$o,Edge:Ko},data:function(){return{showCanvas:!0,showGroup:!1,showNode:!1,showLink:!1,showEdge:!1,node:null,group:null,nodes:null,edge:null}},mounted:function(){var e=this;m.$on("clearSelect",(function(){e.showGroup=!1,e.showNode=!1,e.showLink=!1,e.showCanvas=!0,e.showEdge=!1})),m.$on("selectNode",(function(){e.showGroup=!1,e.showNode=!0,e.showLink=!1,e.showCanvas=!1,e.showEdge=!1})),m.$on("selectNodes",(function(){e.showGroup=!1,e.showNode=!0,e.showLink=!1,e.showCanvas=!1,e.showEdge=!1})),m.$on("selectLink",(function(){e.showGroup=!1,e.showNode=!1,e.showLink=!0,e.showCanvas=!1,e.showEdge=!1})),m.$on("selectGroup",(function(){e.showGroup=!0,e.showNode=!1,e.showLink=!1,e.showCanvas=!1,e.showEdge=!1})),m.$on("selectEdge",(function(){e.showGroup=!1,e.showNode=!1,e.showLink=!1,e.showCanvas=!1,e.showEdge=!0}))},methods:{}},Qo=Xo,Vo=(i("dd11"),Object(w["a"])(Qo,go,yo,!1,null,"78e8f960",null)),Zo=Vo.exports,en=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"flow-map",staticStyle:{display:"none"}},[i("div",{staticClass:"flowmap-container",on:{mousedown:e.mousedown,mousemove:e.mousemove,mouseup:e.mouseup}},[i("div",{attrs:{id:"canvas-map"}})])])},tn=[],on={name:"Map",data:function(){return{width:0,height:0,sx:0,sy:0,dx:0,dy:0,pos:[],drag:!1}},mounted:function(){var e=this,t=document.getElementById("canvas-map");this.width=t.offsetWidth,this.height=t.offsetHeight;var i=this.width/this.height;this.mapeditor=new Ri("canvas-map"),this.mapeditor.offEvent(),m.$on("refreshMap",(function(t){var o=t.editor;e.edit=t.editor;var n=JSON.stringify(o.getData()),a=o.getBoundingRect(o.nodes.concat(o.groups).concat(o.edges)),s=a.width,r=a.height,c=s/r,h=1;h=c>i?e.width/a.width:e.height/a.height,e.mapeditor.init(JSON.parse(n),!0),e.mapeditor.attr({position:[-a.x*h,-a.y*h],scale:[h,h]})}))},methods:{mousedown:function(e){this.pos=this.edit.position.slice(),this.sx=e.offsetX,this.sy=e.offsetY,this.drag=!0},mousemove:function(e){this.drag&&(this.dx=e.offsetX-this.sx,this.dy=e.offsetY-this.sy,this.edit.attr({position:[this.pos[0]-2*this.dx,this.pos[1]-2*this.dy]}))},mouseup:function(){this.drag=!1,this.dx=0,this.dy=0,this.pos=[0,0]}}},nn=on,an=(i("5490"),Object(w["a"])(nn,en,tn,!1,null,null,null)),sn=an.exports,rn={name:"MainPage",components:{Header:k,Toolbar:j,Editor:po,Property:Zo,Map:sn},data:function(){return{}},mounted:function(){}},cn=rn,hn=(i("d2a7"),Object(w["a"])(cn,f,p,!1,null,"4531169b",null)),ln=hn.exports,dn={name:"app",components:{MainPage:ln}},un=dn,fn=(i("034f"),Object(w["a"])(un,d,u,!1,null,null,null)),pn=fn.exports,gn=i("f825"),yn=i.n(gn);i("f8ce"),i("a75e");o["default"].use(yn.a),o["default"].config.productionTip=!1,new o["default"]({i18n:l,render:function(e){return e(pn)}}).$mount("#app")},"60f8":function(e,t,i){"use strict";var o=i("1308"),n=i.n(o);n.a},6478:function(e,t,i){},"6e6c":function(e,t,i){e.exports=i.p+"img/rightTip.576d382a.png"},7269:function(e,t,i){"use strict";var o=i("3efa"),n=i.n(o);n.a},"791a":function(e,t,i){"use strict";var o=i("6478"),n=i.n(o);n.a},"859b":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFYAAABXCAYAAACeCrJSAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGSSURBVHhe7dkxisJQGEXh2XY2YpPGIo2NjUWaELCxcAPuwDVYCG/mwS+IRp0k78CEOQduoaYwHyKafCVDEhZKWKgn2NPp5Gbs1iCsTUtYKGGhhIUSFkpYKGGhhIUSFkpYKGGhhIUSFkpYKGGhhIUSFkpYKGGhhIUSFkpYKGGhhIUSFurfw57P53Q8HuNRuYT9ga2qKh0Oh3imTMIGbN5+v49n5yfsHWxe13XxyryEfYDNa9s2Xp2esAOwebvdLo6YlrAvYPO2220cNT5h38DmbTabOHJcwn6AzWuaJo7+fShs3/eDb3SJW6/X6Xq9xpl9TtgRq+s6XS6XOLv3CTtyq9Uqzu59wo6Yn1hgf+o7dgkt8lfBEvJ3LJT/vKBewXqtYGZDsF7dKtAjrNdjC3UP6x2Egt1gvedVuAzrXdoFJSyUsFDCQgkLJSyUsFDCQgkLJSyUsFDCQgkLJSyUsFDCQgkLJSyUsFDCQgkLJSyUsFDCQgkLJSyUsFDCQgkLJSzUR1g3fbeeYK1MwkIJCyUsUkrfK3jHcL47ZMgAAAAASUVORK5CYII="},"85ec":function(e,t,i){},"8dc2":function(e,t,i){"use strict";var o=i("d79d"),n=i.n(o);n.a},9168:function(e,t,i){"use strict";var o=i("4813"),n=i.n(o);n.a},a6b6:function(e,t,i){},a75e:function(e,t,i){},cf4f:function(e,t,i){"use strict";var o=i("2393"),n=i.n(o);n.a},d2a7:function(e,t,i){"use strict";var o=i("50b9"),n=i.n(o);n.a},d51a:function(e,t,i){"use strict";var o=i("e489"),n=i.n(o);n.a},d79d:function(e,t,i){},dc17:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFUAAABVCAYAAAA49ahaAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGbSURBVHhe7dKxagJBFEbhvLbgM9jb2ChY2NjYiNjY2Fj7JDYWbrjChsgOJlGPe4ecAz8s4+4UH3409vJEBRIV6Ab1eDy6J9bWQbXHEhVIVCBRgUQFEhVIVCBRgUQFEhVIVCBRgapEPZ1O12WtOtTz+dyMx+Pr4jljVaFeLpdmMpk0g8HguniOs2xVhTqdTr9A28VZtqpBnc/nHdB28VumqkBdLBZFzO+Ld7KUHnW5XBYRS4t3M5QadbVaFfHuLb7pu7So6/W6iPabxbd9lhJ1u90Wsf6yuKOv0qHudrsi0iOLu/ooFep+vy/iPLO4892lQT0cDs1sNru70WjUQYuz0rvfF3e/s1T/1J/abDYd1DjLlqhAogKJCiQqkKhAogKJCiQqkKhAogKJCiQqkKhAogKJCiQqkKhAogKJCiQqkKhAogKJCiQqkKhAogKJCiQqkKhAogKJCiQqkKhAogKJCiQqkKhAogKJCiQqUHWow+HwZqL+k0QFEhVIVCBRgUQFEhVIVCBRgUQFEhXoLqp7fG03qPaaRH15TfMJ/HS/NAYMi2AAAAAASUVORK5CYII="},dd11:function(e,t,i){"use strict";var o=i("42ec"),n=i.n(o);n.a},e489:function(e,t,i){},e617:function(e,t,i){},edd4:function(e){e.exports=JSON.parse('{"node":{"title1":"Single Node","titl2":"Multiple Node","head":"Style","fill":"Fill","stroke":"Stroke","font":"Font","fontStyle":"Font Style","fontSize":"Font Size","textFill":"Text Fill","nodeAlign":"Node Alignment","position":"Position","prefabrication":"Prefabrication Style"},"group":{"head":"Style","fill":"Fill","stroke":"Stroke","showHead":"Show Head","font":"Font","fontStyle":"Font Style","fontSize":"Font Size","fontBackground":"Font Background","align":"Text Align","textFill":"Text Fill","position":"Position","prefabrication":"Prefabrication Style"},"edge":{"head":"Style","fill":"Fill","stroke":"Stroke","lineDash":"Line Dash","lineStyle":"Line Style","turningDistance":"Turning Distance","font":"Font","fontStyle":"Font Style","fontSize":"Font Size","textFill":"Text Fill","nodeAlign":"Node Alignment","position":"Position","prefabrication":"Prefabrication Style"}}')}});
//# sourceMappingURL=app.1a8c068a.js.map